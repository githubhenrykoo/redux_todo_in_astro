name: Telegram Notification

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  # You can add other triggers as needed

jobs:
  notify:
    runs-on: ubuntu-latest
    environment:
      name: telegram-bot
      url: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
    
    steps:
    - uses: actions/checkout@v4
      
    - name: Debug Environment
      run: |
        echo "Checking environment variables (sanitized)..."
        if [ -n "${{ secrets.TELEGRAM_BOT_TOKEN }}" ]; then
          echo "TELEGRAM_BOT_TOKEN is set"
        else
          echo "TELEGRAM_BOT_TOKEN is not set"
        fi
        if [ -n "${{ secrets.TELEGRAM_CHAT_ID }}" ]; then
          echo "TELEGRAM_CHAT_ID is set"
        else
          echo "TELEGRAM_CHAT_ID is not set"
        fi

    - name: Send Notification
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }}
        token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        format: markdown
        message: |
          *GitHub Action Notification*
          
          *Repository:* `${{ github.repository }}`
          *Event:* `${{ github.event_name }}`
          *Branch:* `${{ github.ref_name }}`
          *Commit:* `${{ github.sha }}`
          
          *Actor:* `${{ github.actor }}`
          *Status:* ${{ job.status }}
          
          [View Action Run](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
