import{r as o}from"./index.DKKB-h0h.js";import{g as v,R as h}from"./index.CytJPw2Y.js";function w(){const s=v();let u=null,r=null;return{clear(){u=null,r=null},notify(){s(()=>{let t=u;for(;t;)t.callback(),t=t.next})},get(){let t=[],n=u;for(;n;)t.push(n),n=n.next;return t},subscribe(t){let n=!0,e=r={callback:t,next:null,prev:r};return e.prev?e.prev.next=e:u=e,function(){!n||u===null||(n=!1,e.next?e.next.prev=e.prev:r=e.prev,e.prev?e.prev.next=e.next:u=e.next)}}}}const S={notify(){},get:()=>[]};function C(s,u){let r,t=S,n=0,e=!1;function c(g){a();const m=t.subscribe(g);let p=!1;return()=>{p||(p=!0,m(),d())}}function l(){t.notify()}function f(){b.onStateChange&&b.onStateChange()}function i(){return e}function a(){n++,r||(r=s.subscribe(f),t=w())}function d(){n--,r&&n===0&&(r(),r=void 0,t.clear(),t=S)}function y(){e||(e=!0,a())}function x(){e&&(e=!1,d())}const b={addNestedSub:c,notifyNestedSubs:l,handleChangeWrapper:f,isSubscribed:i,trySubscribe:y,tryUnsubscribe:x,getListeners:()=>t};return b}const E=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",L=E?o.useLayoutEffect:o.useEffect;function M({store:s,context:u,children:r,serverState:t,stabilityCheck:n="once",noopCheck:e="once"}){const c=o.useMemo(()=>{const i=C(s);return{store:s,subscription:i,getServerState:t?()=>t:void 0,stabilityCheck:n,noopCheck:e}},[s,t,n,e]),l=o.useMemo(()=>s.getState(),[s]);L(()=>{const{subscription:i}=c;return i.onStateChange=i.notifyNestedSubs,i.trySubscribe(),l!==s.getState()&&i.notifyNestedSubs(),()=>{i.tryUnsubscribe(),i.onStateChange=void 0}},[c,l]);const f=u||h;return o.createElement(f.Provider,{value:c},r)}export{M as P};
