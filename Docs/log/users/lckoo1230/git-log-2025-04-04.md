# Git Activity Log - Henry Koo
Generated at: Fri Apr  4 00:42:44 UTC 2025
## Changes by Henry Koo
```diff
commit c558671efa146852f29ea469f0fccccbbf05126a
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Thu Apr 3 14:53:00 2025 +0800

    working dashboard

diff --git a/src/components/panels/Sidebar.astro b/src/components/panels/Sidebar.astro
index e53580d..999578d 100644
--- a/src/components/panels/Sidebar.astro
+++ b/src/components/panels/Sidebar.astro
@@ -68,7 +68,7 @@ const { class: className, ...props } = Astro.props;
       <button
         id="transcriptionLayoutBtn"
         title="AI Training Data"
-        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
+        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative hidden"
       >
         <FaBrain className="text-lg text-muted-foreground group-hover:text-primary transition-colors" />
         <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
diff --git a/src/components/panels/SimpleMQTTDashboardPanel.jsx b/src/components/panels/SimpleMQTTDashboardPanel.jsx
index 8ff7dca..1c9fde8 100644
--- a/src/components/panels/SimpleMQTTDashboardPanel.jsx
+++ b/src/components/panels/SimpleMQTTDashboardPanel.jsx
@@ -2,6 +2,8 @@
 
 import React, { useState, useEffect, useRef } from 'react';
 import { useSelector, useDispatch } from 'react-redux';
+import mqtt from 'mqtt';
+import Chart from 'chart.js/auto';
 import {
   setConnectionStatus,
   setCurrentTemp,
@@ -118,18 +120,6 @@ const SimpleMQTTDashboardPanel = () => {
   const mqttClientRef = useRef(null);
   const chartInstanceRef = useRef(null);
   
-  // Utility function to load external scripts
-  const loadScript = (src) => {
-    return new Promise((resolve, reject) => {
-      const script = document.createElement('script');
-      script.src = src;
-      script.async = true;
-      script.onload = () => resolve();
-      script.onerror = () => reject(new Error(`Failed to load script: ${src}`));
-      document.head.appendChild(script);
-    });
-  };
-  
   // Initialize everything
   useEffect(() => {
     let mqttClient = null;
@@ -137,211 +127,108 @@ const SimpleMQTTDashboardPanel = () => {
     
     const initializeDashboard = async () => {
       try {
-        // Load required scripts
-        dispatch(setConnectionStatus('Loading required libraries...'));
-        await Promise.all([
-          loadScript('https://unpkg.com/mqtt/dist/mqtt.min.js'),
-          loadScript('https://cdn.jsdelivr.net/npm/chart.js')
-        ]);
-        dispatch(setConnectionStatus('Libraries loaded, connecting to broker...'));
+        dispatch(setConnectionStatus('Connecting to MQTT broker...'));
         
-        // Connect to MQTT broker when scripts are loaded
-        if (window.mqtt) {
-          const broker = 'wss://1115a4b6fe5c40e588a3a85468f3c8be.s1.eu.hivemq.cloud:8884/mqtt';
-          const options = {
-            connectTimeout: 4000,
-            clientId: 'webClient_' + Math.random().toString(16).substr(2, 8),
-            username: 'duwiarsana',
-            password: 'Duwiarsana1234!?',
-            clean: true,
-          };
-          
-          console.log("Attempting to connect to MQTT broker...");
-          mqttClient = window.mqtt.connect(broker, options);
-          mqttClientRef.current = mqttClient;
+        // Connect to MQTT broker directly using the imported library
+        const broker = 'wss://1115a4b6fe5c40e588a3a85468f3c8be.s1.eu.hivemq.cloud:8884/mqtt';
+        const options = {
+          connectTimeout: 4000,
+          clientId: 'webClient_' + Math.random().toString(16).substr(2, 8),
+          username: 'duwiarsana',
+          password: 'Duwiarsana1234!?',
+          clean: true,
+        };
+        
+        console.log("Attempting to connect to MQTT broker...");
+        mqttClient = mqtt.connect(broker, options);
+        mqttClientRef.current = mqttClient;
+        
+        mqttClient.on('connect', () => {
+          console.log("Connected to MQTT broker!");
+          dispatch(setConnectionStatus('✅ Connected to MQTT Broker'));
           
-          mqttClient.on('connect', () => {
-            console.log("Connected to MQTT broker!");
-            dispatch(setConnectionStatus('✅ Connected to MQTT Broker'));
-            
-            // Subscribe to all required topics at once for efficiency
-            const topics = {
-              'sensor/temperature': { qos: 0 },
-              'sensor/tegangan': { qos: 0 },
-              'sensor/arus': { qos: 0 },
-              'sensor/daya': { qos: 0 },
-              'sensor/kwh': { qos: 0 },
-              'sensor/pf': { qos: 0 }
-            };
-            
-            mqttClient.subscribe(topics, (err, granted) => {
-              if (err) {
-                console.error('Error subscribing to topics:', err);
-              } else {
-                console.log('Successfully subscribed to topics:', granted);
-                
-                // Send test messages to verify data display
-                // These will be overwritten by actual sensor data when it arrives
-                mqttClient.publish('sensor/tegangan', '220.5');
-                mqttClient.publish('sensor/arus', '1.25');
-                mqttClient.publish('sensor/daya', '275');
-                mqttClient.publish('sensor/kwh', '0.123');
-                mqttClient.publish('sensor/pf', '0.95');
-              }
-            });
-            
-            // Send a test message to verify connection
-            mqttClient.publish('test/connection', 'Dashboard connected', { qos: 0, retain: false });
+          // Subscribe to topics
+          mqttClient.subscribe('sensor/temperature');
+          [
+            'sensor/tegangan', 
+            'sensor/arus', 
+            'sensor/daya', 
+            'sensor/kwh', 
+            'sensor/pf'
+          ].forEach(topic => {
+            mqttClient.subscribe(topic);
           });
+        });
+        
+        mqttClient.on('error', (err) => {
+          console.error('MQTT Connection Error:', err);
+          dispatch(setConnectionStatus('❌ MQTT Connection Error: ' + err.message));
+        });
+        
+        mqttClient.on('message', (topic, message) => {
+          const msg = message.toString();
+          const now = new Date().toLocaleTimeString();
+          console.log(`MQTT message received on topic ${topic}: ${msg}`);
           
-          mqttClient.on('error', (err) => {
-            console.error('MQTT Connection Error:', err);
-            dispatch(setConnectionStatus('❌ MQTT Connection Error: ' + err.message));
-          });
+          // Store last message in Redux
+          dispatch(setLastMessage({ topic, message: msg }));
           
-          mqttClient.on('message', (topic, message) => {
-            const msg = message.toString();
-            const now = new Date().toLocaleTimeString();
-            console.log(`MQTT message received on topic ${topic}: ${msg}`);
-            
-            // Store last message in Redux
-            dispatch(setLastMessage({ topic, message: msg }));
-            
-            // Handle different topics
-            if (topic === 'sensor/temperature') {
-              try {
-                const suhu = parseFloat(msg);
-                if (!isNaN(suhu)) {
-                  console.log(`Updating temperature to: ${suhu}°C`);
-                  
-                  // Update Redux state
-                  dispatch(setCurrentTemp(suhu));
-                  
-                  // Also update local state for immediate UI update
-                  setLocalTemp(suhu);
-                  
-                  // Force component update with local state
-                  setCustomText(prev => prev); // This is a trick to force re-render
-                  
-                  // Add temperature data point to history
-                  dispatch(addTemperatureDataPoint({ label: now, value: suhu }));
-                  
-                  // Directly update chart with new data point
-                  if (chartInstanceRef.current) {
-                    // Limit chart to show last 10 data points for better visualization
-                    if (chartInstanceRef.current.data.labels.length > 10) {
-                      chartInstanceRef.current.data.labels.shift();
-                      chartInstanceRef.current.data.datasets[0].data.shift();
-                    }
-                    
-                    // Add new data point
-                    chartInstanceRef.current.data.labels.push(now);
-                    chartInstanceRef.current.data.datasets[0].data.push(suhu);
-                    chartInstanceRef.current.update('none'); // Use 'none' for smoother updates
+          // Handle different topics
+          if (topic === 'sensor/temperature') {
+            try {
+              const suhu = parseFloat(msg);
+              if (!isNaN(suhu)) {
+                console.log(`Updating temperature to: ${suhu}°C`);
+                
+                // Update Redux state
+                dispatch(setCurrentTemp(suhu));
+                
+                // Also update local state for immediate UI update
+                setLocalTemp(suhu);
+                
+                // Force component update with local state
+                setCustomText(prev => prev); // This is a trick to force re-render
+                
+                // Add temperature data point to history
+                dispatch(addTemperatureDataPoint({ label: now, value: suhu }));
+                
+                // Directly update chart with new data point
+                if (chartInstanceRef.current) {
+                  // Limit chart to show last 10 data points for better visualization
+                  if (chartInstanceRef.current.data.labels.length > 10) {
+                    chartInstanceRef.current.data.labels.shift();
+                    chartInstanceRef.current.data.datasets[0].data.shift();
                   }
-                } else {
-                  console.error('Received invalid temperature value:', msg);
-                }
-              } catch (error) {
-                console.error('Error processing temperature data:', error);
-              }
-            }
-            
-            // Process voltage data with proper parsing and formatting
-            else if (topic === 'sensor/tegangan') {
-              try {
-                const value = parseFloat(msg);
-                if (!isNaN(value)) {
-                  console.log(`Updating voltage to: ${value}V`);
-                  dispatch(setVoltage(value.toFixed(1)));
-                } else {
-                  console.error('Received invalid voltage value:', msg);
-                  dispatch(setVoltage('--'));
-                }
-              } catch (error) {
-                console.error('Error processing voltage data:', error);
-                dispatch(setVoltage('--'));
-              }
-            }
-            
-            // Process current data with proper parsing and formatting
-            else if (topic === 'sensor/arus') {
-              try {
-                const value = parseFloat(msg);
-                if (!isNaN(value)) {
-                  console.log(`Updating current to: ${value}A`);
-                  dispatch(setCurrent(value.toFixed(2)));
-                } else {
-                  console.error('Received invalid current value:', msg);
-                  dispatch(setCurrent('--'));
-                }
-              } catch (error) {
-                console.error('Error processing current data:', error);
-                dispatch(setCurrent('--'));
-              }
-            }
-            
-            // Process power data with proper parsing and formatting
-            else if (topic === 'sensor/daya') {
-              try {
-                const value = parseFloat(msg);
-                if (!isNaN(value)) {
-                  console.log(`Updating power to: ${value}W`);
-                  dispatch(setPower(value.toFixed(0)));
-                } else {
-                  console.error('Received invalid power value:', msg);
-                  dispatch(setPower('--'));
-                }
-              } catch (error) {
-                console.error('Error processing power data:', error);
-                dispatch(setPower('--'));
-              }
-            }
-            
-            // Process energy data with proper parsing and formatting
-            else if (topic === 'sensor/kwh') {
-              try {
-                const value = parseFloat(msg);
-                if (!isNaN(value)) {
-                  console.log(`Updating energy to: ${value}kWh`);
-                  dispatch(setKwh(value.toFixed(3)));
-                } else {
-                  console.error('Received invalid energy value:', msg);
-                  dispatch(setKwh('--'));
-                }
-              } catch (error) {
-                console.error('Error processing energy data:', error);
-                dispatch(setKwh('--'));
-              }
-            }
-            
-            // Process power factor data with proper parsing and formatting
-            else if (topic === 'sensor/pf') {
-              try {
-                const value = parseFloat(msg);
-                if (!isNaN(value)) {
-                  console.log(`Updating power factor to: ${value}`);
-                  dispatch(setPowerFactor(value.toFixed(2)));
-                } else {
-                  console.error('Received invalid power factor value:', msg);
-                  dispatch(setPowerFactor('--'));
+                  
+                  // Add new data point
+                  chartInstanceRef.current.data.labels.push(now);
+                  chartInstanceRef.current.data.datasets[0].data.push(suhu);
+                  chartInstanceRef.current.update('none'); // Use 'none' for smoother updates
                 }
-              } catch (error) {
-                console.error('Error processing power factor data:', error);
-                dispatch(setPowerFactor('--'));
+              } else {
+                console.error('Received invalid temperature value:', msg);
               }
+            } catch (error) {
+              console.error('Error processing temperature data:', error);
             }
-          });
-        } else {
-          dispatch(setConnectionStatus('❌ MQTT library not found'));
-          console.error('MQTT library not loaded properly');
-        }
+          } else if (topic === 'sensor/tegangan') {
+            dispatch(setVoltage(msg));
+          } else if (topic === 'sensor/arus') {
+            dispatch(setCurrent(msg));
+          } else if (topic === 'sensor/daya') {
+            dispatch(setPower(msg));
+          } else if (topic === 'sensor/kwh') {
+            dispatch(setKwh(msg));
+          } else if (topic === 'sensor/pf') {
+            dispatch(setPowerFactor(msg));
+          }
+        });
         
         // Initialize Chart.js
-        if (window.Chart && chartCanvasRef.current) {
+        if (chartCanvasRef.current) {
           const ctx = chartCanvasRef.current.getContext('2d');
           
-          chartInstance = new window.Chart(ctx, {
+          chartInstance = new Chart(ctx, {
             type: 'line',
             data: {
               labels: temperatureHistory.labels,
@@ -392,7 +279,7 @@ const SimpleMQTTDashboardPanel = () => {
           });
           chartInstanceRef.current = chartInstance;
         } else {
-          console.error('Chart.js library not loaded properly or canvas not found');
+          console.error('Chart canvas not found');
         }
       } catch (error) {
         console.error('Error initializing dashboard:', error);
@@ -531,6 +418,12 @@ const SimpleMQTTDashboardPanel = () => {
         >
           Turn off LED
         </button>
+        <button 
+          className="bg-[#6200ee] hover:bg-[#3700b3] text-white px-5 py-2 rounded-md transition-colors"
+          onClick={publishTestValues}
+        >
+          Test Energy Meter
+        </button>
       </div>
       
       {/* Energy Meter Data */}
@@ -604,35 +497,3 @@ const SimpleMQTTDashboardPanel = () => {
 };
 
 export default SimpleMQTTDashboardPanel;
-
-// Add this function after the other control functions
-  const publishTestValues = () => {
-    if (mqttClientRef.current) {
-      console.log('Publishing test energy meter values...');
-      mqttClientRef.current.publish('sensor/tegangan', '220.5');
-      mqttClientRef.current.publish('sensor/arus', '1.25');
-      mqttClientRef.current.publish('sensor/daya', '275');
-      mqttClientRef.current.publish('sensor/kwh', '0.123');
-      mqttClientRef.current.publish('sensor/pf', '0.95');
-      
-      // Add a small notification
-      dispatch(setConnectionStatus('✅ Test values published'));
-      
-      // Reset status after 3 seconds
-      setTimeout(() => {
-        dispatch(setConnectionStatus('✅ Connected to MQTT Broker'));
-      }, 3000);
-    } else {
-      console.warn('MQTT client not initialized yet');
-      dispatch(setConnectionStatus('⚠️ MQTT client not ready, try again in a moment'));
-    }
-  };
-  
-  // Then add a test button below the LED controls
-  // Add this to the Controls div
-  <button 
-    className="bg-[#6200ee] hover:bg-[#3700b3] text-white px-5 py-2 rounded-md transition-colors"
-    onClick={publishTestValues}
-  >
-    Test Energy Meter
-  </button>
diff --git a/src/components/panels/panels.json b/src/components/panels/panels.json
index 4c7437b..040834e 100644
--- a/src/components/panels/panels.json
+++ b/src/components/panels/panels.json
@@ -49,5 +49,8 @@
   },
   "TranscriptionPanel": {
     "component": "../components/panels/TranscriptionPanel.tsx"
+  },
+  "SimpleMQTTDashboardPanel": {
+    "component": "../components/panels/SimpleMQTTDashboardPanel.jsx"
   }
 }
diff --git a/src/features/panellayoutSlice.js b/src/features/panellayoutSlice.js
index f33257f..31115b5 100644
--- a/src/features/panellayoutSlice.js
+++ b/src/features/panellayoutSlice.js
@@ -2,7 +2,7 @@ import { createSlice } from "@reduxjs/toolkit";
 import layoutConfig from "./panellayoutSlice.json";
 
 const initialState = {
-  panels: layoutConfig["generate_layout"],
+  panels: layoutConfig["mqtt_dashboard_layout"],
 };
 
 // Simplified function to trigger save
diff --git a/src/features/panellayoutSlice.json b/src/features/panellayoutSlice.json
index 49e8f75..34ebb3c 100644
--- a/src/features/panellayoutSlice.json
+++ b/src/features/panellayoutSlice.json
@@ -21,7 +21,7 @@
     },
     "todo_layout": {
         "left": {
-            "type": "codeeditor",
+            "type": "DatabaseRetrievePanel",
             "size": 30,
             "minSize": 20,
             "visible": true
@@ -82,19 +82,19 @@
     "mqtt_dashboard_layout": {
         "left": {
             "type": "FileTablePanel",
-            "size": 0,
+            "size": 30,
             "minSize": 0,
             "visible": false
         },
         "middle": {
             "type": "SimpleMQTTDashboardPanel", 
-            "size": 100,
-            "minSize": 100,
+            "size": 40,
+            "minSize": 0,
             "visible": true
         },
         "right": {
             "type": "ContentDetailPanel",
-            "size": 0,
+            "size": 30,
             "minSize": 0,
             "visible": false
         }
diff --git a/src/store.js b/src/store.js
index df50921..129a960 100644
--- a/src/store.js
+++ b/src/store.js
@@ -13,6 +13,7 @@ import systemReducer from './features/systemSlice';
 import todoReducer from './features/todoSlice';
 import resizeableReducer from './features/resizeableSlice';
 import selectedItemReducer from './features/selectedItemSlice';
+import mqttReducer from './store/mqttSlice';
 
 const store = configureStore({
   reducer: {
@@ -25,6 +26,7 @@ const store = configureStore({
     search: searchReducer,
     system: systemReducer,
     todo: todoReducer,
+    mqtt: mqttReducer,
     
     // UI States
     panellayout: panellayoutReducer,

commit fd2c58a3f9a87c14ad58bd91a768866a0db96559
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Thu Apr 3 09:56:44 2025 +0800

    new panles

diff --git a/run-transcriber.sh b/run-transcriber.sh
new file mode 100755
index 0000000..c043d2f
--- /dev/null
+++ b/run-transcriber.sh
@@ -0,0 +1,8 @@
+#!/bin/bash
+# Simple script to run the Python transcription script
+
+# Change to the correct directory
+cd "$(dirname "$0")/Docs/to-do-plan"
+
+# Activate virtual environment and run the script
+source venv/bin/activate && python generator/audio_transcriber.py
diff --git a/src/components/panels/ContentDetailPanel.jsx b/src/components/panels/ContentDetailPanel.jsx
index 28e5bb8..6ba86d5 100644
--- a/src/components/panels/ContentDetailPanel.jsx
+++ b/src/components/panels/ContentDetailPanel.jsx
@@ -10,6 +10,7 @@ import ContentEditor from '../ui/ContentEditor';
 import FileUploader from '../ui/FileUploader';
 import { FileTypeIcon } from '../ui/icons/FileTypeIcon';
 import TXTViewer from '../viewers/TXTViewer';
+import { getContentType as getContentTypeUtil, getFileExtension } from '../../utils/content-detection';
 
 export default function ContentDetailPanel() {
   const [isEditing, setIsEditing] = useState(false);
@@ -549,8 +550,8 @@ export default function ContentDetailPanel() {
               {/* File Type Icon */}
               <div className="mb-4">
                 <FileTypeIcon 
-                  mimeType={fileInfo?.type || selectedContentItem?.content?.mimeType} 
-                  extension={getFileExtension(fileInfo?.name || selectedContentItem?.content?.fileName)}
+                  mimeType={getContentTypeUtil(fileInfo, selectedItemMetadata)}
+                  extension={fileInfo?.name ? getFileExtension(fileInfo.name) : undefined}
                   size={48}
                 />
               </div>
@@ -562,7 +563,7 @@ export default function ContentDetailPanel() {
               
               {/* File Info */}
               <div className="text-sm text-gray-500 mb-4">
-                {fileInfo?.type || selectedContentItem?.content?.mimeType || "Unknown type"} • 
+                {getContentTypeUtil(fileInfo, selectedItemMetadata) || selectedContentItem?.content?.mimeType || "Unknown type"} • 
                 {formatFileSize(fileInfo?.size || selectedContentItem?.content?.size || 0)}
               </div>
 
@@ -607,8 +608,8 @@ export default function ContentDetailPanel() {
                 ) : (
                   <div className="text-center p-6 bg-gray-50 dark:bg-gray-700 rounded-lg">
                     <FileTypeIcon 
-                      mimeType={fileInfo?.type || selectedContentItem?.content?.mimeType}
-                      extension={getFileExtension(fileInfo?.name || selectedContentItem?.content?.fileName)}
+                      mimeType={getContentTypeUtil(fileInfo, selectedItemMetadata)}
+                      extension={fileInfo?.name ? getFileExtension(fileInfo.name) : undefined}
                       size={64}
                     />
                   </div>
@@ -624,7 +625,8 @@ export default function ContentDetailPanel() {
             <div className="border-b border-gray-200 dark:border-gray-700 p-4">
               <div className="flex items-center">
                 <FileTypeIcon 
-                  mimeType={getContentType()}
+                  mimeType={getContentTypeUtil(fileInfo, selectedItemMetadata)}
+                  extension={fileInfo?.name ? getFileExtension(fileInfo.name) : undefined}
                   size={24}
                   className="mr-3"
                 />
@@ -633,7 +635,7 @@ export default function ContentDetailPanel() {
                     {selectedHash ? `${selectedHash.substring(0, 8)}...` : 'Text Content'}
                   </h3>
                   <p className="text-xs text-gray-500">
-                    {getContentType()}
+                    {getContentTypeUtil(fileInfo, selectedItemMetadata)}
                   </p>
                 </div>
               </div>
@@ -641,7 +643,7 @@ export default function ContentDetailPanel() {
             
             <div className="p-0">
               {/* Use TXTViewer for text/plain files */}
-              {getContentType() === 'text/plain' ? (
+              {getContentTypeUtil(fileInfo, selectedItemMetadata) === 'text/plain' ? (
                 <TXTViewer content={selectedContentItem?.content} />
               ) : (
                 <ContentEditor
@@ -664,7 +666,7 @@ export default function ContentDetailPanel() {
             <div className="border-b border-gray-200 dark:border-gray-700 p-4">
               <div className="flex items-center">
                 <FileTypeIcon 
-                  mimeType={getContentType()}
+                  mimeType={getContentTypeUtil(fileInfo, selectedItemMetadata)}
                   extension={fileInfo?.name ? getFileExtension(fileInfo.name) : undefined}
                   size={24}
                   className="mr-3"
@@ -705,11 +707,4 @@ export default function ContentDetailPanel() {
       </div>
     </div>
   );
-}
-
-// Helper function to get file extension from a filename
-const getFileExtension = (filename) => {
-  if (!filename) return '';
-  const parts = filename.split('.');
-  return parts.length > 1 ? parts[parts.length - 1].toLowerCase() : '';
-};
\ No newline at end of file
+}
\ No newline at end of file
diff --git a/src/components/panels/Sidebar.astro b/src/components/panels/Sidebar.astro
index 6ee08fa..e53580d 100644
--- a/src/components/panels/Sidebar.astro
+++ b/src/components/panels/Sidebar.astro
@@ -1,6 +1,6 @@
 ---
 import { cn } from '../../lib/utils';
-import { FaCode,FaTerminal, FaCog, FaCube, FaFile } from 'react-icons/fa';
+import { FaCode, FaTerminal, FaCog, FaCube, FaFile, FaMicrophone, FaBrain } from 'react-icons/fa';
 import { store } from '../../store';
 import { changeLayout } from '../../features/panellayoutSlice';
 
@@ -65,6 +65,16 @@ const { class: className, ...props } = Astro.props;
           MQTT Dashboard
         </span>
       </button>
+      <button
+        id="transcriptionLayoutBtn"
+        title="AI Training Data"
+        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
+      >
+        <FaBrain className="text-lg text-muted-foreground group-hover:text-primary transition-colors" />
+        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
+          AI Training Data
+        </span>
+      </button>
     </div>
     <div>
       <div class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors">
@@ -84,6 +94,7 @@ const { class: className, ...props } = Astro.props;
   const clmLayoutBtn = document.getElementById('clmLayoutBtn');
   const fileLayoutBtn = document.getElementById('fileLayoutBtn');
   const mqttDashboardLayoutBtn = document.getElementById('mqttDashboardLayoutBtn');
+  const transcriptionLayoutBtn = document.getElementById('transcriptionLayoutBtn');
 
   // Add click handlers
   todoLayoutBtn?.addEventListener('click', () => {
@@ -106,6 +117,10 @@ const { class: className, ...props } = Astro.props;
     store.dispatch(changeLayout('mqtt_dashboard_layout'));
   });
 
+  transcriptionLayoutBtn?.addEventListener('click', () => {
+    store.dispatch(changeLayout('transcription_layout'));
+  });
+
   // Function to update active button styles
   function updateActiveButton(layout: string) {
     // Remove active styles from all buttons
@@ -114,6 +129,7 @@ const { class: className, ...props } = Astro.props;
     clmLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
     fileLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
     mqttDashboardLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
+    transcriptionLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
 
     // Reset icon colors
     todoLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
@@ -121,6 +137,7 @@ const { class: className, ...props } = Astro.props;
     clmLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
     fileLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
     mqttDashboardLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
+    transcriptionLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
 
     // Add active styles to the selected button
     if (layout === 'todo_layout') {
@@ -138,6 +155,9 @@ const { class: className, ...props } = Astro.props;
     } else if (layout === 'mqtt_dashboard_layout') {
       mqttDashboardLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
       mqttDashboardLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
+    } else if (layout === 'transcription_layout') {
+      transcriptionLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
+      transcriptionLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
     }
   }
 
@@ -148,6 +168,7 @@ const { class: className, ...props } = Astro.props;
     if (panels.right.type === 'CLMInputPanel') return 'clm_layout';
     if (panels.middle?.type === 'CLMInputPanel' && panels.right?.type === 'ContentDetailPanel') return 'file_table_layout';
     if (panels.right.type === 'MQTTDashboardPanel') return 'mqtt_dashboard_layout';
+    if (panels.right.type === 'TranscriptionPanel') return 'transcription_layout';
     return 'todo_layout';
   };
 
diff --git a/src/components/panels/TopBar.tsx b/src/components/panels/TopBar.tsx
index bca232d..1442bae 100644
--- a/src/components/panels/TopBar.tsx
+++ b/src/components/panels/TopBar.tsx
@@ -263,8 +263,9 @@ export const TopBar: React.FC<TopBarProps> = ({ initialTheme: initialPropTheme }
     const isLocalhost = window.location.hostname === 'localhost';
     
     // Hard code both values to ensure they match exactly what's configured in Authentik
-    const localRedirectUri = 'http://localhost:4321/callback'; // Hardcoded for local
-    const prodRedirectUri = 'http://todo.pkc.pub/callback'; // Hardcoded for production
+    // Changed to use the new auth-helper page instead of callback
+    const localRedirectUri = 'http://localhost:4321/auth-helper'; 
+    const prodRedirectUri = 'http://todo.pkc.pub/auth-helper';
     
     setRedirectUri(isLocalhost ? localRedirectUri : prodRedirectUri);
     
@@ -273,15 +274,74 @@ export const TopBar: React.FC<TopBarProps> = ({ initialTheme: initialPropTheme }
       usingUri: isLocalhost ? localRedirectUri : prodRedirectUri
     });
 
-    // Check for stored user info
-    const storedUserInfo = localStorage.getItem('authentik_top_banner_authuser_info');
-    const accessToken = localStorage.getItem('authentik_top_banner_authaccess_token');
-    const idToken = localStorage.getItem('authentik_top_banner_authid_token');
+    // Check for stored user info - try multiple possible storage keys
+    const authStorageKeyPrefix = import.meta.env.PUBLIC_AUTHENTIK_STORAGE_KEY_PREFIX || 'authentik_';
+    
+    // Define possible storage keys to check
+    const possibleUserInfoKeys = [
+      `${authStorageKeyPrefix}top_banner_authuser_info`,
+      `${authStorageKeyPrefix}user_info`,
+      `${authStorageKeyPrefix}user`,
+      'authentik_user_info',
+      'authentik_top_banner_authuser_info'
+    ];
+    
+    const possibleAccessTokenKeys = [
+      `${authStorageKeyPrefix}top_banner_authaccess_token`,
+      `${authStorageKeyPrefix}access_token`,
+      'authentik_access_token',
+      'authentik_top_banner_authaccess_token'
+    ];
+    
+    const possibleIdTokenKeys = [
+      `${authStorageKeyPrefix}top_banner_authid_token`,
+      `${authStorageKeyPrefix}id_token`,
+      'authentik_id_token',
+      'authentik_top_banner_authid_token'
+    ];
+    
+    // Search for user info in various storage keys
+    let storedUserInfo = null;
+    let accessToken = null;
+    let idToken = null;
+    
+    // Find user info from possible keys
+    for (const key of possibleUserInfoKeys) {
+      const value = localStorage.getItem(key);
+      if (value) {
+        storedUserInfo = value;
+        console.log('Found user info in key:', key);
+        break;
+      }
+    }
+    
+    // Find access token from possible keys
+    for (const key of possibleAccessTokenKeys) {
+      const value = localStorage.getItem(key);
+      if (value) {
+        accessToken = value;
+        console.log('Found access token in key:', key);
+        break;
+      }
+    }
+    
+    // Find ID token from possible keys
+    for (const key of possibleIdTokenKeys) {
+      const value = localStorage.getItem(key);
+      if (value) {
+        idToken = value;
+        console.log('Found ID token in key:', key);
+        break;
+      }
+    }
+    
+    // Dump all localStorage keys for debugging
+    console.log('All localStorage keys:', Object.keys(localStorage));
 
     console.log('Stored User Info:', {
-      userInfo: storedUserInfo,
-      accessToken,
-      idToken
+      userInfoFound: !!storedUserInfo,
+      accessTokenFound: !!accessToken,
+      idTokenFound: !!idToken
     });
 
     if (storedUserInfo) {
@@ -452,6 +512,14 @@ export const TopBar: React.FC<TopBarProps> = ({ initialTheme: initialPropTheme }
       
       const currentPath = window.location.pathname + window.location.search;
 
+      console.log('Starting authentication process with:', {
+        clientId: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID ? '[SET]' : '[NOT SET]',
+        clientSecret: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET ? '[SET]' : '[NOT SET]',
+        redirectUri,
+        baseUrl: import.meta.env.PUBLIC_AUTHENTIK_URL || '',
+        storageKeyPrefix: import.meta.env.PUBLIC_AUTHENTIK_STORAGE_KEY_PREFIX || 'authentik_'
+      });
+
       const client = createClient({
         clientId: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '',
         clientSecret: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET || '',
@@ -461,11 +529,32 @@ export const TopBar: React.FC<TopBarProps> = ({ initialTheme: initialPropTheme }
         storageKey: `${import.meta.env.PUBLIC_AUTHENTIK_STORAGE_KEY_PREFIX || 'authentik_'}top_banner_auth`,
       });
 
+      // Store the redirect URI in localStorage before redirecting
+      localStorage.setItem('authentik_last_redirect_uri', redirectUri);
+      
+      // Set a timestamp for debugging
+      localStorage.setItem('authentik_login_attempt_time', new Date().toISOString());
+
+      console.log('Initiating login redirect...');
       await client.login(currentPath);
+      
+      // This code will likely not execute as we're redirecting away
+      console.log('Login redirect initiated');
     } catch (error) {
       console.error('Login failed:', error);
       setLoading(false);
       
+      // Log detailed error info
+      console.error('Authentication error details:', {
+        error,
+        errorMessage: error instanceof Error ? error.message : 'Unknown error',
+        errorStack: error instanceof Error ? error.stack : 'No stack trace',
+        redirectUri,
+        clientIdConfigured: !!import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID,
+        clientSecretConfigured: !!import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET,
+        authUrlConfigured: !!import.meta.env.PUBLIC_AUTHENTIK_URL
+      });
+      
       // Fall back to mock login in development mode if there's an error
       if (import.meta.env.DEV || import.meta.env.MODE === 'development') {
         console.log('Development mode: Using mock authentication after error');
diff --git a/src/components/panels/TranscriptionPanel.tsx b/src/components/panels/TranscriptionPanel.tsx
new file mode 100644
index 0000000..b1c672e
--- /dev/null
+++ b/src/components/panels/TranscriptionPanel.tsx
@@ -0,0 +1,508 @@
+'use client';
+
+import React, { useState, useRef, useEffect } from 'react';
+import { useSelector, useDispatch } from 'react-redux';
+import { FiPlay, FiPause, FiUpload, FiX, FiCopy, FiSettings, FiSave } from 'react-icons/fi';
+
+/**
+ * TranscriptionPanel - A panel for audio transcription and management
+ * Supports uploading audio files, transcribing them, and editing/exporting the results
+ */
+export default function TranscriptionPanel() {
+  const dispatch = useDispatch();
+  // Audio state
+  const [audioFile, setAudioFile] = useState<File | null>(null);
+  const [audioUrl, setAudioUrl] = useState<string | null>(null);
+  const [isPlaying, setIsPlaying] = useState(false);
+  const [currentTime, setCurrentTime] = useState(0);
+  const [duration, setDuration] = useState(0);
+  const audioRef = useRef<HTMLAudioElement | null>(null);
+  
+  // Transcription state
+  const [transcription, setTranscription] = useState<string>('');
+  const [isTranscribing, setIsTranscribing] = useState(false);
+  const [transcriptionProgress, setTranscriptionProgress] = useState(0);
+  const [detectionMethod, setDetectionMethod] = useState<string>('');
+  
+  // UI state
+  const [showSettings, setShowSettings] = useState(false);
+  const [transcriptionModel, setTranscriptionModel] = useState<string>('whisper-1');
+  const [language, setLanguage] = useState<string>('auto');
+  const [processingPython, setProcessingPython] = useState(false);
+  const [pythonOutput, setPythonOutput] = useState<string>('');
+  
+  // Handle audio file upload
+  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
+    const files = e.target.files;
+    if (files && files.length > 0) {
+      const file = files[0];
+      
+      // Detection method tracking (similar to your file type detection system)
+      let method = 'extension_detection';
+      
+      // Log detailed file information for debugging
+      console.log('TranscriptionPanel - File selected:', {
+        name: file.name,
+        type: file.type,
+        size: file.size,
+        lastModified: new Date(file.lastModified).toISOString()
+      });
+      
+      // Validate file is audio
+      if (!file.type.startsWith('audio/')) {
+        console.warn('TranscriptionPanel - File may not be audio:', file.type);
+        method = 'assumed_audio_despite_mimetype';
+      }
+      
+      setAudioFile(file);
+      setDetectionMethod(method);
+      
+      // Create audio URL for playback
+      const url = URL.createObjectURL(file);
+      setAudioUrl(url);
+      
+      // Reset transcription state
+      setTranscription('');
+      setTranscriptionProgress(0);
+      setIsTranscribing(false);
+    }
+  };
+  
+  // Handle audio playback control
+  const togglePlayPause = () => {
+    if (audioRef.current) {
+      if (isPlaying) {
+        audioRef.current.pause();
+      } else {
+        audioRef.current.play();
+      }
+      setIsPlaying(!isPlaying);
+    }
+  };
+  
+  // Update time display during playback
+  const handleTimeUpdate = () => {
+    if (audioRef.current) {
+      setCurrentTime(audioRef.current.currentTime);
+    }
+  };
+  
+  // Set duration when metadata is loaded
+  const handleMetadataLoaded = () => {
+    if (audioRef.current) {
+      setDuration(audioRef.current.duration);
+    }
+  };
+  
+  // Handle seeking in the audio
+  const handleSeek = (e: React.ChangeEvent<HTMLInputElement>) => {
+    const seekTime = parseFloat(e.target.value);
+    setCurrentTime(seekTime);
+    if (audioRef.current) {
+      audioRef.current.currentTime = seekTime;
+    }
+  };
+  
+  // Start transcription process
+  const startTranscription = async () => {
+    if (!audioFile) return;
+    
+    setIsTranscribing(true);
+    setTranscriptionProgress(0);
+    
+    try {
+      // Mock transcription process - in a real app, you'd call an API here
+      // This simulates a call to OpenAI's Whisper API or similar
+      console.log('TranscriptionPanel - Starting transcription with settings:', {
+        model: transcriptionModel,
+        language: language,
+        fileSize: audioFile.size,
+        detectionMethod
+      });
+      
+      // Simulate progress updates
+      const totalSteps = 10;
+      for (let i = 1; i <= totalSteps; i++) {
+        await new Promise(resolve => setTimeout(resolve, 500));
+        setTranscriptionProgress(i * (100 / totalSteps));
+      }
+      
+      // Mock result based on filename
+      const mockTranscription = `This is a simulated transcription of the audio file "${audioFile.name}". 
+In a real implementation, this would be replaced with actual transcribed content from an API like OpenAI's Whisper.
+The transcription would include timestamps and speaker identification if available.
+
+[00:00:00] Speaker 1: This is the first part of the transcription.
+[00:00:05] Speaker 2: This is a response in the conversation.
+[00:00:10] Speaker 1: This demonstrates how the actual transcription would be formatted.
+`;
+      
+      setTranscription(mockTranscription);
+    } catch (error) {
+      console.error('TranscriptionPanel - Transcription error:', error);
+    } finally {
+      setIsTranscribing(false);
+      setTranscriptionProgress(100);
+    }
+  };
+  
+  // Handle running Python script
+  const runPythonTranscriber = async () => {
+    setProcessingPython(true);
+    setPythonOutput('Starting Python script...\n');
+    
+    try {
+      // Use the simplified API endpoint that just runs an echo command for now
+      const apiUrl = `/api/run-script`;
+      
+      console.log('TranscriptionPanel - Calling script API endpoint');
+      
+      try {
+        const response = await fetch(apiUrl, {
+          method: 'POST',
+          headers: {
+            'Content-Type': 'application/json',
+          },
+          body: JSON.stringify({})
+        });
+        
+        console.log('TranscriptionPanel - API response status:', response.status);
+        
+        if (!response.ok) {
+          throw new Error(`Server responded with status: ${response.status}`);
+        }
+        
+        const data = await response.json();
+        
+        // Display execution info
+        if (data.executionMethod) {
+          setPythonOutput(prev => 
+            `${prev}\nExecution method: ${data.executionMethod}\n\n`
+          );
+        }
+        
+        // Handle successful execution
+        if (data.success) {
+          // Display the actual Python script output
+          setPythonOutput(prev => prev + (data.output || 'No output returned from server.'));
+          
+          if (data.errorOutput && data.errorOutput.trim()) {
+            setPythonOutput(prev => prev + `\n\nStderr output:\n${data.errorOutput}`);
+          }
+        } else {
+          // Handle error in execution
+          setPythonOutput(prev => 
+            prev + `\nError executing script: ${data.error || 'Unknown error'}\n` +
+            (data.errorOutput ? `\nError details:\n${data.errorOutput}` : '')
+          );
+        }
+      } catch (fetchError) {
+        console.error('Error making API call:', fetchError);
+        setPythonOutput(prev => prev + `\nError calling API: ${fetchError}\n\nFalling back to simulated output...\n`);
+        
+        // Fallback to simulation for demo purposes
+        await simulateTranscription();
+      }
+    } catch (error) {
+      console.error('Error running Python script:', error);
+      setPythonOutput(prev => prev + `\nError: ${error}\n`);
+    } finally {
+      setProcessingPython(false);
+    }
+  };
+  
+  // Simulate the transcription process for demo purposes
+  const simulateTranscription = async () => {
+    setPythonOutput(prev => prev + 'Activating virtual environment...\n');
+    await new Promise(resolve => setTimeout(resolve, 500));
+    
+    setPythonOutput(prev => prev + 'Loading Whisper model...\n');
+    await new Promise(resolve => setTimeout(resolve, 1000));
+    
+    setPythonOutput(prev => prev + 'Large Whisper model loaded!\n');
+    await new Promise(resolve => setTimeout(resolve, 500));
+    
+    setPythonOutput(prev => prev + 'Listing all files in the audio directory:\n');
+    await new Promise(resolve => setTimeout(resolve, 300));
+    
+    setPythonOutput(prev => prev + 'Found 2 audio files\nFound 1 video files\n');
+    await new Promise(resolve => setTimeout(resolve, 700));
+    
+    setPythonOutput(prev => prev + 'Attempting to extract audio from video...\n');
+    await new Promise(resolve => setTimeout(resolve, 1000));
+    
+    setPythonOutput(prev => prev + 'Processing audio files: 100%|████████████████| 3/3 [00:42<00:00, 14.12s/it]\n');
+    await new Promise(resolve => setTimeout(resolve, 500));
+    
+    setPythonOutput(prev => prev + 'Transcribing complete. Results saved to /data/processed/transcript/\n');
+  };
+  
+  // Format time display
+  const formatTime = (seconds: number) => {
+    const minutes = Math.floor(seconds / 60);
+    const remainingSeconds = Math.floor(seconds % 60);
+    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
+  };
+
+  // Copy transcription to clipboard
+  const copyTranscription = () => {
+    navigator.clipboard.writeText(transcription);
+    // You could add a toast notification here
+    console.log('TranscriptionPanel - Transcription copied to clipboard');
+  };
+  
+  // Save transcription to file
+  const saveTranscription = () => {
+    if (!transcription) return;
+    
+    const element = document.createElement('a');
+    const file = new Blob([transcription], {type: 'text/plain'});
+    element.href = URL.createObjectURL(file);
+    
+    // Generate filename based on original audio file
+    const baseName = audioFile ? audioFile.name.replace(/\.[^/.]+$/, "") : 'transcription';
+    element.download = `${baseName}_transcription.txt`;
+    
+    document.body.appendChild(element);
+    element.click();
+    document.body.removeChild(element);
+    
+    console.log('TranscriptionPanel - Transcription saved to file');
+  };
+  
+  // Cleanup when component unmounts
+  useEffect(() => {
+    return () => {
+      if (audioUrl) {
+        URL.revokeObjectURL(audioUrl);
+      }
+    };
+  }, [audioUrl]);
+  
+  return (
+    <div className="h-full flex flex-col w-full overflow-hidden">
+      {/* Header with title and options */}
+      <div className="p-3 border-b bg-gray-100 flex justify-between items-center">
+        <h2 className="text-lg font-semibold">Audio Transcription</h2>
+        <div className="flex items-center space-x-2">
+          <button 
+            onClick={runPythonTranscriber}
+            disabled={processingPython}
+            className={`mr-2 py-1 px-3 rounded text-white ${processingPython ? 'bg-gray-400' : 'bg-blue-500 hover:bg-blue-600'} text-sm`}
+          >
+            {processingPython ? 'Running...' : 'Run Python Script'}
+          </button>
+          <button 
+            onClick={() => setShowSettings(!showSettings)}
+            className="p-2 rounded hover:bg-gray-200"
+            title="Transcription Settings"
+          >
+            <FiSettings />
+          </button>
+        </div>
+      </div>
+      
+      {/* Python output - showing outside of file upload area */}
+      {pythonOutput && (
+        <div className="border-b p-4">
+          <div className="flex justify-between items-center mb-2">
+            <h3 className="font-medium">Python Script Output</h3>
+            <button 
+              onClick={() => setPythonOutput('')}
+              className="text-gray-500 hover:text-red-500 text-sm"
+            >
+              Clear
+            </button>
+          </div>
+          <pre className="whitespace-pre-wrap font-mono text-sm p-3 bg-gray-50 rounded border max-h-40 overflow-auto">
+            {pythonOutput}
+          </pre>
+        </div>
+      )}
+      
+      {/* Settings panel (conditionally rendered) */}
+      {showSettings && (
+        <div className="p-4 border-b">
+          <h3 className="font-medium mb-2">Transcription Settings</h3>
+          <div className="grid grid-cols-2 gap-4">
+            <div>
+              <label className="block text-sm text-gray-600 mb-1">Model</label>
+              <select 
+                value={transcriptionModel}
+                onChange={(e) => setTranscriptionModel(e.target.value)}
+                className="w-full p-2 border rounded"
+              >
+                <option value="whisper-1">Whisper (Standard)</option>
+                <option value="whisper-large">Whisper (Large)</option>
+              </select>
+            </div>
+            <div>
+              <label className="block text-sm text-gray-600 mb-1">Language</label>
+              <select 
+                value={language}
+                onChange={(e) => setLanguage(e.target.value)}
+                className="w-full p-2 border rounded"
+              >
+                <option value="auto">Auto-detect</option>
+                <option value="en">English</option>
+                <option value="zh">Chinese</option>
+                <option value="es">Spanish</option>
+                <option value="fr">French</option>
+                <option value="de">German</option>
+                <option value="ja">Japanese</option>
+                <option value="ko">Korean</option>
+              </select>
+            </div>
+          </div>
+        </div>
+      )}
+      
+      {/* File upload area */}
+      {!audioFile && (
+        <div className="flex-1 flex items-center justify-center p-6">
+          <div className="text-center">
+            <div className="mb-4">
+              <FiUpload className="mx-auto text-4xl text-gray-400" />
+            </div>
+            <p className="text-lg mb-6">Upload an audio file to transcribe</p>
+            <label className="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded cursor-pointer">
+              Select Audio File
+              <input 
+                type="file" 
+                accept="audio/*" 
+                onChange={handleFileUpload} 
+                className="hidden" 
+              />
+            </label>
+            <p className="mt-3 text-sm text-gray-500">
+              Supports MP3, WAV, M4A, and other audio formats
+            </p>
+          </div>
+        </div>
+      )}
+      
+      {/* Audio player and transcription area */}
+      {audioFile && (
+        <div className="flex-1 flex flex-col overflow-hidden">
+          {/* Audio player */}
+          <div className="p-4 border-b">
+            <div className="flex items-center mb-2">
+              <h3 className="font-medium flex-1 truncate" title={audioFile.name}>
+                {audioFile.name}
+              </h3>
+              <button 
+                onClick={() => {
+                  setAudioFile(null);
+                  setAudioUrl(null);
+                  setTranscription('');
+                }}
+                className="text-gray-500 hover:text-red-500"
+                title="Remove audio"
+              >
+                <FiX />
+              </button>
+            </div>
+            
+            <div className="flex items-center mb-2">
+              <button 
+                onClick={togglePlayPause} 
+                className="mr-3 p-2 bg-gray-200 rounded-full hover:bg-gray-300"
+              >
+                {isPlaying ? <FiPause /> : <FiPlay />}
+              </button>
+              
+              <div className="flex-1 flex items-center">
+                <span className="text-sm text-gray-600 mr-2">{formatTime(currentTime)}</span>
+                <input 
+                  type="range" 
+                  min="0" 
+                  max={duration || 0} 
+                  value={currentTime}
+                  onChange={handleSeek}
+                  className="flex-1"
+                />
+                <span className="text-sm text-gray-600 ml-2">{formatTime(duration)}</span>
+              </div>
+            </div>
+            
+            <audio 
+              ref={audioRef}
+              src={audioUrl || ''} 
+              onTimeUpdate={handleTimeUpdate}
+              onLoadedMetadata={handleMetadataLoaded}
+              onEnded={() => setIsPlaying(false)}
+              className="hidden"
+            />
+            
+            {/* Transcription button */}
+            <div className="mt-3">
+              <button 
+                onClick={startTranscription}
+                disabled={isTranscribing}
+                className={`py-2 px-4 rounded text-white ${isTranscribing ? 'bg-gray-400' : 'bg-blue-500 hover:bg-blue-600'}`}
+              >
+                {isTranscribing ? 'Transcribing...' : 'Start Transcription'}
+              </button>
+              
+              {detectionMethod && (
+                <div className="mt-1 text-xs text-gray-500">
+                  Detection method: {detectionMethod}
+                </div>
+              )}
+            </div>
+            
+            {/* Progress bar */}
+            {isTranscribing && (
+              <div className="mt-3">
+                <div className="h-2 bg-gray-200 rounded-full">
+                  <div 
+                    className="h-2 bg-blue-500 rounded-full" 
+                    style={{ width: `${transcriptionProgress}%` }}
+                  ></div>
+                </div>
+                <div className="text-xs text-center mt-1 text-gray-500">
+                  {Math.round(transcriptionProgress)}% complete
+                </div>
+              </div>
+            )}
+          </div>
+          
+          {/* Transcription display */}
+          <div className="flex-1 overflow-auto p-4">
+            {transcription ? (
+              <div className="relative">
+                <div className="absolute top-0 right-0 flex">
+                  <button 
+                    onClick={copyTranscription}
+                    className="p-2 text-gray-500 hover:text-blue-500"
+                    title="Copy to clipboard"
+                  >
+                    <FiCopy />
+                  </button>
+                  <button 
+                    onClick={saveTranscription}
+                    className="p-2 text-gray-500 hover:text-blue-500"
+                    title="Save as file"
+                  >
+                    <FiSave />
+                  </button>
+                </div>
+                <pre className="whitespace-pre-wrap font-mono text-sm p-4 bg-gray-50 rounded border mt-2">
+                  {transcription}
+                </pre>
+              </div>
+            ) : (
+              <div className="text-center text-gray-500 h-full flex items-center justify-center">
+                <p>
+                  {isTranscribing 
+                    ? 'Transcribing audio...' 
+                    : 'Transcription will appear here after processing'}
+                </p>
+              </div>
+            )}
+          </div>
+        </div>
+      )}
+    </div>
+  );
+}
diff --git a/src/components/panels/panels.json b/src/components/panels/panels.json
index 8b256e8..4c7437b 100644
--- a/src/components/panels/panels.json
+++ b/src/components/panels/panels.json
@@ -46,5 +46,8 @@
   },
   "MQTTDashboardPanel": {
     "component": "../components/panels/MQTTDashboardPanel.jsx"
+  },
+  "TranscriptionPanel": {
+    "component": "../components/panels/TranscriptionPanel.tsx"
   }
 }
diff --git a/src/features/panellayoutSlice.json b/src/features/panellayoutSlice.json
index 084e841..49e8f75 100644
--- a/src/features/panellayoutSlice.json
+++ b/src/features/panellayoutSlice.json
@@ -98,5 +98,25 @@
             "minSize": 0,
             "visible": false
         }
+    },
+    "transcription_layout": {
+        "left": {
+            "type": "FileTablePanel",
+            "size": 30,
+            "minSize": 20,
+            "visible": true
+        },
+        "middle": {
+            "type": "ContentViewerPanel", 
+            "size": 0,
+            "minSize": 0,
+            "visible": false
+        },
+        "right": {
+            "type": "TranscriptionPanel",
+            "size": 70,
+            "minSize": 50,
+            "visible": true
+        }
     }
 }
diff --git a/src/lib/authentik/client.ts b/src/lib/authentik/client.ts
index ef87c9a..e209916 100644
--- a/src/lib/authentik/client.ts
+++ b/src/lib/authentik/client.ts
@@ -88,7 +88,13 @@ export function createClient(config: AuthentikClientConfig) {
     }
   };
 
-  const handleCallback = async (code: string) => {
+  const handleCallback = async (code: string): Promise<UserInfo> => {
+    console.log('AUTHENTIK DEBUG: handleCallback START', {
+      code: code.substring(0, 5) + '...',
+      storageKey,
+      baseUrl: (baseUrl || '').toString().replace(/\/+$/, '')
+    });
+
     try {
       // Ensure baseUrl is a string and remove trailing slashes
       const sanitizedBaseUrl = (baseUrl || '').toString().replace(/\/+$/, '');
@@ -99,6 +105,7 @@ export function createClient(config: AuthentikClientConfig) {
 
       // Validate input parameters
       if (!code) {
+        console.error('AUTHENTIK ERROR: No authorization code provided');
         throw new Error('Authorization code is required');
       }
       if (!clientId) {
@@ -108,6 +115,7 @@ export function createClient(config: AuthentikClientConfig) {
         throw new Error('Client Secret is required');
       }
       if (!redirectUri) {
+        console.error('AUTHENTIK ERROR: No redirect URI provided');
         throw new Error('Redirect URI is required');
       }
 
@@ -127,18 +135,17 @@ export function createClient(config: AuthentikClientConfig) {
         clientSecretLength: clientSecret.length
       });
 
-      // Prepare token exchange parameters with explicit encoding
+      // Detailed logging of parameters for token exchange
       const tokenParams = new URLSearchParams();
       tokenParams.append('client_id', clientId);
       tokenParams.append('client_secret', clientSecret);
       tokenParams.append('redirect_uri', hardcodedRedirectUri);
       tokenParams.append('grant_type', 'authorization_code');
       tokenParams.append('code', code);
-
-      // Log the exact parameters being sent
-      console.log('DEBUG TOKEN EXCHANGE PARAMS:', {
-        params: Object.fromEntries(tokenParams.entries())
-      });
+      
+      console.log('DEBUG TOKEN EXCHANGE PARAMS:', 
+        Object.fromEntries(tokenParams.entries())
+      );
 
       let tokenResponse;
       try {
@@ -172,61 +179,100 @@ export function createClient(config: AuthentikClientConfig) {
         throw new Error(`Network error during token exchange: ${errorDetails.errorMessage}`);
       }
 
-      // Log full response details for debugging
-      const responseHeaders = Object.fromEntries(tokenResponse.headers.entries());
-      const responseStatus = {
-        ok: tokenResponse.ok,
-        status: tokenResponse.status,
-        statusText: tokenResponse.statusText
-      };
-
-      console.log('Token Exchange Response Details:', {
-        ...responseStatus,
-        headers: responseHeaders
-      });
-
-      if (!tokenResponse.ok) {
-        const errorText = await tokenResponse.text();
-        console.error('Token Exchange Error:', {
+      // Add a try-catch around the entire token response handling
+      let responseData;
+      try {
+        const responseHeaders = Object.fromEntries(tokenResponse.headers.entries());
+        const responseStatus = {
+          ok: tokenResponse.ok,
           status: tokenResponse.status,
-          statusText: tokenResponse.statusText,
-          errorBody: errorText,
-          requestParams: Object.fromEntries(tokenParams)
-        });
-        throw new Error(`Failed to exchange authorization code. Status: ${tokenResponse.status}, Error: ${errorText}`);
-      }
+          statusText: tokenResponse.statusText
+        };
 
-      let tokens;
-      try {
-        tokens = await tokenResponse.json();
-        console.log('Token Response Parsed:', {
-          hasAccessToken: !!tokens.access_token,
-          hasIdToken: !!tokens.id_token,
-          tokenKeys: Object.keys(tokens)
+        console.log('Token Exchange Response Details:', {
+          ...responseStatus,
+          headers: responseHeaders
         });
-      } catch (parseError: unknown) {
-        const errorDetails = parseError instanceof Error 
-          ? {
-              errorName: parseError.name,
-              errorMessage: parseError.message,
-              errorStack: parseError.stack
-            }
-          : {
-              errorName: 'Unknown Parse Error',
-              errorMessage: String(parseError),
-              errorStack: null
-            };
 
-        console.error('Token Parse Error:', errorDetails);
-        throw new Error(`Failed to parse token response: ${errorDetails.errorMessage}`);
+        if (!tokenResponse.ok) {
+          const errorText = await tokenResponse.text();
+          console.error('Token Exchange Error:', {
+            status: tokenResponse.status,
+            statusText: tokenResponse.statusText,
+            errorBody: errorText,
+            requestParams: Object.fromEntries(tokenParams)
+          });
+          throw new Error(`Failed to exchange authorization code. Status: ${tokenResponse.status}, Error: ${errorText}`);
+        }
+
+        // Try to get the response as text first to inspect it
+        const responseText = await tokenResponse.text();
+        console.log('Raw token response text:', responseText.substring(0, 200) + '...');
+        
+        try {
+          // Then parse it as JSON
+          responseData = JSON.parse(responseText);
+          console.log('Token response successfully parsed:', {
+            dataReceived: !!responseData,
+            responseKeys: responseData ? Object.keys(responseData) : []
+          });
+          
+          // Direct storage of tokens in localStorage
+          if (responseData && typeof responseData === 'object') {
+            try {
+              // Store auth tokens immediately to prevent loss
+              const authStorageKeyPrefix = 'authentik_';
+              
+              // Store all token response data
+              localStorage.setItem(`${authStorageKeyPrefix}token_response`, JSON.stringify(responseData));
+              
+              // Store access token if available
+              if (responseData.access_token) {
+                localStorage.setItem(`${authStorageKeyPrefix}access_token`, responseData.access_token);
+                localStorage.setItem(`${authStorageKeyPrefix}top_banner_authaccess_token`, responseData.access_token);
+                console.log('Access token stored directly in localStorage during token exchange');
+              }
+              
+              // Store ID token if available
+              if (responseData.id_token) {
+                localStorage.setItem(`${authStorageKeyPrefix}id_token`, responseData.id_token);
+                localStorage.setItem(`${authStorageKeyPrefix}top_banner_authid_token`, responseData.id_token);
+                console.log('ID token stored directly in localStorage during token exchange');
+              }
+              
+              // Store redirect path
+              localStorage.setItem(`${authStorageKeyPrefix}top_banner_authredirect_uri`, '/Page');
+              
+              console.log('Token data stored in localStorage with keys:', 
+                Object.keys(localStorage).filter(k => k.includes(authStorageKeyPrefix))
+              );
+            } catch (storageError) {
+              console.error('Error storing token data in localStorage:', storageError);
+            }
+          }
+        } catch (jsonError) {
+          console.error('Error parsing token response JSON:', {
+            error: jsonError instanceof Error ? jsonError.message : String(jsonError),
+            responseText: responseText.substring(0, 200) + '...'
+          });
+          throw new Error(`Error parsing token response: ${jsonError instanceof Error ? jsonError.message : String(jsonError)}`);
+        }
+      } catch (textError) {
+        console.error('Error reading token response body:', textError);
+        throw new Error('Failed to read token response body');
       }
       
+      // Continue with the tokens
+      const tokens = responseData;
+      
       // Validate tokens
       if (!tokens.access_token) {
+        console.error('No access token received in response:', tokens);
         throw new Error('No access token received');
       }
 
       // Store tokens
+      console.log('Storing tokens with key prefix:', storageKey);
       localStorage.setItem(`${storageKey}access_token`, tokens.access_token);
       localStorage.setItem(`${storageKey}id_token`, tokens.id_token || '');
 
@@ -271,14 +317,24 @@ export function createClient(config: AuthentikClientConfig) {
         userInfoKeys: Object.keys(userInfo)
       });
 
+      // Store user info in localStorage with the configured key
       localStorage.setItem(`${storageKey}user_info`, JSON.stringify(userInfo));
+      
+      // Also store tokens with the user info for convenience
+      const combinedUserInfo = {
+        ...userInfo,
+        access_token: tokens.access_token,
+        id_token: tokens.id_token || '',
+        token_type: tokens.token_type || 'Bearer'
+      };
+      
+      // Store the combined user info for easier access
+      localStorage.setItem(`${storageKey}user_info`, JSON.stringify(combinedUserInfo));
 
-      // Redirect to the specific page
-      if (typeof window !== 'undefined') {
-        window.location.href = `${window.location.origin}/Page`;
-      }
-
-      return userInfo;
+      // Remove the problematic automatic redirect that was breaking the flow
+      // Let the callback.astro page handle the redirect instead
+      
+      return combinedUserInfo;
     } catch (error: unknown) {
       const errorDetails = error instanceof Error 
         ? {
diff --git a/src/pages/Transcription.astro b/src/pages/Transcription.astro
new file mode 100644
index 0000000..a39d3f3
--- /dev/null
+++ b/src/pages/Transcription.astro
@@ -0,0 +1,14 @@
+---
+import Layout from '../layouts/BaseLayout.astro';
+import TranscriptionPanel from '../components/panels/TranscriptionPanel';
+---
+
+<Layout title="Transcription - PKC">
+  <div class="h-screen flex flex-col overflow-hidden">
+    <main class="flex-1 overflow-hidden">
+      <div class="h-full">
+        <TranscriptionPanel client:load />
+      </div>
+    </main>
+  </div>
+</Layout>
diff --git a/src/pages/api/run-script.js b/src/pages/api/run-script.js
new file mode 100644
index 0000000..860a4b1
--- /dev/null
+++ b/src/pages/api/run-script.js
@@ -0,0 +1,82 @@
+// Simple API endpoint to run the transcription script
+// Using proper Astro API route syntax
+
+export async function POST({ request }) {
+  console.log('run-script API endpoint called');
+  
+  try {
+    // Import modules dynamically to avoid SSR issues
+    const { exec } = await import('child_process');
+    const { promisify } = await import('util');
+    const { fileURLToPath } = await import('url');
+    const path = await import('path');
+    
+    const execPromise = promisify(exec);
+    
+    // Get the project root directory
+    const __filename = fileURLToPath(import.meta.url);
+    const __dirname = path.default.dirname(__filename);
+    const projectRoot = path.default.resolve(__dirname, '../../../');
+    
+    // Execute our shell script (similar to your content detection method)
+    const command = `${projectRoot}/run-transcriber.sh`;
+    console.log('Executing command:', command);
+    
+    try {
+      const { stdout, stderr } = await execPromise(command);
+      
+      console.log('Script executed successfully', {
+        stdoutLength: stdout.length,
+        stderrLength: stderr.length
+      });
+      
+      return new Response(
+        JSON.stringify({
+          success: true,
+          output: stdout,
+          errorOutput: stderr,
+          detectionMethod: 'shell_script'
+        }),
+        {
+          status: 200,
+          headers: {
+            "Content-Type": "application/json"
+          }
+        }
+      );
+    } catch (execError) {
+      console.error('Script execution error:', execError);
+      
+      return new Response(
+        JSON.stringify({
+          success: false,
+          error: execError.message,
+          errorOutput: execError.stderr,
+          detectionMethod: 'execution_failed'
+        }),
+        {
+          status: 500,
+          headers: {
+            "Content-Type": "application/json"
+          }
+        }
+      );
+    }
+  } catch (error) {
+    console.error('API general error:', error);
+    
+    return new Response(
+      JSON.stringify({
+        success: false,
+        error: String(error),
+        detectionMethod: 'error_in_processing'
+      }),
+      {
+        status: 500,
+        headers: {
+          "Content-Type": "application/json"
+        }
+      }
+    );
+  }
+}
diff --git a/src/pages/api/transcribe.js b/src/pages/api/transcribe.js
new file mode 100644
index 0000000..eaf6411
--- /dev/null
+++ b/src/pages/api/transcribe.js
@@ -0,0 +1,102 @@
+// API endpoint to run Python transcription script
+// Using proper Astro API route syntax - default export with POST, GET, etc. methods
+
+export async function POST({ request }) {
+  console.log('Transcription API endpoint called with POST method');
+  
+  try {
+    const { exec } = await import('child_process');
+    const { promisify } = await import('util');
+    const { fileURLToPath } = await import('url');
+    const path = await import('path');
+    
+    const execPromise = promisify(exec);
+    
+    // Track detection and execution methods (like your file detection system)
+    let executionMethod = 'direct_execution';
+    const startTime = Date.now();
+    
+    // Get file paths
+    const __filename = fileURLToPath(import.meta.url);
+    const __dirname = path.default.dirname(__filename);
+    const projectRoot = path.default.resolve(__dirname, '../../../');
+    const scriptDir = path.default.join(projectRoot, 'Docs', 'to-do-plan');
+    
+    console.log('Transcription API - Path detection:', {
+      projectRoot,
+      scriptDir,
+      detectionTime: Date.now() - startTime
+    });
+    
+    // Construct command with proper environment setup
+    const command = `cd "${scriptDir}" && source venv/bin/activate && python generator/audio_transcriber.py`;
+    
+    console.log('Transcription API - Executing command:', command);
+    
+    try {
+      // Execute the command
+      const { stdout, stderr } = await execPromise(command);
+      const executionTime = Date.now() - startTime;
+      
+      console.log('Transcription API - Execution completed:', {
+        executionTimeMs: executionTime,
+        stdoutLength: stdout.length,
+        stderrLength: stderr.length,
+        executionMethod
+      });
+      
+      return new Response(
+        JSON.stringify({
+          success: true,
+          output: stdout,
+          errorOutput: stderr,
+          executionTime,
+          executionMethod
+        }),
+        {
+          status: 200,
+          headers: {
+            "Content-Type": "application/json"
+          }
+        }
+      );
+    } catch (execError) {
+      console.error('Transcription API - Execution error:', {
+        error: execError.message,
+        command,
+        errorOutput: execError.stderr
+      });
+      
+      return new Response(
+        JSON.stringify({
+          success: false,
+          error: execError.message,
+          errorOutput: execError.stderr,
+          executionMethod: 'execution_failed'
+        }),
+        {
+          status: 500,
+          headers: {
+            "Content-Type": "application/json"
+          }
+        }
+      );
+    }
+  } catch (error) {
+    console.error('Transcription API - General error:', error);
+    
+    return new Response(
+      JSON.stringify({
+        success: false,
+        error: String(error),
+        executionMethod: 'error_in_processing'
+      }),
+      {
+        status: 500,
+        headers: {
+          "Content-Type": "application/json"
+        }
+      }
+    );
+  }
+}
diff --git a/src/pages/auth-helper.astro b/src/pages/auth-helper.astro
new file mode 100644
index 0000000..918f14e
--- /dev/null
+++ b/src/pages/auth-helper.astro
@@ -0,0 +1,173 @@
+---
+---
+
+<html lang="en">
+<head>
+  <meta charset="UTF-8">
+  <meta name="viewport" content="width=device-width, initial-scale=1.0">
+  <title>Authentication Helper</title>
+</head>
+<body>
+  <h1>Processing Authentication...</h1>
+  <p>This page will redirect you automatically.</p>
+
+  <script is:inline>
+    // Immediately execute
+    (async function() {
+      console.log("AUTH HELPER: Script started");
+      
+      // Directly set the redirect path without waiting for authentication
+      try {
+        const prefix = 'authentik_';
+        localStorage.setItem(`${prefix}top_banner_authredirect_uri`, '/Page');
+        
+        // Store basic authentication state
+        localStorage.setItem(`${prefix}auth_state`, JSON.stringify({
+          isAuthenticated: true,
+          redirectPath: '/Page',
+          timestamp: new Date().toISOString()
+        }));
+        
+        console.log("AUTH HELPER: Stored authentication state and redirect path");
+        
+        // Extract and store the code if available
+        const urlParams = new URLSearchParams(window.location.search);
+        const code = urlParams.get('code');
+        if (code) {
+          localStorage.setItem(`${prefix}auth_code`, code);
+          console.log("AUTH HELPER: Stored auth code");
+          
+          // Process the authentication code to get tokens and user info
+          try {
+            // Determine if we're on localhost or production
+            const isLocalhost = window.location.hostname === 'localhost';
+            const redirectUri = isLocalhost ? 'http://localhost:4321/auth-helper' : 'http://todo.pkc.pub/auth-helper';
+            
+            // Directly fetch tokens from Authentik without using the client library
+            const baseUrl = isLocalhost ? 'http://localhost:9000' : 'https://authentik.pkc.pub';
+            const tokenUrl = `${baseUrl}/application/o/token/`;
+            
+            console.log("AUTH HELPER: Fetching tokens from", tokenUrl);
+            
+            // Create token request parameters
+            const tokenParams = new URLSearchParams();
+            tokenParams.append('grant_type', 'authorization_code');
+            tokenParams.append('code', code);
+            tokenParams.append('redirect_uri', redirectUri);
+            tokenParams.append('client_id', 'GzpEscRHZVgojA96XwwIiBwlWUfxr1Y43SH4zKDw');
+            tokenParams.append('client_secret', 'QcPPsYeV2T3Fci2sXe52yJHGYuVhNFKOBK2Fc01rPRICCdAu1CbmcBfV1W3G7nPFu3wTgfnA1cwyJQDFFiMrhQCgWS7PcVFFnYmIZh5q6w6xvn0gB1nUCWOuiAHZxCSk');
+            
+            const tokenResponse = await fetch(tokenUrl, {
+              method: 'POST',
+              headers: {
+                'Content-Type': 'application/x-www-form-urlencoded',
+                'Accept': 'application/json'
+              },
+              body: tokenParams.toString()
+            });
+            
+            console.log("AUTH HELPER: Token response status", tokenResponse.status);
+            
+            if (tokenResponse.ok) {
+              const tokenData = await tokenResponse.json();
+              console.log("AUTH HELPER: Received token data with keys", Object.keys(tokenData));
+              
+              // Store tokens
+              if (tokenData.access_token) {
+                localStorage.setItem(`${prefix}access_token`, tokenData.access_token);
+                localStorage.setItem(`${prefix}top_banner_authaccess_token`, tokenData.access_token);
+              }
+              
+              if (tokenData.id_token) {
+                localStorage.setItem(`${prefix}id_token`, tokenData.id_token);
+                localStorage.setItem(`${prefix}top_banner_authid_token`, tokenData.id_token);
+              }
+              
+              // Fetch user info using the access token
+              try {
+                const userInfoUrl = `${baseUrl}/application/o/userinfo/`;
+                console.log("AUTH HELPER: Fetching user info from", userInfoUrl);
+                
+                const userInfoResponse = await fetch(userInfoUrl, {
+                  headers: {
+                    'Authorization': `Bearer ${tokenData.access_token}`,
+                    'Accept': 'application/json'
+                  }
+                });
+                
+                if (userInfoResponse.ok) {
+                  const userInfo = await userInfoResponse.json();
+                  console.log("AUTH HELPER: Received user info with keys", Object.keys(userInfo));
+                  
+                  // Combine token and user info
+                  const combinedUserInfo = {
+                    ...userInfo,
+                    access_token: tokenData.access_token,
+                    id_token: tokenData.id_token,
+                    token_type: tokenData.token_type,
+                    expires_in: tokenData.expires_in,
+                    token_source: 'auth_helper',
+                    detection_method: 'direct_authentik_api'
+                  };
+                  
+                  // Store complete user info
+                  localStorage.setItem(`${prefix}user_info`, JSON.stringify(combinedUserInfo));
+                  localStorage.setItem(`${prefix}top_banner_authuser_info`, JSON.stringify(combinedUserInfo));
+                  
+                  console.log("AUTH HELPER: Stored combined user info");
+                  
+                  // Dispatch to Redux store if available
+                  if (typeof window !== 'undefined' && window.store && window.store.dispatch) {
+                    console.log("AUTH HELPER: Dispatching to Redux store");
+                    
+                    const loginPayload = {
+                      isAuthenticated: true,
+                      profile: {
+                        email: userInfo.email,
+                        email_verified: userInfo.email_verified,
+                        sub: userInfo.sub,
+                        name: userInfo.name,
+                        given_name: userInfo.given_name,
+                        family_name: userInfo.family_name,
+                        nickname: userInfo.nickname,
+                        preferred_username: userInfo.preferred_username,
+                        groups: userInfo.groups || [],
+                        picture: userInfo.picture
+                      },
+                      tokens: {
+                        access_token: tokenData.access_token,
+                        id_token: tokenData.id_token,
+                        token_type: tokenData.token_type || 'Bearer',
+                        expires_at: tokenData.expires_in ? new Date(Date.now() + tokenData.expires_in * 1000).toISOString() : null
+                      }
+                    };
+                    
+                    window.store.dispatch({ type: 'user/login', payload: loginPayload });
+                  }
+                } else {
+                  console.error("AUTH HELPER: Failed to fetch user info", await userInfoResponse.text());
+                }
+              } catch (userInfoError) {
+                console.error("AUTH HELPER: Error fetching user info", userInfoError);
+              }
+            } else {
+              console.error("AUTH HELPER: Token request failed", await tokenResponse.text());
+            }
+          } catch (tokenError) {
+            console.error("AUTH HELPER: Token processing error", tokenError);
+          }
+        }
+      } catch (error) {
+        console.error("AUTH HELPER: Storage error", error);
+      }
+      
+      // Always redirect to /Page after a reasonable timeout
+      // This ensures the page redirects even if there are errors in processing
+      setTimeout(() => {
+        console.log("AUTH HELPER: Redirecting to /Page");
+        window.location.href = '/Page';
+      }, 3000); // Increased timeout to allow token processing
+    })();
+  </script>
+</body>
+</html>
diff --git a/src/pages/auth-test.astro b/src/pages/auth-test.astro
deleted file mode 100644
index 14dcea3..0000000
--- a/src/pages/auth-test.astro
+++ /dev/null
@@ -1,154 +0,0 @@
----
-import Layout from '../layouts/BaseLayout.astro';
----
-
-<Layout title="Authentication Test">
-  <div class="container mx-auto p-8">
-    <h1 class="text-3xl font-bold mb-6">Authentik Direct Authentication Test</h1>
-    
-    <div class="bg-blue-50 p-6 rounded-lg mb-8">
-      <h2 class="text-xl font-semibold mb-4">Test Authentication</h2>
-      <div id="auth-info" class="mb-4 whitespace-pre bg-white p-4 rounded text-sm font-mono overflow-auto max-h-60"></div>
-      <button id="test-auth" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
-        Test Direct Authentication
-      </button>
-    </div>
-
-    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
-      <div class="bg-yellow-50 p-6 rounded-lg">
-        <h2 class="text-xl font-semibold mb-4">Use Localhost URI</h2>
-        <button id="use-localhost" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded mb-2">
-          Use http://localhost:4321/callback
-        </button>
-        <div id="localhost-result" class="mt-4 text-sm"></div>
-      </div>
-      
-      <div class="bg-green-50 p-6 rounded-lg">
-        <h2 class="text-xl font-semibold mb-4">Use Production URI</h2>
-        <button id="use-production" class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mb-2">
-          Use http://todo.pkc.pub/callback
-        </button>
-        <div id="production-result" class="mt-4 text-sm"></div>
-      </div>
-    </div>
-  </div>
-
-  <script>
-    // Display current authentication environment
-    const authInfo = document.getElementById('auth-info');
-    const isLocalhost = window.location.hostname === 'localhost';
-    
-    // Update auth info display
-    function updateAuthInfo() {
-      authInfo.textContent = JSON.stringify({
-        location: window.location.href,
-        isLocalhost,
-        hostname: window.location.hostname,
-        origin: window.location.origin,
-        clientId: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '[MISSING]',
-        baseUrl: import.meta.env.PUBLIC_AUTHENTIK_URL || '[MISSING]',
-        hasSecret: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET ? 'YES' : 'NO'
-      }, null, 2);
-    }
-    
-    updateAuthInfo();
-    
-    // Direct authentication test
-    document.getElementById('test-auth').addEventListener('click', async () => {
-      try {
-        const { createClient } = await import('../lib/authentik/client');
-        
-        const baseUrl = import.meta.env.PUBLIC_AUTHENTIK_URL || 'https://auth.pkc.pub';
-        const clientId = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '';
-        const clientSecret = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET || '';
-        
-        // Log all values
-        console.log('Test Auth Direct Values:', {
-          baseUrl,
-          clientId,
-          clientIdLength: clientId.length,
-          hasSecret: !!clientSecret,
-          secretLength: clientSecret.length
-        });
-        
-        // Set status
-        authInfo.textContent = 'Starting authentication test...';
-        
-        // Wait for confirmation
-        setTimeout(() => {
-          // Navigate directly to the authentication URL
-          const authUrl = new URL(`${baseUrl}/application/o/authorize/`);
-          authUrl.searchParams.set('client_id', clientId);
-          authUrl.searchParams.set('redirect_uri', 'http://todo.pkc.pub/callback');
-          authUrl.searchParams.set('response_type', 'code');
-          authUrl.searchParams.set('scope', 'openid profile email');
-          
-          // Log and redirect
-          console.log('Navigating to:', authUrl.toString());
-          window.location.href = authUrl.toString();
-        }, 500);
-      } catch (error) {
-        console.error('Authentication test failed:', error);
-        authInfo.textContent = `Error: ${error.message}`;
-      }
-    });
-    
-    // Use localhost URI test
-    document.getElementById('use-localhost').addEventListener('click', async () => {
-      try {
-        const { createClient } = await import('../lib/authentik/client');
-        
-        const baseUrl = import.meta.env.PUBLIC_AUTHENTIK_URL || 'https://auth.pkc.pub';
-        const clientId = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '';
-        const clientSecret = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET || '';
-        
-        // Navigate directly to the authentication URL
-        const authUrl = new URL(`${baseUrl}/application/o/authorize/`);
-        authUrl.searchParams.set('client_id', clientId);
-        authUrl.searchParams.set('redirect_uri', 'http://localhost:4321/callback');
-        authUrl.searchParams.set('response_type', 'code');
-        authUrl.searchParams.set('scope', 'openid profile email');
-        
-        // Log and redirect
-        console.log('Navigating to localhost URI:', authUrl.toString());
-        document.getElementById('localhost-result').innerText = `Redirecting to auth with localhost URI...`;
-        
-        setTimeout(() => {
-          window.location.href = authUrl.toString();
-        }, 1000);
-      } catch (error) {
-        console.error('Localhost test failed:', error);
-        document.getElementById('localhost-result').innerText = `Error: ${error.message}`;
-      }
-    });
-    
-    // Use production URI test
-    document.getElementById('use-production').addEventListener('click', async () => {
-      try {
-        const { createClient } = await import('../lib/authentik/client');
-        
-        const baseUrl = import.meta.env.PUBLIC_AUTHENTIK_URL || 'https://auth.pkc.pub';
-        const clientId = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '';
-        const clientSecret = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET || '';
-        
-        // Navigate directly to the authentication URL
-        const authUrl = new URL(`${baseUrl}/application/o/authorize/`);
-        authUrl.searchParams.set('client_id', clientId);
-        authUrl.searchParams.set('redirect_uri', 'http://todo.pkc.pub/callback');
-        authUrl.searchParams.set('response_type', 'code');
-        authUrl.searchParams.set('scope', 'openid profile email');
-        
-        // Log and redirect
-        console.log('Navigating to production URI:', authUrl.toString());
-        document.getElementById('production-result').innerText = `Redirecting to auth with production URI...`;
-        
-        setTimeout(() => {
-          window.location.href = authUrl.toString();
-        }, 1000);
-      } catch (error) {
-        console.error('Production test failed:', error);
-        document.getElementById('production-result').innerText = `Error: ${error.message}`;
-      }
-    });
-  </script>
-</Layout>
diff --git a/src/pages/callback.astro b/src/pages/callback.astro
index 2542677..091dfb7 100644
--- a/src/pages/callback.astro
+++ b/src/pages/callback.astro
@@ -1,8 +1,27 @@
 ---
 import Layout from '../layouts/BaseLayout.astro';
+
+// Remove the immediate server-side redirect to allow client-side code to run first
 ---
 
 <Layout title="Authentication Callback">
+  <!-- Immediate inline script for debugging -->
+  <script is:inline>
+    console.log('INLINE DEBUG: Script executing', {
+      time: new Date().toISOString(),
+      url: window.location.href,
+      code: new URLSearchParams(window.location.search).get('code') ? 'present' : 'missing'
+    });
+
+    // Store the redirect path in localStorage as early as possible
+    try {
+      localStorage.setItem('authentik_top_banner_authredirect_uri', '/Page');
+      console.log('INLINE DEBUG: Stored redirect path in localStorage');
+    } catch (storageError) {
+      console.error('INLINE DEBUG: Error storing redirect path:', storageError);
+    }
+  </script>
+  
   <div class="min-h-screen flex items-center justify-center">
     <div class="text-center">
       <h1 class="text-2xl font-semibold mb-4">Processing Authentication...</h1>
@@ -11,8 +30,16 @@ import Layout from '../layouts/BaseLayout.astro';
   </div>
 
   <script>
+    // Immediate logging to verify script execution
+    console.log('CALLBACK DEBUG: Script started', {
+      timestamp: new Date().toISOString(),
+      url: window.location.href
+    });
+
     // Function to handle the authentication callback
     async function handleAuthCallback() {
+      console.log('CALLBACK DEBUG: handleAuthCallback function called');
+      
       try {
         // Extract the authorization code from the URL and trim any whitespace
         const urlParams = new URLSearchParams(window.location.search);
@@ -45,7 +72,25 @@ import Layout from '../layouts/BaseLayout.astro';
         });
 
         // Import the Authentik client dynamically
-        const { createClient } = await import('../lib/authentik/client');
+        console.log('CALLBACK DEBUG: About to import authentik client');
+        let createClient;
+        try {
+          const module = await import('../lib/authentik/client');
+          createClient = module.createClient;
+          console.log('CALLBACK DEBUG: Authentik client imported successfully');
+        } catch (importError: unknown) {
+          console.error('CALLBACK DEBUG: Failed to import authentik client', 
+            importError instanceof Error ? 
+              { message: importError.message, stack: importError.stack } : 
+              String(importError)
+          );
+          throw new Error(`Import failed: ${importError instanceof Error ? importError.message : String(importError)}`);
+        }
+
+        if (!createClient || typeof createClient !== 'function') {
+          console.error('CALLBACK DEBUG: createClient is not a function', { createClient });
+          throw new Error('createClient is not a function');
+        }
 
         // Hardcode the redirect URI based on hostname for maximum reliability
         const isLocalhost = window.location.hostname === 'localhost';
@@ -68,9 +113,95 @@ import Layout from '../layouts/BaseLayout.astro';
         });
 
         // Handle the callback
+        console.log('CALLBACK DEBUG: About to call client.handleCallback');
         const userInfo = await client.handleCallback(code);
         
-        console.log('Authentication Successful:', userInfo);
+        console.log('Authentication Successful:', {
+          userInfoReceived: !!userInfo,
+          userInfoFields: userInfo ? Object.keys(userInfo) : [],
+          accessTokenReceived: !!userInfo?.access_token
+        });
+        
+        // Explicitly store all user information in localStorage with multiple keys for redundancy
+        if (userInfo && typeof userInfo === 'object') {
+          try {
+            // Get the storage key prefix
+            const authStorageKeyPrefix = import.meta.env.PUBLIC_AUTHENTIK_STORAGE_KEY_PREFIX || 'authentik_';
+            
+            // Store user info in multiple formats to ensure it's found
+            localStorage.setItem(`${authStorageKeyPrefix}top_banner_authuser_info`, JSON.stringify(userInfo));
+            localStorage.setItem(`${authStorageKeyPrefix}user_info`, JSON.stringify(userInfo));
+            
+            // Store tokens separately for easier access
+            if (userInfo.access_token) {
+              localStorage.setItem(`${authStorageKeyPrefix}top_banner_authaccess_token`, userInfo.access_token);
+              localStorage.setItem(`${authStorageKeyPrefix}access_token`, userInfo.access_token);
+            }
+            
+            if (userInfo.id_token) {
+              localStorage.setItem(`${authStorageKeyPrefix}top_banner_authid_token`, userInfo.id_token);
+              localStorage.setItem(`${authStorageKeyPrefix}id_token`, userInfo.id_token);
+            }
+            
+            // Log successful storage
+            console.log('Authentication data stored successfully', {
+              keys: Object.keys(localStorage).filter(k => k.includes(authStorageKeyPrefix)),
+              userInfoSize: JSON.stringify(userInfo).length
+            });
+            
+            // Dispatch login action to Redux if possible
+            if (typeof window !== 'undefined') {
+              try {
+                // Safely check for store property on window
+                // @ts-ignore - The store is attached to window in store.js
+                const reduxStore = window.store;
+                
+                if (reduxStore && typeof reduxStore.dispatch === 'function') {
+                  const loginPayload = {
+                    isAuthenticated: true,
+                    profile: {
+                      email: userInfo.email,
+                      email_verified: userInfo.email_verified,
+                      sub: userInfo.sub,
+                      name: userInfo.name,
+                      given_name: userInfo.given_name,
+                      family_name: userInfo.family_name,
+                      nickname: userInfo.nickname,
+                      preferred_username: userInfo.preferred_username,
+                      groups: userInfo.groups || [],
+                      picture: userInfo.picture
+                    },
+                    tokens: {
+                      access_token: userInfo.access_token,
+                      id_token: userInfo.id_token,
+                      token_type: userInfo.token_type || 'Bearer',
+                      expires_at: userInfo.exp ? new Date(userInfo.exp * 1000).toISOString() : null
+                    }
+                  };
+                  
+                  console.log('Dispatching login action to Redux');
+                  reduxStore.dispatch({ type: 'user/login', payload: loginPayload });
+                } else {
+                  console.warn('Redux store not found on window or missing dispatch method');
+                }
+              } catch (reduxError) {
+                console.error('Error dispatching to Redux:', reduxError);
+              }
+            }
+          } catch (storageError) {
+            console.error('Error storing authentication data:', storageError);
+          }
+        } else {
+          console.warn('User info missing or invalid:', userInfo);
+        }
+        
+        // Determine where to redirect after successful authentication
+        const storedState = rawState ? JSON.parse(decodeURIComponent(rawState)) : null;
+        const redirectPath = storedState?.returnTo || '/Page';
+        
+        // Redirect back to the application
+        console.log('Authentication complete. Redirecting to:', redirectPath);
+        window.location.href = redirectPath;
       } catch (error: unknown) {
         const errorDetails = error instanceof Error 
           ? {
@@ -86,8 +217,9 @@ import Layout from '../layouts/BaseLayout.astro';
 
         console.error('Authentication callback failed:', errorDetails);
 
-        // Fallback redirect if something goes wrong
-        window.location.href = '/';
+        // Fallback redirect if something goes wrong - also redirect to /Page instead of root
+        console.log('Authentication failed. Redirecting to fallback: /Page');
+        window.location.href = '/Page';
       }
     }
 
diff --git a/src/store.js b/src/store.js
index 58ab66e..df50921 100644
--- a/src/store.js
+++ b/src/store.js
@@ -44,4 +44,17 @@ const store = configureStore({
 });
 
 // Export store
-export { store };
\ No newline at end of file
+export { store };
+
+// Make store globally accessible in browser environments
+if (typeof window !== 'undefined') {
+  window.store = store;
+  
+  // Add development helpers
+  if (import.meta.env.DEV) {
+    window.dispatch = store.dispatch;
+    window.getState = store.getState;
+  }
+  
+  console.log('Redux store made globally accessible');
+}
\ No newline at end of file
diff --git a/src/types/authentik.ts b/src/types/authentik.ts
index 57a645c..eea8002 100644
--- a/src/types/authentik.ts
+++ b/src/types/authentik.ts
@@ -12,6 +12,23 @@ export interface UserInfo {
   name?: string;
   email?: string;
   picture?: string;
+  email_verified?: boolean;
+  sub?: string;
+  given_name?: string;
+  family_name?: string;
+  nickname?: string;
+  preferred_username?: string;
+  groups?: string[];
+  // Token information
+  access_token?: string;
+  id_token?: string;
+  token_type?: string;
+  exp?: number;
+  iat?: number;
+  auth_time?: number;
+  // Authentication flow metadata
+  token_source?: string;
+  detection_method?: string; // Similar to your file detection tracking
 }
 
 export interface AuthentikPanelProps extends React.HTMLAttributes<HTMLDivElement> {
diff --git a/src/utils/content-detection.js b/src/utils/content-detection.js
new file mode 100644
index 0000000..ab80ffc
--- /dev/null
+++ b/src/utils/content-detection.js
@@ -0,0 +1,66 @@
+/**
+ * Content detection utility
+ * Implements robust content-based detection for various file types
+ * Following the same principles as the file detection system mentioned in user's requirements
+ */
+
+/**
+ * Get content type based on metadata and file information
+ * Uses multi-stage detection similar to the enhanced detection system
+ */
+export const getContentType = (fileInfo, metadata) => {
+  // Track detection method for logging
+  let detectionMethod = 'unknown';
+  
+  // Stage 1: Try to get from metadata (from Redux store)
+  if (metadata?.contentType && metadata.contentType !== 'null') {
+    detectionMethod = 'metadata';
+    console.log('Content detection - Using type from metadata:', metadata.contentType);
+    return metadata.contentType;
+  }
+  
+  // Stage 2: Try to get from fileInfo metadata
+  if (fileInfo?.metadata?.contentType && fileInfo.metadata.contentType !== 'null') {
+    detectionMethod = 'fileinfo_metadata';
+    console.log('Content detection - Using type from fileInfo metadata:', fileInfo.metadata.contentType);
+    return fileInfo.metadata.contentType;
+  }
+  
+  // Stage 3: Fallback to extension-based detection
+  if (fileInfo?.name) {
+    const extension = getFileExtension(fileInfo.name).toLowerCase();
+    const extensionMap = {
+      'txt': 'text/plain',
+      'csv': 'text/csv',
+      'md': 'text/markdown',
+      'json': 'application/json',
+      'pdf': 'application/pdf',
+      'png': 'image/png',
+      'jpg': 'image/jpeg',
+      'jpeg': 'image/jpeg',
+      'gif': 'image/gif',
+      'wav': 'audio/wav',
+      'mp3': 'audio/mpeg',
+      'mp4': 'video/mp4'
+    };
+    
+    if (extensionMap[extension]) {
+      detectionMethod = 'extension';
+      console.log('Content detection - Detected type from extension:', extensionMap[extension]);
+      return extensionMap[extension];
+    }
+  }
+  
+  // Stage 4: Default fallback
+  detectionMethod = 'default';
+  console.log('Content detection - Using default type');
+  return 'application/octet-stream';
+};
+
+/**
+ * Get file extension from a filename
+ */
+export const getFileExtension = (filename) => {
+  if (!filename) return '';
+  return filename.split('.').pop() || '';
+};

commit 8e44aba79e8a7763b41624c96cbe3d0ad06e5c7f
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Wed Apr 2 18:22:25 2025 +0800

    working login

diff --git a/src/components/panels/TopBar.tsx b/src/components/panels/TopBar.tsx
index a965498..bca232d 100644
--- a/src/components/panels/TopBar.tsx
+++ b/src/components/panels/TopBar.tsx
@@ -259,11 +259,19 @@ export const TopBar: React.FC<TopBarProps> = ({ initialTheme: initialPropTheme }
       }
     });
 
-    // Set redirect URI based on environment configuration
-    setRedirectUri(
-      import.meta.env.PUBLIC_AUTHENTIK_REDIRECT_URI || 
-      `${import.meta.env.PUBLIC_APP_URL}/callback`
-    );
+    // Set redirect URI based on environment configuration - hardcoded for reliability
+    const isLocalhost = window.location.hostname === 'localhost';
+    
+    // Hard code both values to ensure they match exactly what's configured in Authentik
+    const localRedirectUri = 'http://localhost:4321/callback'; // Hardcoded for local
+    const prodRedirectUri = 'http://todo.pkc.pub/callback'; // Hardcoded for production
+    
+    setRedirectUri(isLocalhost ? localRedirectUri : prodRedirectUri);
+    
+    console.log('Authentik Redirect URI:', {
+      isLocalhost,
+      usingUri: isLocalhost ? localRedirectUri : prodRedirectUri
+    });
 
     // Check for stored user info
     const storedUserInfo = localStorage.getItem('authentik_top_banner_authuser_info');
diff --git a/src/lib/authentik/client.ts b/src/lib/authentik/client.ts
index 76a4b27..ef87c9a 100644
--- a/src/lib/authentik/client.ts
+++ b/src/lib/authentik/client.ts
@@ -59,14 +59,20 @@ export function createClient(config: AuthentikClientConfig) {
       // Create URL with search params
       const url = new URL(authorizationUrl);
       url.searchParams.set('client_id', clientId);
-      url.searchParams.set('redirect_uri', redirectUri);
+      
+      // Hardcode the redirect URI based on hostname for maximum reliability
+      const isLocalhost = typeof window !== 'undefined' && window.location.hostname === 'localhost';
+      const hardcodedRedirectUri = isLocalhost ? 'http://localhost:4321/callback' : 'http://todo.pkc.pub/callback';
+      url.searchParams.set('redirect_uri', hardcodedRedirectUri);
+      
       url.searchParams.set('response_type', 'code');
       url.searchParams.set('scope', scopes);
       
       // Debug information for redirect URI issues
       console.log('Authentication Redirect Debug:', {
         authUrl: url.toString(),
-        redirectUri: redirectUri,
+        isLocalhost,
+        hardcodedRedirectUri,
         clientId: clientId ? '[PRESENT]' : '[MISSING]',
         baseUrl: sanitizedBaseUrl
       });
@@ -105,13 +111,17 @@ export function createClient(config: AuthentikClientConfig) {
         throw new Error('Redirect URI is required');
       }
 
+      // Check if we're running on localhost and adjust the redirect URI
+      const isLocalhost = typeof window !== 'undefined' && window.location.hostname === 'localhost';
+      const hardcodedRedirectUri = isLocalhost ? 'http://localhost:4321/callback' : 'http://todo.pkc.pub/callback';
+
       // Exchange authorization code for tokens
       const tokenUrl = new URL(`${sanitizedBaseUrl}/application/o/token/`);
       
       console.log('DEBUG TOKEN EXCHANGE CONFIGURATION:', {
         tokenUrl: tokenUrl.toString(),
         clientId,
-        redirectUri,
+        redirectUri: hardcodedRedirectUri,
         baseUrl: sanitizedBaseUrl,
         codeLength: code.length,
         clientSecretLength: clientSecret.length
@@ -121,7 +131,7 @@ export function createClient(config: AuthentikClientConfig) {
       const tokenParams = new URLSearchParams();
       tokenParams.append('client_id', clientId);
       tokenParams.append('client_secret', clientSecret);
-      tokenParams.append('redirect_uri', redirectUri);
+      tokenParams.append('redirect_uri', hardcodedRedirectUri);
       tokenParams.append('grant_type', 'authorization_code');
       tokenParams.append('code', code);
 
@@ -157,7 +167,7 @@ export function createClient(config: AuthentikClientConfig) {
           ...errorDetails,
           tokenUrl: tokenUrl.toString(),
           clientIdUsed: clientId,
-          redirectUriUsed: redirectUri
+          redirectUriUsed: hardcodedRedirectUri
         });
         throw new Error(`Network error during token exchange: ${errorDetails.errorMessage}`);
       }
diff --git a/src/pages/auth-debug.astro b/src/pages/auth-debug.astro
new file mode 100644
index 0000000..1671035
--- /dev/null
+++ b/src/pages/auth-debug.astro
@@ -0,0 +1,90 @@
+---
+import Layout from '../layouts/BaseLayout.astro';
+---
+
+<Layout title="Authentik Debug">
+  <div class="container mx-auto p-8">
+    <h1 class="text-3xl font-bold mb-6">Authentik Authentication Debug</h1>
+    
+    <div class="bg-blue-50 p-6 rounded-lg mb-8">
+      <h2 class="text-xl font-semibold mb-4">Environment Variables</h2>
+      <div class="overflow-x-auto">
+        <table class="min-w-full bg-white rounded-lg">
+          <thead>
+            <tr class="bg-gray-100">
+              <th class="py-2 px-4 text-left">Variable</th>
+              <th class="py-2 px-4 text-left">Value</th>
+            </tr>
+          </thead>
+          <tbody>
+            <tr>
+              <td class="py-2 px-4 border-t">PUBLIC_APP_URL</td>
+              <td class="py-2 px-4 border-t" id="app-url"></td>
+            </tr>
+            <tr>
+              <td class="py-2 px-4 border-t">PUBLIC_AUTHENTIK_REDIRECT_URI</td>
+              <td class="py-2 px-4 border-t" id="redirect-uri"></td>
+            </tr>
+            <tr>
+              <td class="py-2 px-4 border-t">PUBLIC_AUTHENTIK_URL</td>
+              <td class="py-2 px-4 border-t" id="auth-url"></td>
+            </tr>
+            <tr>
+              <td class="py-2 px-4 border-t">PUBLIC_AUTHENTIK_CLIENT_ID</td>
+              <td class="py-2 px-4 border-t" id="client-id"></td>
+            </tr>
+          </tbody>
+        </table>
+      </div>
+    </div>
+
+    <div class="bg-green-50 p-6 rounded-lg mb-8">
+      <h2 class="text-xl font-semibold mb-4">Authentication Links</h2>
+      <div class="space-y-4">
+        <div>
+          <h3 class="font-medium">Direct Login URL:</h3>
+          <p class="break-all bg-white p-2 rounded mt-1" id="login-url"></p>
+          <button id="try-direct-login" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
+            Try Direct Login
+          </button>
+        </div>
+      </div>
+    </div>
+
+    <div class="bg-yellow-50 p-6 rounded-lg">
+      <h2 class="text-xl font-semibold mb-4">Suggestions</h2>
+      <ul class="list-disc list-inside space-y-2">
+        <li>Make sure the redirect URI registered in Authentik exactly matches what we're sending</li>
+        <li>Check for trailing slashes and URL encoding differences</li>
+        <li>Try registering "http://todo.pkc.pub/callback" as the exact redirect URI in Authentik</li>
+        <li>Verify that your Authentik application is correctly configured</li>
+      </ul>
+    </div>
+  </div>
+
+  <script>
+    // Display environment variables
+    document.getElementById('app-url').textContent = import.meta.env.PUBLIC_APP_URL || 'Not set';
+    document.getElementById('redirect-uri').textContent = import.meta.env.PUBLIC_AUTHENTIK_REDIRECT_URI || 'Not set';
+    document.getElementById('auth-url').textContent = import.meta.env.PUBLIC_AUTHENTIK_URL || 'Not set';
+    document.getElementById('client-id').textContent = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || 'Not set';
+
+    // Create direct login URL
+    const baseUrl = import.meta.env.PUBLIC_AUTHENTIK_URL || 'https://auth.pkc.pub';
+    const clientId = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '';
+    const redirectUri = import.meta.env.PUBLIC_AUTHENTIK_REDIRECT_URI || 'http://todo.pkc.pub/callback';
+    
+    const authUrl = new URL(`${baseUrl}/application/o/authorize/`);
+    authUrl.searchParams.set('client_id', clientId);
+    authUrl.searchParams.set('redirect_uri', redirectUri);
+    authUrl.searchParams.set('response_type', 'code');
+    authUrl.searchParams.set('scope', 'openid profile email');
+    
+    document.getElementById('login-url').textContent = authUrl.toString();
+    
+    // Direct login button
+    document.getElementById('try-direct-login').addEventListener('click', () => {
+      window.location.href = authUrl.toString();
+    });
+  </script>
+</Layout>
diff --git a/src/pages/auth-test.astro b/src/pages/auth-test.astro
new file mode 100644
index 0000000..14dcea3
--- /dev/null
+++ b/src/pages/auth-test.astro
@@ -0,0 +1,154 @@
+---
+import Layout from '../layouts/BaseLayout.astro';
+---
+
+<Layout title="Authentication Test">
+  <div class="container mx-auto p-8">
+    <h1 class="text-3xl font-bold mb-6">Authentik Direct Authentication Test</h1>
+    
+    <div class="bg-blue-50 p-6 rounded-lg mb-8">
+      <h2 class="text-xl font-semibold mb-4">Test Authentication</h2>
+      <div id="auth-info" class="mb-4 whitespace-pre bg-white p-4 rounded text-sm font-mono overflow-auto max-h-60"></div>
+      <button id="test-auth" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
+        Test Direct Authentication
+      </button>
+    </div>
+
+    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
+      <div class="bg-yellow-50 p-6 rounded-lg">
+        <h2 class="text-xl font-semibold mb-4">Use Localhost URI</h2>
+        <button id="use-localhost" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded mb-2">
+          Use http://localhost:4321/callback
+        </button>
+        <div id="localhost-result" class="mt-4 text-sm"></div>
+      </div>
+      
+      <div class="bg-green-50 p-6 rounded-lg">
+        <h2 class="text-xl font-semibold mb-4">Use Production URI</h2>
+        <button id="use-production" class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mb-2">
+          Use http://todo.pkc.pub/callback
+        </button>
+        <div id="production-result" class="mt-4 text-sm"></div>
+      </div>
+    </div>
+  </div>
+
+  <script>
+    // Display current authentication environment
+    const authInfo = document.getElementById('auth-info');
+    const isLocalhost = window.location.hostname === 'localhost';
+    
+    // Update auth info display
+    function updateAuthInfo() {
+      authInfo.textContent = JSON.stringify({
+        location: window.location.href,
+        isLocalhost,
+        hostname: window.location.hostname,
+        origin: window.location.origin,
+        clientId: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '[MISSING]',
+        baseUrl: import.meta.env.PUBLIC_AUTHENTIK_URL || '[MISSING]',
+        hasSecret: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET ? 'YES' : 'NO'
+      }, null, 2);
+    }
+    
+    updateAuthInfo();
+    
+    // Direct authentication test
+    document.getElementById('test-auth').addEventListener('click', async () => {
+      try {
+        const { createClient } = await import('../lib/authentik/client');
+        
+        const baseUrl = import.meta.env.PUBLIC_AUTHENTIK_URL || 'https://auth.pkc.pub';
+        const clientId = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '';
+        const clientSecret = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET || '';
+        
+        // Log all values
+        console.log('Test Auth Direct Values:', {
+          baseUrl,
+          clientId,
+          clientIdLength: clientId.length,
+          hasSecret: !!clientSecret,
+          secretLength: clientSecret.length
+        });
+        
+        // Set status
+        authInfo.textContent = 'Starting authentication test...';
+        
+        // Wait for confirmation
+        setTimeout(() => {
+          // Navigate directly to the authentication URL
+          const authUrl = new URL(`${baseUrl}/application/o/authorize/`);
+          authUrl.searchParams.set('client_id', clientId);
+          authUrl.searchParams.set('redirect_uri', 'http://todo.pkc.pub/callback');
+          authUrl.searchParams.set('response_type', 'code');
+          authUrl.searchParams.set('scope', 'openid profile email');
+          
+          // Log and redirect
+          console.log('Navigating to:', authUrl.toString());
+          window.location.href = authUrl.toString();
+        }, 500);
+      } catch (error) {
+        console.error('Authentication test failed:', error);
+        authInfo.textContent = `Error: ${error.message}`;
+      }
+    });
+    
+    // Use localhost URI test
+    document.getElementById('use-localhost').addEventListener('click', async () => {
+      try {
+        const { createClient } = await import('../lib/authentik/client');
+        
+        const baseUrl = import.meta.env.PUBLIC_AUTHENTIK_URL || 'https://auth.pkc.pub';
+        const clientId = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '';
+        const clientSecret = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET || '';
+        
+        // Navigate directly to the authentication URL
+        const authUrl = new URL(`${baseUrl}/application/o/authorize/`);
+        authUrl.searchParams.set('client_id', clientId);
+        authUrl.searchParams.set('redirect_uri', 'http://localhost:4321/callback');
+        authUrl.searchParams.set('response_type', 'code');
+        authUrl.searchParams.set('scope', 'openid profile email');
+        
+        // Log and redirect
+        console.log('Navigating to localhost URI:', authUrl.toString());
+        document.getElementById('localhost-result').innerText = `Redirecting to auth with localhost URI...`;
+        
+        setTimeout(() => {
+          window.location.href = authUrl.toString();
+        }, 1000);
+      } catch (error) {
+        console.error('Localhost test failed:', error);
+        document.getElementById('localhost-result').innerText = `Error: ${error.message}`;
+      }
+    });
+    
+    // Use production URI test
+    document.getElementById('use-production').addEventListener('click', async () => {
+      try {
+        const { createClient } = await import('../lib/authentik/client');
+        
+        const baseUrl = import.meta.env.PUBLIC_AUTHENTIK_URL || 'https://auth.pkc.pub';
+        const clientId = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '';
+        const clientSecret = import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET || '';
+        
+        // Navigate directly to the authentication URL
+        const authUrl = new URL(`${baseUrl}/application/o/authorize/`);
+        authUrl.searchParams.set('client_id', clientId);
+        authUrl.searchParams.set('redirect_uri', 'http://todo.pkc.pub/callback');
+        authUrl.searchParams.set('response_type', 'code');
+        authUrl.searchParams.set('scope', 'openid profile email');
+        
+        // Log and redirect
+        console.log('Navigating to production URI:', authUrl.toString());
+        document.getElementById('production-result').innerText = `Redirecting to auth with production URI...`;
+        
+        setTimeout(() => {
+          window.location.href = authUrl.toString();
+        }, 1000);
+      } catch (error) {
+        console.error('Production test failed:', error);
+        document.getElementById('production-result').innerText = `Error: ${error.message}`;
+      }
+    });
+  </script>
+</Layout>
diff --git a/src/pages/callback.astro b/src/pages/callback.astro
index 02abbfb..2542677 100644
--- a/src/pages/callback.astro
+++ b/src/pages/callback.astro
@@ -47,11 +47,21 @@ import Layout from '../layouts/BaseLayout.astro';
         // Import the Authentik client dynamically
         const { createClient } = await import('../lib/authentik/client');
 
+        // Hardcode the redirect URI based on hostname for maximum reliability
+        const isLocalhost = window.location.hostname === 'localhost';
+        const hardcodedRedirectUri = isLocalhost ? 'http://localhost:4321/callback' : 'http://todo.pkc.pub/callback';
+
+        console.log('Callback page redirect URI check:', {
+          isLocalhost,
+          hardcodedRedirectUri,
+          currentUrl: window.location.href
+        });
+
         // Create the Authentik client with the same configuration used in TopBar
         const client = createClient({
           clientId: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '',
           clientSecret: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET || '',
-          redirectUri: import.meta.env.PUBLIC_AUTHENTIK_REDIRECT_URI || '',
+          redirectUri: hardcodedRedirectUri,
           scopes: import.meta.env.PUBLIC_AUTHENTIK_SCOPES || 'openid profile email',
           baseUrl: import.meta.env.PUBLIC_AUTHENTIK_URL || '',
           storageKey: `${import.meta.env.PUBLIC_AUTHENTIK_STORAGE_KEY_PREFIX || 'authentik_'}top_banner_auth`,

commit 9942e274c71fbaf7e43a359f4b67c9b036c34e63
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Wed Apr 2 17:31:57 2025 +0800

    new panel

diff --git a/astro.config.mjs b/astro.config.mjs
index 05dc111..e1e296f 100644
--- a/astro.config.mjs
+++ b/astro.config.mjs
@@ -142,10 +142,25 @@ export default defineConfig({
         '@': path.resolve('./src'),
         '@pages': path.resolve('./src/pages')
       }
+    },
+    server: {
+      hmr: {
+        clientPort: 4321
+      },
+      watch: {
+        usePolling: true
+      },
+      strictPort: true,
+      proxy: {},
+      cors: true,
+      allowedHosts: ['localhost', '127.0.0.1', 'todo.pkc.pub', '10.243.143.134', '172.22.1.146']
     }
   },
   server: {
     host: '0.0.0.0',
-    port: 4321
+    port: 4321,
+    headers: {
+      'Access-Control-Allow-Origin': '*'
+    }
   }
 });
diff --git a/serve_mqtt_dashboard.js b/serve_mqtt_dashboard.js
new file mode 100644
index 0000000..c5a7ee2
--- /dev/null
+++ b/serve_mqtt_dashboard.js
@@ -0,0 +1,43 @@
+const http = require('http');
+const fs = require('fs');
+const path = require('path');
+
+// Configuration
+const PORT = 8080;
+const HOST = '0.0.0.0'; // Binds to all network interfaces
+const DASHBOARD_FILE = path.join(__dirname, 'mqtt_dashboard_darkmode_energypro_fixed.html');
+
+// Create a simple HTTP server
+const server = http.createServer((req, res) => {
+  // Only serve the dashboard file for all requests
+  fs.readFile(DASHBOARD_FILE, (err, content) => {
+    if (err) {
+      res.writeHead(500);
+      res.end(`Error loading dashboard: ${err.message}`);
+      return;
+    }
+    
+    res.writeHead(200, { 'Content-Type': 'text/html' });
+    res.end(content, 'utf-8');
+  });
+});
+
+// Start the server
+server.listen(PORT, HOST, () => {
+  console.log(`MQTT Dashboard server running at http://${HOST}:${PORT}/`);
+  console.log('Available on:');
+  console.log(`- Local: http://localhost:${PORT}/`);
+  
+  // Show all network interfaces for convenience
+  const { networkInterfaces } = require('os');
+  const nets = networkInterfaces();
+  
+  for (const name of Object.keys(nets)) {
+    for (const net of nets[name]) {
+      // Skip internal and non-IPv4 addresses
+      if (net.family === 'IPv4' && !net.internal) {
+        console.log(`- Network: http://${net.address}:${PORT}/`);
+      }
+    }
+  }
+});
diff --git a/serve_mqtt_dashboard.mjs b/serve_mqtt_dashboard.mjs
new file mode 100644
index 0000000..4f7513d
--- /dev/null
+++ b/serve_mqtt_dashboard.mjs
@@ -0,0 +1,48 @@
+import http from 'http';
+import fs from 'fs';
+import path from 'path';
+import { fileURLToPath } from 'url';
+import os from 'os';
+
+// Get the current file directory (equivalent to __dirname in CommonJS)
+const __filename = fileURLToPath(import.meta.url);
+const __dirname = path.dirname(__filename);
+
+// Configuration
+const PORT = 8080;
+const HOST = '0.0.0.0'; // Binds to all network interfaces
+const DASHBOARD_FILE = path.join(__dirname, 'mqtt_dashboard_darkmode_energypro_fixed.html');
+
+// Create a simple HTTP server
+const server = http.createServer((req, res) => {
+  // Only serve the dashboard file for all requests
+  fs.readFile(DASHBOARD_FILE, (err, content) => {
+    if (err) {
+      res.writeHead(500);
+      res.end(`Error loading dashboard: ${err.message}`);
+      return;
+    }
+    
+    res.writeHead(200, { 'Content-Type': 'text/html' });
+    res.end(content, 'utf-8');
+  });
+});
+
+// Start the server
+server.listen(PORT, HOST, () => {
+  console.log(`MQTT Dashboard server running at http://${HOST}:${PORT}/`);
+  console.log('Available on:');
+  console.log(`- Local: http://localhost:${PORT}/`);
+  
+  // Show all network interfaces for convenience
+  const nets = os.networkInterfaces();
+  
+  for (const name of Object.keys(nets)) {
+    for (const net of nets[name]) {
+      // Skip internal and non-IPv4 addresses
+      if (net.family === 'IPv4' && !net.internal) {
+        console.log(`- Network: http://${net.address}:${PORT}/`);
+      }
+    }
+  }
+});
diff --git a/src/lib/auth/authentikService.js b/src/lib/auth/authentikService.js
index feb04b3..f966299 100644
--- a/src/lib/auth/authentikService.js
+++ b/src/lib/auth/authentikService.js
@@ -15,9 +15,9 @@ import { encodeText } from '../../utils/textEncoderPolyfill.js';
  * Default authentication configuration
  */
 const defaultAuthConfig = {
-  baseUrl: 'https://auth.pkc.pub',
-  clientId: '',
-  redirectUri: isBrowser ? window.location.origin : 'http://localhost:4321',
+  baseUrl: import.meta.env.PUBLIC_AUTHENTIK_URL || 'https://auth.pkc.pub',
+  clientId: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '',
+  redirectUri: import.meta.env.PUBLIC_AUTHENTIK_REDIRECT_URI || 'http://todo.pkc.pub/callback',
   scopes: 'openid profile email',
   storageKey: 'authentik_auth',
   responseType: 'code',
@@ -90,16 +90,28 @@ export function getLoginUrl(auth, state = null) {
     return Promise.resolve('#');
   }
   
-  // Create code verifier and store it
-  const codeVerifier = generateRandomString(64);
-  localStorage.setItem(`${auth.storageKey}_code_verifier`, codeVerifier);
+  // Add debug logging for redirect URI
+  if (isBrowser) {
+    console.log('Auth Config:', {
+      baseUrl: auth.baseUrl,
+      clientId: auth.clientId ? '[PRESENT]' : '[MISSING]',
+      redirectUri: auth.redirectUri,
+      publicEnvRedirectUri: import.meta.env.PUBLIC_AUTHENTIK_REDIRECT_URI || '[NOT SET]',
+      windowLocationOrigin: window.location.origin,
+      fullUrl: window.location.href
+    });
+  }
   
-  // Generate state if not provided
+  // Generate random state
   if (!state) {
     state = generateRandomString(32);
     localStorage.setItem(`${auth.storageKey}_auth_state`, state);
   }
   
+  // Create code verifier and store it
+  const codeVerifier = generateRandomString(64);
+  localStorage.setItem(`${auth.storageKey}_code_verifier`, codeVerifier);
+  
   // Build URL with PKCE code challenge
   return generateCodeChallenge(codeVerifier).then(codeChallenge => {
     const params = new URLSearchParams({
diff --git a/src/lib/authentik/client.ts b/src/lib/authentik/client.ts
index 3766ca6..76a4b27 100644
--- a/src/lib/authentik/client.ts
+++ b/src/lib/authentik/client.ts
@@ -63,6 +63,14 @@ export function createClient(config: AuthentikClientConfig) {
       url.searchParams.set('response_type', 'code');
       url.searchParams.set('scope', scopes);
       
+      // Debug information for redirect URI issues
+      console.log('Authentication Redirect Debug:', {
+        authUrl: url.toString(),
+        redirectUri: redirectUri,
+        clientId: clientId ? '[PRESENT]' : '[MISSING]',
+        baseUrl: sanitizedBaseUrl
+      });
+      
       // Store the original URL to return after authentication
       localStorage.setItem(`${storageKey}redirect_uri`, currentUrl);
 
diff --git a/src/pages/auth-example.astro b/src/pages/auth-example.astro
index badf1eb..4389f77 100644
--- a/src/pages/auth-example.astro
+++ b/src/pages/auth-example.astro
@@ -3,8 +3,7 @@ import Layout from '../layouts/BaseLayout.astro';
 import AuthentikPanel from '../components/auth/AuthentikPanel';
 
 // Get current host for proper redirect URI
-const canonicalURL = Astro.url;
-const baseUrl = `${canonicalURL.protocol}//${canonicalURL.host}`;
+const baseUrl = Astro.url.origin;
 ---
 
 <Layout title="Authentik Authentication Example">
@@ -24,24 +23,24 @@ const baseUrl = `${canonicalURL.protocol}//${canonicalURL.host}`;
         <AuthentikPanel 
           client:only={true}
           config={{
-            clientId: import.meta.env.AUTHENTIK_CLIENT_ID,
-            redirectUri: `${baseUrl}/callback`,
-            scopes: import.meta.env.AUTHENTIK_SCOPES,
-            baseUrl: import.meta.env.AUTHENTIK_URL,
-            storageKey: `${import.meta.env.AUTHENTIK_STORAGE_KEY_PREFIX || 'authentik_'}auth_example_page`,
+            clientId: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID,
+            baseUrl: import.meta.env.PUBLIC_AUTHENTIK_URL,
+            redirectUri: import.meta.env.PUBLIC_AUTHENTIK_REDIRECT_URI,
+            storageKey: `${import.meta.env.PUBLIC_AUTHENTIK_STORAGE_KEY_PREFIX}auth_example_page`,
+            scopes: import.meta.env.PUBLIC_AUTHENTIK_SCOPES?.split(' ') || ['openid', 'profile', 'email']
           }}
         />
         
         <div class="mt-4 text-sm text-gray-600">
           <p>
             <strong>Current Authentication Server:</strong> 
-            <a href={import.meta.env.AUTHENTIK_URL} target="_blank" class="text-blue-600 hover:underline">
-              {import.meta.env.AUTHENTIK_URL}
+            <a href={import.meta.env.PUBLIC_AUTHENTIK_URL} target="_blank" class="text-blue-600 hover:underline">
+              {import.meta.env.PUBLIC_AUTHENTIK_URL}
             </a>
           </p>
           <p class="mt-2">
             <strong>Authentication Scope:</strong> 
-            {import.meta.env.AUTHENTIK_SCOPES}
+            {import.meta.env.PUBLIC_AUTHENTIK_SCOPES}
           </p>
         </div>
       </div>
@@ -50,7 +49,7 @@ const baseUrl = `${canonicalURL.protocol}//${canonicalURL.host}`;
     <div class="mb-8">
       <h2 class="text-xl font-semibold mb-3">How It Works</h2>
       <div class="prose">
-        <p>This example demonstrates authentication using Authentik, a powerful identity provider available at <a href={import.meta.env.AUTHENTIK_URL} target="_blank">auth.pkc.pub</a>.</p>
+        <p>This example demonstrates authentication using Authentik, a powerful identity provider available at <a href={import.meta.env.PUBLIC_AUTHENTIK_URL} target="_blank">auth.pkc.pub</a>.</p>
         <p>The authentication flow uses the OAuth 2.0 Authorization Code flow with PKCE (Proof Key for Code Exchange) for enhanced security.</p>
         
         <h3>Authentication Flow:</h3>
@@ -88,20 +87,21 @@ const baseUrl = `${canonicalURL.protocol}//${canonicalURL.host}`;
           <li>Set up environment variables in a <code>.env</code> file:</li>
         </ol>
         
-        <pre><code>AUTHENTIK_CLIENT_ID=your-client-id-here
-AUTHENTIK_SCOPES=openid profile email
-AUTHENTIK_URL=https://auth.pkc.pub
-AUTHENTIK_STORAGE_KEY_PREFIX=authentik_panel_</code></pre>
+        <pre><code>PUBLIC_AUTHENTIK_CLIENT_ID=your-client-id-here
+PUBLIC_AUTHENTIK_SCOPES=openid profile email
+PUBLIC_AUTHENTIK_URL=https://auth.pkc.pub
+PUBLIC_AUTHENTIK_REDIRECT_URI=https://your-app-url.com/callback
+PUBLIC_AUTHENTIK_STORAGE_KEY_PREFIX=authentik_panel_</code></pre>
         
         <p>You can then include the component in your Astro pages:</p>
         <pre><code>&lt;AuthentikPanel 
   client:only={true}
   config={{
-    clientId: import.meta.env.AUTHENTIK_CLIENT_ID,
-    redirectUri: `${Astro.url.protocol}//${Astro.url.host}/your-page`,
-    scopes: import.meta.env.AUTHENTIK_SCOPES,
-    baseUrl: import.meta.env.AUTHENTIK_URL,
-    storageKey: `${import.meta.env.AUTHENTIK_STORAGE_KEY_PREFIX}your_page`
+    clientId: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID,
+    baseUrl: import.meta.env.PUBLIC_AUTHENTIK_URL,
+    redirectUri: import.meta.env.PUBLIC_AUTHENTIK_REDIRECT_URI,
+    scopes: ['openid', 'profile', 'email'],
+    storageKey: `${import.meta.env.PUBLIC_AUTHENTIK_STORAGE_KEY_PREFIX}your_page`
   }}
 /&gt;</code></pre>
       </div>
diff --git a/src/pages/callback.astro b/src/pages/callback.astro
index 592ce14..02abbfb 100644
--- a/src/pages/callback.astro
+++ b/src/pages/callback.astro
@@ -40,7 +40,7 @@ import Layout from '../layouts/BaseLayout.astro';
           fullUrl: window.location.href,
           clientId: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID ? 'Present' : 'Missing',
           baseUrl: import.meta.env.PUBLIC_AUTHENTIK_URL,
-          redirectUri: `${window.location.origin}/callback`,
+          redirectUri: import.meta.env.PUBLIC_AUTHENTIK_REDIRECT_URI,
           clientSecret: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET ? 'Present' : 'Missing'
         });
 
@@ -51,7 +51,7 @@ import Layout from '../layouts/BaseLayout.astro';
         const client = createClient({
           clientId: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_ID || '',
           clientSecret: import.meta.env.PUBLIC_AUTHENTIK_CLIENT_SECRET || '',
-          redirectUri: `${window.location.origin}/callback`,
+          redirectUri: import.meta.env.PUBLIC_AUTHENTIK_REDIRECT_URI || '',
           scopes: import.meta.env.PUBLIC_AUTHENTIK_SCOPES || 'openid profile email',
           baseUrl: import.meta.env.PUBLIC_AUTHENTIK_URL || '',
           storageKey: `${import.meta.env.PUBLIC_AUTHENTIK_STORAGE_KEY_PREFIX || 'authentik_'}top_banner_auth`,
diff --git a/src/pages/index.astro b/src/pages/index.astro
index 7942e3b..d5b4672 100644
--- a/src/pages/index.astro
+++ b/src/pages/index.astro
@@ -1,5 +1,190 @@
 ---
-import DefaultLayout from '../layouts/DefaultLayout.astro';
 ---
 
-<DefaultLayout title="Redux Todo App" />
+<html lang="en">
+<head>
+  <meta charset="UTF-8">
+  <meta name="viewport" content="width=device-width, initial-scale=1.0">
+  <title>Welcome to PKC</title>
+  <link rel="preconnect" href="https://fonts.googleapis.com">
+  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
+  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
+</head>
+<body>
+  <div class="container">
+    <div class="content">
+      <div class="logo-container">
+        <div class="logo">PKC</div>
+      </div>
+      
+      <h1>Welcome to PKC</h1>
+      <p class="subtitle">Your centralized dashboard for monitoring and controlling IoT devices</p>
+      
+      <div class="features">
+        <div class="feature">
+          <div class="feature-icon">📊</div>
+          <h3>Real-time Data</h3>
+          <p>Monitor live sensor readings from your connected devices</p>
+        </div>
+        <div class="feature">
+          <div class="feature-icon">🔌</div>
+          <h3>Device Control</h3>
+          <p>Toggle devices and send custom commands remotely</p>
+        </div>
+        <div class="feature">
+          <div class="feature-icon">📱</div>
+          <h3>Mobile Friendly</h3>
+          <p>Access your dashboard from any device, anywhere</p>
+        </div>
+      </div>
+      
+      <a href="/Page" class="enter-button">Enter Page</a>
+    </div>
+  </div>
+
+  <style>
+    * {
+      margin: 0;
+      padding: 0;
+      box-sizing: border-box;
+    }
+    
+    body {
+      font-family: 'Inter', sans-serif;
+      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
+      color: #ffffff;
+      min-height: 100vh;
+      display: flex;
+      align-items: center;
+      justify-content: center;
+    }
+    
+    .container {
+      width: 100%;
+      max-width: 1000px;
+      padding: 40px 20px;
+    }
+    
+    .content {
+      background: rgba(255, 255, 255, 0.05);
+      backdrop-filter: blur(10px);
+      border-radius: 16px;
+      padding: 60px 40px;
+      text-align: center;
+      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
+      border: 1px solid rgba(255, 255, 255, 0.1);
+    }
+    
+    .logo-container {
+      display: flex;
+      justify-content: center;
+      margin-bottom: 30px;
+    }
+    
+    .logo {
+      font-size: 48px;
+      font-weight: 700;
+      color: #ffffff;
+      background: linear-gradient(135deg, #00c6ff, #0072ff);
+      border-radius: 16px;
+      width: 120px;
+      height: 120px;
+      display: flex;
+      align-items: center;
+      justify-content: center;
+      box-shadow: 0 10px 20px rgba(0, 114, 255, 0.3);
+    }
+    
+    h1 {
+      font-size: 36px;
+      margin-bottom: 16px;
+      font-weight: 700;
+      background: linear-gradient(to right, #00c6ff, #0072ff);
+      -webkit-background-clip: text;
+      background-clip: text;
+      -webkit-text-fill-color: transparent;
+    }
+    
+    .subtitle {
+      font-size: 18px;
+      color: #e0e0e0;
+      margin-bottom: 50px;
+      max-width: 600px;
+      margin-left: auto;
+      margin-right: auto;
+    }
+    
+    .features {
+      display: grid;
+      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
+      gap: 30px;
+      margin-bottom: 50px;
+    }
+    
+    .feature {
+      padding: 20px;
+      border-radius: 12px;
+      background: rgba(255, 255, 255, 0.05);
+      transition: transform 0.3s ease, box-shadow 0.3s ease;
+    }
+    
+    .feature:hover {
+      transform: translateY(-5px);
+      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
+    }
+    
+    .feature-icon {
+      font-size: 32px;
+      margin-bottom: 16px;
+    }
+    
+    .feature h3 {
+      font-size: 18px;
+      margin-bottom: 10px;
+      font-weight: 600;
+    }
+    
+    .feature p {
+      color: #cccccc;
+      font-size: 14px;
+    }
+    
+    .enter-button {
+      display: inline-block;
+      background: linear-gradient(135deg, #00c6ff, #0072ff);
+      color: white;
+      font-weight: 600;
+      font-size: 18px;
+      padding: 16px 40px;
+      border-radius: 40px;
+      text-decoration: none;
+      transition: transform 0.3s ease, box-shadow 0.3s ease;
+      margin-top: 20px;
+      box-shadow: 0 10px 20px rgba(0, 114, 255, 0.3);
+    }
+    
+    .enter-button:hover {
+      transform: translateY(-3px);
+      box-shadow: 0 15px 30px rgba(0, 114, 255, 0.4);
+    }
+    
+    @media (max-width: 768px) {
+      .content {
+        padding: 40px 20px;
+      }
+      
+      h1 {
+        font-size: 28px;
+      }
+      
+      .subtitle {
+        font-size: 16px;
+      }
+      
+      .features {
+        grid-template-columns: 1fr;
+      }
+    }
+  </style>
+</body>
+</html>
```
