# Git Activity Log - Henry Koo
Generated at: Sat Apr 12 00:42:25 UTC 2025
## Changes by Henry Koo
```diff
commit 55a6fc3a19186b6ba4f88cf9a28462fbabea8980
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Fri Apr 11 17:57:13 2025 +0800

    Remove unused file

diff --git a/Docs/to-do-plan b/Docs/to-do-plan
index 2716de8..fc99a35 160000
--- a/Docs/to-do-plan
+++ b/Docs/to-do-plan
@@ -1 +1 @@
-Subproject commit 2716de8a952a1d1645a261759e0efad2d151485e
+Subproject commit fc99a35ab5c0893ad2f2555bf793fed4780c6f58

commit 7868526d6ddb7fbb155d8d7aaf67ee4be751fe86
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Fri Apr 11 14:43:24 2025 +0800

    new panellayout

diff --git a/src/features/panellayoutSlice.json b/src/features/panellayoutSlice.json
index 20b253a..1e7ee73 100644
--- a/src/features/panellayoutSlice.json
+++ b/src/features/panellayoutSlice.json
@@ -1,7 +1,7 @@
 {
     "generate_layout": {
         "left": {
-            "type": "DatabaseRetrievePanel",
+            "type": "CatalogPanel",
             "size": 30,
             "minSize": 20,
             "visible": true
@@ -21,7 +21,7 @@
     },
     "todo_layout": {
         "left": {
-            "type": "DatabaseRetrievePanel",
+            "type": "CatalogPanel",
             "size": 30,
             "minSize": 20,
             "visible": true
@@ -41,7 +41,7 @@
     },
     "clm_layout": {
         "left": {
-            "type": "DatabaseRetrievePanel",
+            "type": "CatalogPanel",
             "size": 33,
             "minSize": 20,
             "visible": true

commit 83eff002343d9b1c5d1e83402d6d0336d11633cd
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Fri Apr 11 13:20:14 2025 +0800

    Remove API key validation and update DatabaseRetrievePanel file extension to .tsx

diff --git a/src/components/panels/googlecalendar.jsx b/src/components/panels/googlecalendar.jsx
index 003c8c8..a7290ee 100644
--- a/src/components/panels/googlecalendar.jsx
+++ b/src/components/panels/googlecalendar.jsx
@@ -104,19 +104,7 @@ const GoogleCalendar = () => {
         setIsLoading(true);
         setError(null);
         
-        // Check if API keys are properly configured
-        const apiKey = import.meta.env.PUBLIC_GOOGLE_API_KEY;
-        const clientId = import.meta.env.PUBLIC_GOOGLE_CLIENT_ID;
-        
-        if (!apiKey || apiKey === 'PLACEHOLDER_API_KEY' || 
-            !clientId || clientId === 'PLACEHOLDER_CLIENT_ID') {
-          console.error('Google Calendar API keys not configured');
-          setConfigError(true);
-          setError('Google Calendar API is not properly configured. Please add your API keys to the .env file.');
-          setIsLoading(false);
-          setIsInitializing(false);
-          return;
-        }
+        // No longer need to check for API keys since they're hardcoded
         
         await loadGoogleApi();
         
diff --git a/src/layouts/PanelGroupLayout.jsx b/src/layouts/PanelGroupLayout.jsx
index 29eea6b..443bc6c 100644
--- a/src/layouts/PanelGroupLayout.jsx
+++ b/src/layouts/PanelGroupLayout.jsx
@@ -8,7 +8,7 @@ const panelComponents = {
   // Special case components can be added here
   googlecalendar: lazy(() => import('../components/panels/googlecalendar.jsx')),
   chatbot: lazy(() => import('../components/panels/chatbot.jsx')),
-  databaseretrieve: lazy(() => import('../components/panels/DatabaseRetrievePanel.jsx')),
+  databaseretrieve: lazy(() => import('../components/panels/DatabaseRetrievePanel.tsx')),
 };
 
 // Create a client-only wrapper for xterm

commit 17ac55cf01612e9352516555d1fd8217d38ae404
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Fri Apr 11 13:18:02 2025 +0800

    new api config

diff --git a/src/components/panels/googlecalendar.jsx b/src/components/panels/googlecalendar.jsx
index abf4dc7..003c8c8 100644
--- a/src/components/panels/googlecalendar.jsx
+++ b/src/components/panels/googlecalendar.jsx
@@ -1,67 +1,181 @@
 import React, { useState, useEffect } from 'react';
-import { loadGoogleApi, signIn, signOut, listEvents, getAuthInstance } from '../../lib/google-calendar.js';
+import { loadGoogleApi, signIn, signOut, listEvents, getAuthInstance, isInitialized } from '../../lib/google-calendar.js';
+
+const ViewToggle = ({ view, onViewChange }) => (
+  <div className="flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
+    <button
+      onClick={() => onViewChange('grid')}
+      className={`px-4 py-2 rounded ${
+        view === 'grid'
+          ? 'bg-white dark:bg-gray-600 shadow-sm'
+          : 'text-gray-600 dark:text-gray-300'
+      }`}
+    >
+      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
+      </svg>
+    </button>
+    <button
+      onClick={() => onViewChange('list')}
+      className={`px-4 py-2 rounded ${
+        view === 'list'
+          ? 'bg-white dark:bg-gray-600 shadow-sm'
+          : 'text-gray-600 dark:text-gray-300'
+      }`}
+    >
+      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 10h16M4 14h16M4 18h16" />
+      </svg>
+    </button>
+  </div>
+);
+
+const FilterBar = ({ searchTerm, onSearchChange }) => (
+  <div className="relative">
+    <input
+      type="text"
+      placeholder="Search events..."
+      value={searchTerm}
+      onChange={(e) => onSearchChange(e.target.value)}
+      className="w-full px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-600"
+    />
+    <svg
+      className="absolute right-3 top-2.5 w-5 h-5 text-gray-400 dark:text-gray-500"
+      fill="none"
+      stroke="currentColor"
+      viewBox="0 0 24 24"
+    >
+      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
+    </svg>
+  </div>
+);
+
+const EventCard = ({ event, view }) => {
+  const date = new Date(event.start.dateTime || event.start.date);
+  const formattedDate = date.toLocaleString('en-US', {
+    weekday: 'short',
+    month: 'short',
+    day: 'numeric',
+    hour: 'numeric',
+    minute: '2-digit'
+  });
+
+  if (view === 'grid') {
+    return (
+      <div className="bg-white dark:bg-gray-700 rounded-lg shadow-sm border border-gray-200 dark:border-gray-600 p-4 hover:shadow-md transition-shadow">
+        <div className="text-sm text-blue-600 dark:text-blue-400 mb-2">{formattedDate}</div>
+        <h3 className="font-semibold text-lg dark:text-white mb-2">{event.summary}</h3>
+        {event.description && (
+          <p className="text-sm text-gray-600 dark:text-gray-300 line-clamp-3">{event.description}</p>
+        )}
+      </div>
+    );
+  }
+
+  return (
+    <div className="bg-white dark:bg-gray-700 rounded-lg shadow-sm border border-gray-200 dark:border-gray-600 p-4 hover:shadow-md transition-shadow">
+      <div className="flex items-start gap-4">
+        <div className="text-sm text-blue-600 dark:text-blue-400 whitespace-nowrap">{formattedDate}</div>
+        <div>
+          <h3 className="font-semibold text-lg dark:text-white mb-2">{event.summary}</h3>
+          {event.description && (
+            <p className="text-sm text-gray-600 dark:text-gray-300">{event.description}</p>
+          )}
+        </div>
+      </div>
+    </div>
+  );
+};
 
 const GoogleCalendar = () => {
   const [events, setEvents] = useState([]);
   const [isLoading, setIsLoading] = useState(true);
   const [error, setError] = useState(null);
   const [isAuthenticated, setIsAuthenticated] = useState(false);
-  const [isInitialized, setIsInitialized] = useState(false);
+  const [isInitializing, setIsInitializing] = useState(true);
+  const [view, setView] = useState('grid');
+  const [searchTerm, setSearchTerm] = useState('');
+  const [configError, setConfigError] = useState(false);
 
+  // Initialize Google API
   useEffect(() => {
     const initializeGoogleApi = async () => {
-      if (isInitialized) return;
-      
       try {
+        setIsLoading(true);
+        setError(null);
+        
+        // Check if API keys are properly configured
+        const apiKey = import.meta.env.PUBLIC_GOOGLE_API_KEY;
+        const clientId = import.meta.env.PUBLIC_GOOGLE_CLIENT_ID;
+        
+        if (!apiKey || apiKey === 'PLACEHOLDER_API_KEY' || 
+            !clientId || clientId === 'PLACEHOLDER_CLIENT_ID') {
+          console.error('Google Calendar API keys not configured');
+          setConfigError(true);
+          setError('Google Calendar API is not properly configured. Please add your API keys to the .env file.');
+          setIsLoading(false);
+          setIsInitializing(false);
+          return;
+        }
+        
         await loadGoogleApi();
-        const authInstance = getAuthInstance();
         
-        // Set initial authentication state
-        const initialSignedIn = authInstance.isSignedIn.get();
-        setIsAuthenticated(initialSignedIn);
+        // Check if user is already authenticated by checking for token
+        const token = window.gapi.client.getToken();
+        setIsAuthenticated(token !== null);
         
-        // Listen for sign-in state changes
-        authInstance.isSignedIn.listen((isSignedIn) => {
-          console.log('Auth state changed:', isSignedIn);
-          setIsAuthenticated(isSignedIn);
-          if (isSignedIn) {
-            fetchEvents().catch(console.error);
-          } else {
-            setEvents([]);
-          }
-        });
-
-        setIsInitialized(true);
-
-        if (initialSignedIn) {
+        if (token !== null) {
           await fetchEvents();
         }
       } catch (err) {
         console.error('Error initializing Google Calendar API:', err);
-        setError('Failed to initialize Google Calendar. Please refresh the page and try again.');
+        if (err.message && err.message.includes('400')) {
+          setConfigError(true);
+          setError('Invalid Google Calendar API key. Please check your API credentials.');
+        } else {
+          setError('Failed to initialize Google Calendar. Please check your internet connection and refresh the page.');
+        }
       } finally {
         setIsLoading(false);
+        setIsInitializing(false);
       }
     };
 
-    initializeGoogleApi();
-  }, [isInitialized]);
+    // Avoid initialization during server-side rendering
+    if (typeof window !== 'undefined') {
+      initializeGoogleApi();
+    } else {
+      setIsLoading(false);
+      setIsInitializing(false);
+    }
+  }, []);
 
   const handleSignIn = async () => {
     try {
       setError(null);
       setIsLoading(true);
+      
       await signIn();
-      // The auth state listener will handle fetching events
+      setIsAuthenticated(true);
+      await fetchEvents();
+      
     } catch (err) {
       console.error('Sign in error:', err);
+      
+      // Handle specific error types
       if (err.error === 'popup_blocked_by_browser') {
         setError('Please allow popups for this site to sign in with Google.');
       } else if (err.error === 'access_denied') {
         setError('Access denied. Please grant calendar access to view your events.');
+      } else if (err.error === 'immediate_failed') {
+        setError('Authentication failed. Please try again.');
+      } else if (err.message && err.message.includes('Cross-Origin-Opener-Policy')) {
+        setError('Browser security policy blocked the sign-in process. Please try using a different browser or disable enhanced tracking protection for this site.');
       } else {
-        setError('Failed to sign in. Please try again.');
+        setError('Failed to sign in. Please try again later.');
       }
+      
+      setIsAuthenticated(false);
     } finally {
       setIsLoading(false);
     }
@@ -71,8 +185,11 @@ const GoogleCalendar = () => {
     try {
       setError(null);
       setIsLoading(true);
+      
       await signOut();
+      setIsAuthenticated(false);
       setEvents([]);
+      
     } catch (err) {
       console.error('Sign out error:', err);
       setError('Failed to sign out. Please try again.');
@@ -85,50 +202,96 @@ const GoogleCalendar = () => {
     try {
       setError(null);
       setIsLoading(true);
+      
+      if (!isInitialized()) {
+        throw new Error('Google API not initialized');
+      }
+      
       const response = await listEvents();
       setEvents(response.result.items || []);
+      
     } catch (err) {
       console.error('Calendar fetch error:', err);
+      
       if (err.status === 403) {
-        setError('Access denied. Please ensure you have granted calendar access.');
+        setError('Access denied. Please ensure you have granted calendar access and try signing in again.');
+        setIsAuthenticated(false);
+      } else if (err.status === 401) {
+        setError('Your session has expired. Please sign in again.');
         setIsAuthenticated(false);
       } else {
-        setError('Failed to fetch calendar events. Please try again.');
+        setError('Failed to fetch calendar events. Please check your internet connection and try again.');
       }
     } finally {
       setIsLoading(false);
     }
   };
 
-  if (isLoading) return (
-    <div className="flex items-center justify-center h-full dark:bg-gray-800">
-      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary dark:border-blue-400"></div>
-    </div>
-  );
+  const filteredEvents = events.filter(event => {
+    const searchLower = searchTerm.toLowerCase();
+    return (
+      event.summary?.toLowerCase().includes(searchLower) ||
+      event.description?.toLowerCase().includes(searchLower)
+    );
+  });
 
-  if (error) return (
-    <div className="p-4 dark:bg-gray-800">
-      <div className="bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg p-4">
-        <p className="text-red-600 dark:text-red-200 text-sm font-medium">{error}</p>
-        <div className="mt-3 flex gap-2">
-          {isAuthenticated && (
+  // For initial loading state
+  if (isInitializing) {
+    return (
+      <div className="flex items-center justify-center h-full dark:bg-gray-800">
+        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary dark:border-blue-400"></div>
+      </div>
+    );
+  }
+
+  // For configuration errors, show a more helpful message
+  if (configError) {
+    return (
+      <div className="p-6 dark:bg-gray-800">
+        <div className="bg-yellow-50 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4">
+          <h3 className="text-lg font-medium text-yellow-800 dark:text-yellow-200 mb-2">Configuration Required</h3>
+          <p className="text-yellow-700 dark:text-yellow-300 mb-4">{error}</p>
+          <div className="bg-white dark:bg-gray-800 p-4 rounded border border-gray-200 dark:border-gray-700 mb-4">
+            <p className="text-sm font-mono mb-2">1. Create a <code className="bg-gray-100 dark:bg-gray-700 px-1 py-0.5 rounded">.env</code> file in your project root with:</p>
+            <pre className="bg-gray-100 dark:bg-gray-900 p-2 rounded text-xs overflow-auto">
+              PUBLIC_GOOGLE_API_KEY=your_api_key_here<br/>
+              PUBLIC_GOOGLE_CLIENT_ID=your_client_id_here
+            </pre>
+          </div>
+          <p className="text-sm text-gray-600 dark:text-gray-400">
+            You'll need to create these credentials in the <a href="https://console.cloud.google.com" target="_blank" rel="noopener noreferrer" className="text-blue-600 dark:text-blue-400 underline">Google Cloud Console</a>.
+          </p>
+        </div>
+      </div>
+    );
+  }
+
+  // For authentication errors and loading states
+  if (error && !configError) {
+    return (
+      <div className="p-4 dark:bg-gray-800">
+        <div className="bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg p-4">
+          <p className="text-red-600 dark:text-red-200 text-sm font-medium">{error}</p>
+          <div className="mt-3 flex gap-2">
+            {isAuthenticated && (
+              <button
+                onClick={fetchEvents}
+                className="text-sm bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700"
+              >
+                Retry
+              </button>
+            )}
             <button
-              onClick={fetchEvents}
-              className="text-sm bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700"
+              onClick={() => setError(null)}
+              className="text-sm bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700"
             >
-              Retry
+              Dismiss
             </button>
-          )}
-          <button
-            onClick={() => setError(null)}
-            className="text-sm bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700"
-          >
-            Dismiss
-          </button>
+          </div>
         </div>
       </div>
-    </div>
-  );
+    );
+  }
 
   return (
     <div className="p-4 h-full overflow-auto dark:bg-gray-800 dark:text-white">
@@ -147,33 +310,61 @@ const GoogleCalendar = () => {
         </div>
       ) : (
         <>
-          <div className="flex justify-between items-center mb-4">
-            <h2 className="text-xl font-bold dark:text-white">Upcoming Events</h2>
-            <button
-              onClick={handleSignOut}
-              disabled={isLoading}
-              className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed"
-            >
-              {isLoading ? 'Signing out...' : 'Sign Out'}
-            </button>
-          </div>
-          <div className="space-y-4">
-            {events.length === 0 ? (
-              <p className="text-center text-gray-500 dark:text-gray-400">No upcoming events</p>
-            ) : (
-              events.map((event) => (
-                <div key={event.id} className="border border-gray-200 dark:border-gray-700 p-4 rounded-lg hover:shadow-md transition-shadow dark:bg-gray-700">
-                  <h3 className="font-semibold text-lg dark:text-white">{event.summary}</h3>
-                  <p className="text-sm text-gray-600 dark:text-gray-300 mt-1">
-                    {new Date(event.start.dateTime || event.start.date).toLocaleString()}
-                  </p>
-                  {event.description && (
-                    <p className="text-sm mt-2 text-gray-700 dark:text-gray-300">{event.description}</p>
-                  )}
-                </div>
-              ))
-            )}
+          <div className="flex flex-col gap-4">
+            <div className="flex justify-between items-center">
+              <h2 className="text-xl font-bold dark:text-white">Upcoming Events</h2>
+              <div className="flex items-center gap-4">
+                <button
+                  onClick={fetchEvents}
+                  disabled={isLoading}
+                  className="flex items-center gap-2 px-4 py-2 text-blue-600 dark:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
+                  title="Refresh events"
+                >
+                  <svg
+                    className={`w-5 h-5 ${isLoading ? 'animate-spin' : ''}`}
+                    fill="none"
+                    stroke="currentColor"
+                    viewBox="0 0 24 24"
+                  >
+                    <path
+                      strokeLinecap="round"
+                      strokeLinejoin="round"
+                      strokeWidth={2}
+                      d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
+                    />
+                  </svg>
+                  <span className="sr-only">Refresh</span>
+                </button>
+                <ViewToggle view={view} onViewChange={setView} />
+                <button
+                  onClick={handleSignOut}
+                  disabled={isLoading}
+                  className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed"
+                >
+                  {isLoading ? 'Signing out...' : 'Sign Out'}
+                </button>
+              </div>
+            </div>
+            <FilterBar searchTerm={searchTerm} onSearchChange={setSearchTerm} />
           </div>
+          
+          {isLoading ? (
+            <div className="flex items-center justify-center h-64 mt-6">
+              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary dark:border-blue-400"></div>
+            </div>
+          ) : (
+            <div className={`mt-6 ${view === 'grid' ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' : 'space-y-4'}`}>
+              {filteredEvents.length === 0 ? (
+                <p className="text-center text-gray-500 dark:text-gray-400 col-span-full">
+                  {searchTerm ? 'No events match your search' : 'No upcoming events'}
+                </p>
+              ) : (
+                filteredEvents.map((event) => (
+                  <EventCard key={event.id} event={event} view={view} />
+                ))
+              )}
+            </div>
+          )}
         </>
       )}
     </div>
diff --git a/src/layouts/PanelGroupLayout.jsx b/src/layouts/PanelGroupLayout.jsx
index 259e577..29eea6b 100644
--- a/src/layouts/PanelGroupLayout.jsx
+++ b/src/layouts/PanelGroupLayout.jsx
@@ -1,12 +1,14 @@
-import React, { Suspense, lazy } from 'react';
-import { Provider, useSelector } from 'react-redux';
+import React, { Suspense, lazy, useState, useEffect } from 'react';
+import { Provider, useSelector, useDispatch } from 'react-redux';
 import { Panel, PanelGroup, PanelResizeHandle } from 'react-resizable-panels';
 import { store } from '../store';
 
 // Map of panel types to their components
 const panelComponents = {
   // Special case components can be added here
-  googlecalendar: lazy(() => import('../components/panels/googlecalendar.jsx'))
+  googlecalendar: lazy(() => import('../components/panels/googlecalendar.jsx')),
+  chatbot: lazy(() => import('../components/panels/chatbot.jsx')),
+  databaseretrieve: lazy(() => import('../components/panels/DatabaseRetrievePanel.jsx')),
 };
 
 // Create a client-only wrapper for xterm
@@ -23,7 +25,12 @@ const ClientOnly = ({ children, fallback = <div>Loading...</div> }) => {
 
 const PanelContent = () => {
   const { panels } = useSelector(state => state.panellayout);
-  if (!panels) return <div>Loading panels...</div>;
+  const [mounted, setMounted] = useState(false);
+  const dispatch = useDispatch();
+
+  useEffect(() => {
+    setMounted(true);
+  }, []);
 
   const renderPanel = (config) => {
     // Special handling for xterm
@@ -42,7 +49,7 @@ const PanelContent = () => {
       const Component = panelComponents[config.type];
       return (
         <Suspense fallback={<div className="flex items-center justify-center h-full dark:bg-gray-800 dark:text-white">Loading {config.type}...</div>}>
-          <Component />
+          {mounted ? <Component /> : null}
         </Suspense>
       );
     }
@@ -72,7 +79,7 @@ const PanelContent = () => {
     
     return (
       <Suspense fallback={<div className="flex items-center justify-center h-full dark:bg-gray-800 dark:text-white">Loading panel...</div>}>
-        <Component />
+        {mounted ? <Component /> : null}
       </Suspense>
     );
   };
diff --git a/src/lib/google-calendar.js b/src/lib/google-calendar.js
index 7a55d47..281b713 100644
--- a/src/lib/google-calendar.js
+++ b/src/lib/google-calendar.js
@@ -1,105 +1,245 @@
 // Google Calendar API configuration
-const SCOPES = [
-  'https://www.googleapis.com/auth/calendar.readonly',
-  'https://www.googleapis.com/auth/calendar.events.readonly'
-];
 const CLIENT_ID = '453579831938-addktpr31j59mgitmuiemjtkb5pjs5am.apps.googleusercontent.com';
 const API_KEY = 'AIzaSyCng_GxCcoeRozBaw03cwN9QE-xu0WFlrI';
+const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
+const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly';
+
+let tokenClient;
+let gapiInited = false;
+let gisInited = false;
 
 // Load the Google API client library
-export const loadGoogleApi = () => {
-  return new Promise((resolve, reject) => {
-    if (window.gapi) {
-      initializeGapiClient().then(() => resolve(window.gapi)).catch(reject);
+export const loadGoogleApi = async () => {
+  try {
+    console.log('Starting Google API initialization');
+    
+    // Check if we're in SSR (Server-Side Rendering)
+    if (typeof window === 'undefined') {
+      console.log('Skipping Google API initialization in SSR');
       return;
     }
+    
+    // Load the Google API client
+    await new Promise((resolve, reject) => {
+      if (window.gapi) {
+        console.log('GAPI already loaded');
+        resolve();
+        return;
+      }
+      
+      console.log('Loading GAPI script');
+      const script = document.createElement('script');
+      script.src = 'https://apis.google.com/js/api.js';
+      script.onload = () => {
+        console.log('GAPI script loaded');
+        resolve();
+      };
+      script.onerror = (e) => {
+        console.error('Error loading GAPI script:', e);
+        reject(new Error('Failed to load Google API script'));
+      };
+      document.head.appendChild(script);
+    });
 
-    const script = document.createElement('script');
-    script.src = 'https://apis.google.com/js/api.js';
-    script.async = true;
-    script.defer = true;
-    script.onload = () => {
-      window.gapi.load('client:auth2', async () => {
-        try {
-          await initializeGapiClient();
-          resolve(window.gapi);
-        } catch (err) {
-          reject(err);
-        }
+    // Initialize the gapi.client
+    await new Promise((resolve, reject) => {
+      console.log('Initializing GAPI client');
+      window.gapi.load('client', {
+        callback: () => {
+          console.log('GAPI client loaded');
+          resolve();
+        },
+        onerror: (e) => {
+          console.error('Error loading GAPI client:', e);
+          reject(new Error('Failed to load GAPI client'));
+        },
+        timeout: 5000,
+        ontimeout: () => reject(new Error('GAPI client load timeout'))
       });
-    };
-    script.onerror = reject;
-    document.body.appendChild(script);
-  });
+    });
+
+    // Initialize gapi client
+    console.log('Initializing GAPI client with API key');
+    await window.gapi.client.init({
+      apiKey: API_KEY,
+      discoveryDocs: [DISCOVERY_DOC],
+    });
+    
+    gapiInited = true;
+    console.log('GAPI successfully initialized');
+
+    // Load the Google Identity Service
+    await new Promise((resolve, reject) => {
+      if (window.google && window.google.accounts && window.google.accounts.oauth2) {
+        console.log('GIS already loaded');
+        resolve();
+        return;
+      }
+      
+      console.log('Loading GIS script');
+      const script = document.createElement('script');
+      script.src = 'https://accounts.google.com/gsi/client';
+      script.onload = () => {
+        console.log('GIS script loaded');
+        resolve();
+      };
+      script.onerror = (e) => {
+        console.error('Error loading GIS script:', e);
+        reject(new Error('Failed to load Google Identity Services script'));
+      };
+      script.async = true;
+      script.defer = true;
+      document.head.appendChild(script);
+    });
+
+    // Wait for the Google Identity Services to be ready
+    await new Promise((resolve, reject) => {
+      console.log('Waiting for GIS to be ready');
+      const maxAttempts = 50;
+      let attempts = 0;
+      
+      const checkGisReady = () => {
+        attempts++;
+        if (window.google && window.google.accounts && window.google.accounts.oauth2) {
+          console.log('GIS is ready');
+          resolve();
+        } else if (attempts >= maxAttempts) {
+          reject(new Error('Timeout waiting for Google Identity Services to load'));
+        } else {
+          console.log(`Waiting for GIS (attempt ${attempts}/${maxAttempts})`);
+          setTimeout(checkGisReady, 100);
+        }
+      };
+      checkGisReady();
+    });
+    
+    // Initialize token client
+    console.log('Initializing token client');
+    tokenClient = window.google.accounts.oauth2.initTokenClient({
+      client_id: CLIENT_ID,
+      scope: SCOPES,
+      prompt: '',
+      callback: '', // We'll define this at sign-in time
+    });
+    
+    gisInited = true;
+    console.log('GIS successfully initialized');
+
+  } catch (err) {
+    console.error('Error loading Google API:', err);
+    gapiInited = false;
+    gisInited = false;
+    throw new Error(`Failed to load Google Calendar API: ${err.message}`);
+  }
 };
 
-const initializeGapiClient = async () => {
-  await window.gapi.client.init({
-    apiKey: API_KEY,
-    clientId: CLIENT_ID,
-    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'],
-    scope: SCOPES.join(' '),
-    plugin_name: 'calendar'
-  });
+// Check if the APIs are initialized
+export const isInitialized = () => {
+  return gapiInited && gisInited;
 };
 
-// Get auth instance
+// Get auth instance - may return undefined if gapi auth2 isn't loaded
 export const getAuthInstance = () => {
-  if (!window.gapi || !window.gapi.auth2) {
-    throw new Error('Google API not initialized');
-  }
-  return window.gapi.auth2.getAuthInstance();
+  return window.gapi.auth2?.getAuthInstance();
 };
 
 // Sign in
-export const signIn = async () => {
-  const auth = getAuthInstance();
-  const options = {
-    scope: SCOPES.join(' '),
-    prompt: 'consent',
-    ux_mode: 'popup'
-  };
-  
-  try {
-    const user = await auth.signIn(options);
-    const token = user.getAuthResponse().access_token;
-    window.gapi.client.setToken({
-      access_token: token
-    });
-    return user;
-  } catch (err) {
-    console.error('Sign in error:', err);
-    throw err;
+export const signIn = () => {
+  if (!isInitialized()) {
+    throw new Error('Google API not initialized');
   }
+
+  return new Promise((resolve, reject) => {
+    try {
+      // Set the callback for token response
+      tokenClient.callback = async (response) => {
+        if (response.error) {
+          reject({ error: response.error, error_description: response.error_description });
+          return;
+        }
+        
+        try {
+          // Set the token in gapi
+          await window.gapi.client.setToken(response);
+          console.log('Successfully signed in');
+          resolve(response);
+        } catch (err) {
+          reject(err);
+        }
+      };
+      
+      // Request an access token
+      if (window.gapi.client.getToken() === null) {
+        // First time requesting a token
+        tokenClient.requestAccessToken({ prompt: 'consent' });
+      } else {
+        // Subsequent request - use no prompt
+        tokenClient.requestAccessToken({ prompt: '' });
+      }
+    } catch (err) {
+      console.error('Sign in error:', err);
+      reject(err);
+    }
+  });
 };
 
 // Sign out
 export const signOut = async () => {
-  const auth = getAuthInstance();
-  await auth.signOut();
-  window.gapi.client.setToken(null);
+  if (!isInitialized()) {
+    return;
+  }
+  
+  const token = window.gapi.client.getToken();
+  if (token !== null) {
+    try {
+      window.google.accounts.oauth2.revoke(token.access_token);
+      window.gapi.client.setToken(null);
+      console.log('Successfully signed out');
+    } catch (err) {
+      console.error('Sign out error:', err);
+    }
+  }
 };
 
 // List calendar events
 export const listEvents = async () => {
-  const auth = getAuthInstance();
-  if (!auth.isSignedIn.get()) {
-    throw new Error('User not signed in');
+  if (!isInitialized()) {
+    throw new Error('Google API not initialized');
+  }
+  
+  // Check if we have a token
+  if (!window.gapi.client.getToken()) {
+    throw new Error('Not signed in', { status: 401 });
+  }
+  
+  try {
+    const timeMin = new Date();
+    timeMin.setHours(0, 0, 0, 0);
+    
+    const response = await window.gapi.client.calendar.events.list({
+      'calendarId': 'primary',
+      'timeMin': timeMin.toISOString(),
+      'showDeleted': false,
+      'singleEvents': true,
+      'maxResults': 50,
+      'orderBy': 'startTime'
+    });
+    
+    return response;
+  } catch (err) {
+    console.error('Error fetching events:', err);
+    
+    // Handle token expiration
+    if (err.status === 401) {
+      // Token expired, try to refresh
+      try {
+        await signIn();
+        return listEvents(); // Try again after signing in
+      } catch (refreshErr) {
+        throw refreshErr;
+      }
+    }
+    
+    throw err;
   }
-
-  // Ensure we have a valid token
-  const user = auth.currentUser.get();
-  const token = user.getAuthResponse().access_token;
-  window.gapi.client.setToken({
-    access_token: token
-  });
-
-  return window.gapi.client.calendar.events.list({
-    calendarId: 'primary',
-    timeMin: new Date().toISOString(),
-    showDeleted: false,
-    singleEvents: true,
-    maxResults: 10,
-    orderBy: 'startTime'
-  });
 };

commit 68641bb57d1d25fcb0bc421cf048f3c7c5e229c5
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Fri Apr 11 13:06:45 2025 +0800

    Refactor Google Calendar integration with improved auth handling and dark mode support

diff --git a/package.json b/package.json
index 9186b48..25767ab 100644
--- a/package.json
+++ b/package.json
@@ -44,8 +44,6 @@
     "cors": "^2.8.5",
     "dotenv": "^16.4.7",
     "express": "^5.1.0",
-    "gapi-script": "^1.2.0",
-    "googleapis": "^148.0.0",
     "http": "^0.0.1-security",
     "jimp": "^0.22.8",
     "lucide-react": "^0.284.0",
diff --git a/src/components/panels/googlecalendar.jsx b/src/components/panels/googlecalendar.jsx
index 0db4c69..abf4dc7 100644
--- a/src/components/panels/googlecalendar.jsx
+++ b/src/components/panels/googlecalendar.jsx
@@ -1,175 +1,127 @@
 import React, { useState, useEffect } from 'react';
-import { gapi } from 'gapi-script';
-
-// Single scope for calendar read-only access
-const SCOPE = 'https://www.googleapis.com/auth/calendar.readonly';
-const CLIENT_ID = '453579831938-addktpr31j59mgitmuiemjtkb5pjs5am.apps.googleusercontent.com';
-const API_KEY = 'AIzaSyCng_GxCcoeRozBaw03cwN9QE-xu0WFlrI';
+import { loadGoogleApi, signIn, signOut, listEvents, getAuthInstance } from '../../lib/google-calendar.js';
 
 const GoogleCalendar = () => {
   const [events, setEvents] = useState([]);
   const [isLoading, setIsLoading] = useState(true);
   const [error, setError] = useState(null);
   const [isAuthenticated, setIsAuthenticated] = useState(false);
-  const [authInstance, setAuthInstance] = useState(null);
+  const [isInitialized, setIsInitialized] = useState(false);
 
   useEffect(() => {
-    const loadGapiAndInitialize = async () => {
+    const initializeGoogleApi = async () => {
+      if (isInitialized) return;
+      
       try {
-        // Load the Google API client library
-        await new Promise((resolve, reject) => {
-          const script = document.createElement('script');
-          script.src = 'https://apis.google.com/js/api.js';
-          script.onload = resolve;
-          script.onerror = reject;
-          document.body.appendChild(script);
-        });
-
-        await new Promise((resolve) => gapi.load('client:auth2', resolve));
-
-        // Initialize the client
-        await gapi.client.init({
-          apiKey: API_KEY,
-          clientId: CLIENT_ID,
-          discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'],
-          scope: SCOPE
-        });
-
-        // Get auth instance
-        const auth2 = gapi.auth2.getAuthInstance();
-        if (!auth2) {
-          throw new Error('Failed to initialize Google Auth');
-        }
-
-        setAuthInstance(auth2);
-        setIsAuthenticated(auth2.isSignedIn.get());
-
+        await loadGoogleApi();
+        const authInstance = getAuthInstance();
+        
+        // Set initial authentication state
+        const initialSignedIn = authInstance.isSignedIn.get();
+        setIsAuthenticated(initialSignedIn);
+        
         // Listen for sign-in state changes
-        auth2.isSignedIn.listen((isSignedIn) => {
-          console.log('Sign in state changed:', isSignedIn);
+        authInstance.isSignedIn.listen((isSignedIn) => {
+          console.log('Auth state changed:', isSignedIn);
           setIsAuthenticated(isSignedIn);
           if (isSignedIn) {
-            fetchEvents();
+            fetchEvents().catch(console.error);
           } else {
             setEvents([]);
           }
         });
 
-        if (auth2.isSignedIn.get()) {
-          fetchEvents();
+        setIsInitialized(true);
+
+        if (initialSignedIn) {
+          await fetchEvents();
         }
       } catch (err) {
         console.error('Error initializing Google Calendar API:', err);
-        setError(`Initialization error: ${err.message}`);
+        setError('Failed to initialize Google Calendar. Please refresh the page and try again.');
       } finally {
         setIsLoading(false);
       }
     };
 
-    loadGapiAndInitialize();
-  }, []);
+    initializeGoogleApi();
+  }, [isInitialized]);
 
   const handleSignIn = async () => {
     try {
       setError(null);
-      if (!authInstance) {
-        throw new Error('Google Auth not initialized');
-      }
-
-      const user = await authInstance.signIn({
-        prompt: 'consent',
-        scope: SCOPE
-      });
-
-      // Check if we have the calendar scope
-      const hasCalendarScope = user.hasGrantedScopes(SCOPE);
-      console.log('Has calendar scope:', hasCalendarScope);
-      
-      if (!hasCalendarScope) {
-        // Request additional scope if needed
-        await user.grant({ scope: SCOPE });
-      }
-
-      await fetchEvents();
+      setIsLoading(true);
+      await signIn();
+      // The auth state listener will handle fetching events
     } catch (err) {
       console.error('Sign in error:', err);
-      setError(`Sign in error: ${err.message}`);
+      if (err.error === 'popup_blocked_by_browser') {
+        setError('Please allow popups for this site to sign in with Google.');
+      } else if (err.error === 'access_denied') {
+        setError('Access denied. Please grant calendar access to view your events.');
+      } else {
+        setError('Failed to sign in. Please try again.');
+      }
+    } finally {
+      setIsLoading(false);
     }
   };
 
   const handleSignOut = async () => {
     try {
       setError(null);
-      if (!authInstance) {
-        throw new Error('Google Auth not initialized');
-      }
-      await authInstance.signOut();
+      setIsLoading(true);
+      await signOut();
       setEvents([]);
     } catch (err) {
       console.error('Sign out error:', err);
-      setError(`Sign out error: ${err.message}`);
+      setError('Failed to sign out. Please try again.');
+    } finally {
+      setIsLoading(false);
     }
   };
 
   const fetchEvents = async () => {
     try {
       setError(null);
-      const response = await gapi.client.calendar.events.list({
-        calendarId: 'primary',
-        timeMin: new Date().toISOString(),
-        showDeleted: false,
-        singleEvents: true,
-        maxResults: 10,
-        orderBy: 'startTime',
-      });
-
-      console.log('Calendar API response:', response);
-
-      if (!response || !response.result) {
-        throw new Error('Invalid response from Google Calendar API');
-      }
-
-      if (response.result.error) {
-        throw new Error(response.result.error.message);
-      }
-
+      setIsLoading(true);
+      const response = await listEvents();
       setEvents(response.result.items || []);
     } catch (err) {
       console.error('Calendar fetch error:', err);
-      let errorMessage = 'Failed to fetch calendar events';
-      
-      if (err.result?.error?.message) {
-        errorMessage = `API Error: ${err.result.error.message}`;
-      } else if (err.message) {
-        errorMessage = err.message;
+      if (err.status === 403) {
+        setError('Access denied. Please ensure you have granted calendar access.');
+        setIsAuthenticated(false);
+      } else {
+        setError('Failed to fetch calendar events. Please try again.');
       }
-      
-      setError(errorMessage);
+    } finally {
+      setIsLoading(false);
     }
   };
 
   if (isLoading) return (
-    <div className="flex items-center justify-center h-full">
-      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
+    <div className="flex items-center justify-center h-full dark:bg-gray-800">
+      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary dark:border-blue-400"></div>
     </div>
   );
 
   if (error) return (
-    <div className="p-4">
-      <div className="bg-red-50 border border-red-200 rounded-lg p-4">
-        <p className="text-red-600 text-sm font-medium">Error: {error}</p>
+    <div className="p-4 dark:bg-gray-800">
+      <div className="bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg p-4">
+        <p className="text-red-600 dark:text-red-200 text-sm font-medium">{error}</p>
         <div className="mt-3 flex gap-2">
           {isAuthenticated && (
             <button
               onClick={fetchEvents}
-              className="text-sm bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
+              className="text-sm bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700"
             >
               Retry
             </button>
           )}
           <button
             onClick={() => setError(null)}
-            className="text-sm bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"
+            className="text-sm bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700"
           >
             Dismiss
           </button>
@@ -179,42 +131,44 @@ const GoogleCalendar = () => {
   );
 
   return (
-    <div className="p-4 h-full overflow-auto">
+    <div className="p-4 h-full overflow-auto dark:bg-gray-800 dark:text-white">
       {!isAuthenticated ? (
         <div className="flex items-center justify-center h-full">
           <button
             onClick={handleSignIn}
-            className="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 flex items-center space-x-2"
+            disabled={isLoading}
+            className="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed"
           >
             <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
               <path d="M12.545,12.151L12.545,12.151c0,1.054,0.855,1.909,1.909,1.909h3.536c-0.607,1.972-2.101,3.467-4.073,4.073v-1.909c0-1.054-0.855-1.909-1.909-1.909h-3.536c0.607-1.972,2.101-3.467,4.073-4.073V12.151z M12,2C6.477,2,2,6.477,2,12c0,5.523,4.477,10,10,10s10-4.477,10-10C22,6.477,17.523,2,12,2z M12,20c-4.418,0-8-3.582-8-8s3.582-8,8-8s8,3.582,8,8S16.418,20,12,20z"/>
             </svg>
-            <span>Sign in with Google</span>
+            <span>{isLoading ? 'Signing in...' : 'Sign in with Google'}</span>
           </button>
         </div>
       ) : (
         <>
           <div className="flex justify-between items-center mb-4">
-            <h2 className="text-xl font-bold">Upcoming Events</h2>
+            <h2 className="text-xl font-bold dark:text-white">Upcoming Events</h2>
             <button
               onClick={handleSignOut}
-              className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600"
+              disabled={isLoading}
+              className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed"
             >
-              Sign Out
+              {isLoading ? 'Signing out...' : 'Sign Out'}
             </button>
           </div>
           <div className="space-y-4">
             {events.length === 0 ? (
-              <p className="text-center text-gray-500">No upcoming events</p>
+              <p className="text-center text-gray-500 dark:text-gray-400">No upcoming events</p>
             ) : (
               events.map((event) => (
-                <div key={event.id} className="border border-gray-200 p-4 rounded-lg hover:shadow-md transition-shadow">
-                  <h3 className="font-semibold text-lg">{event.summary}</h3>
-                  <p className="text-sm text-gray-600 mt-1">
+                <div key={event.id} className="border border-gray-200 dark:border-gray-700 p-4 rounded-lg hover:shadow-md transition-shadow dark:bg-gray-700">
+                  <h3 className="font-semibold text-lg dark:text-white">{event.summary}</h3>
+                  <p className="text-sm text-gray-600 dark:text-gray-300 mt-1">
                     {new Date(event.start.dateTime || event.start.date).toLocaleString()}
                   </p>
                   {event.description && (
-                    <p className="text-sm mt-2 text-gray-700">{event.description}</p>
+                    <p className="text-sm mt-2 text-gray-700 dark:text-gray-300">{event.description}</p>
                   )}
                 </div>
               ))
diff --git a/src/layouts/PanelGroupLayout.jsx b/src/layouts/PanelGroupLayout.jsx
index e1c1c65..259e577 100644
--- a/src/layouts/PanelGroupLayout.jsx
+++ b/src/layouts/PanelGroupLayout.jsx
@@ -6,6 +6,7 @@ import { store } from '../store';
 // Map of panel types to their components
 const panelComponents = {
   // Special case components can be added here
+  googlecalendar: lazy(() => import('../components/panels/googlecalendar.jsx'))
 };
 
 // Create a client-only wrapper for xterm
@@ -28,8 +29,8 @@ const PanelContent = () => {
     // Special handling for xterm
     if (config.type === 'xterm') {
       return (
-        <ClientOnly fallback={<div className="flex items-center justify-center h-full">Loading terminal...</div>}>
-          <Suspense fallback={<div className="flex items-center justify-center h-full">Initializing terminal...</div>}>
+        <ClientOnly fallback={<div className="flex items-center justify-center h-full dark:bg-gray-800 dark:text-white">Loading terminal...</div>}>
+          <Suspense fallback={<div className="flex items-center justify-center h-full dark:bg-gray-800 dark:text-white">Initializing terminal...</div>}>
             {React.createElement(React.lazy(() => import('../components/panels/xterm.jsx')))}
           </Suspense>
         </ClientOnly>
@@ -40,7 +41,7 @@ const PanelContent = () => {
     if (panelComponents[config.type]) {
       const Component = panelComponents[config.type];
       return (
-        <Suspense fallback={<div className="flex items-center justify-center h-full">Loading {config.type}...</div>}>
+        <Suspense fallback={<div className="flex items-center justify-center h-full dark:bg-gray-800 dark:text-white">Loading {config.type}...</div>}>
           <Component />
         </Suspense>
       );
@@ -70,28 +71,28 @@ const PanelContent = () => {
     );
     
     return (
-      <Suspense fallback={<div className="flex items-center justify-center h-full">Loading panel...</div>}>
+      <Suspense fallback={<div className="flex items-center justify-center h-full dark:bg-gray-800 dark:text-white">Loading panel...</div>}>
         <Component />
       </Suspense>
     );
   };
 
   return (
-    <div className="h-full w-full overflow-hidden">
+    <div className="h-full w-full overflow-hidden dark:bg-gray-900">
       <PanelGroup direction="horizontal" className="h-full">
-        <Panel defaultSize={panels.left.size} minSize={panels.left.minSize}>
+        <Panel defaultSize={panels.left.size} minSize={panels.left.minSize} className="dark:bg-gray-800">
           {renderPanel(panels.left)}
         </Panel>
 
-        <PanelResizeHandle className="w-1 bg-slate-200 hover:bg-slate-400 transition-colors" />
+        <PanelResizeHandle className="w-1 bg-slate-200 hover:bg-slate-400 dark:bg-gray-700 dark:hover:bg-gray-600 transition-colors" />
 
-        <Panel defaultSize={panels.middle.size} minSize={panels.middle.minSize}>
+        <Panel defaultSize={panels.middle.size} minSize={panels.middle.minSize} className="dark:bg-gray-800">
           {renderPanel(panels.middle)}
         </Panel>
 
-        <PanelResizeHandle className="w-1 bg-slate-200 hover:bg-slate-400 transition-colors" />
+        <PanelResizeHandle className="w-1 bg-slate-200 hover:bg-slate-400 dark:bg-gray-700 dark:hover:bg-gray-600 transition-colors" />
 
-        <Panel defaultSize={panels.right.size} minSize={panels.right.minSize}>
+        <Panel defaultSize={panels.right.size} minSize={panels.right.minSize} className="dark:bg-gray-800">
           {renderPanel(panels.right)}
         </Panel>
       </PanelGroup>
diff --git a/src/lib/google-calendar.js b/src/lib/google-calendar.js
new file mode 100644
index 0000000..7a55d47
--- /dev/null
+++ b/src/lib/google-calendar.js
@@ -0,0 +1,105 @@
+// Google Calendar API configuration
+const SCOPES = [
+  'https://www.googleapis.com/auth/calendar.readonly',
+  'https://www.googleapis.com/auth/calendar.events.readonly'
+];
+const CLIENT_ID = '453579831938-addktpr31j59mgitmuiemjtkb5pjs5am.apps.googleusercontent.com';
+const API_KEY = 'AIzaSyCng_GxCcoeRozBaw03cwN9QE-xu0WFlrI';
+
+// Load the Google API client library
+export const loadGoogleApi = () => {
+  return new Promise((resolve, reject) => {
+    if (window.gapi) {
+      initializeGapiClient().then(() => resolve(window.gapi)).catch(reject);
+      return;
+    }
+
+    const script = document.createElement('script');
+    script.src = 'https://apis.google.com/js/api.js';
+    script.async = true;
+    script.defer = true;
+    script.onload = () => {
+      window.gapi.load('client:auth2', async () => {
+        try {
+          await initializeGapiClient();
+          resolve(window.gapi);
+        } catch (err) {
+          reject(err);
+        }
+      });
+    };
+    script.onerror = reject;
+    document.body.appendChild(script);
+  });
+};
+
+const initializeGapiClient = async () => {
+  await window.gapi.client.init({
+    apiKey: API_KEY,
+    clientId: CLIENT_ID,
+    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'],
+    scope: SCOPES.join(' '),
+    plugin_name: 'calendar'
+  });
+};
+
+// Get auth instance
+export const getAuthInstance = () => {
+  if (!window.gapi || !window.gapi.auth2) {
+    throw new Error('Google API not initialized');
+  }
+  return window.gapi.auth2.getAuthInstance();
+};
+
+// Sign in
+export const signIn = async () => {
+  const auth = getAuthInstance();
+  const options = {
+    scope: SCOPES.join(' '),
+    prompt: 'consent',
+    ux_mode: 'popup'
+  };
+  
+  try {
+    const user = await auth.signIn(options);
+    const token = user.getAuthResponse().access_token;
+    window.gapi.client.setToken({
+      access_token: token
+    });
+    return user;
+  } catch (err) {
+    console.error('Sign in error:', err);
+    throw err;
+  }
+};
+
+// Sign out
+export const signOut = async () => {
+  const auth = getAuthInstance();
+  await auth.signOut();
+  window.gapi.client.setToken(null);
+};
+
+// List calendar events
+export const listEvents = async () => {
+  const auth = getAuthInstance();
+  if (!auth.isSignedIn.get()) {
+    throw new Error('User not signed in');
+  }
+
+  // Ensure we have a valid token
+  const user = auth.currentUser.get();
+  const token = user.getAuthResponse().access_token;
+  window.gapi.client.setToken({
+    access_token: token
+  });
+
+  return window.gapi.client.calendar.events.list({
+    calendarId: 'primary',
+    timeMin: new Date().toISOString(),
+    showDeleted: false,
+    singleEvents: true,
+    maxResults: 10,
+    orderBy: 'startTime'
+  });
+};

commit fe5fb6f1d5dd0b603e48b94f5c42e3a4e0ee6e87
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Fri Apr 11 11:28:33 2025 +0800

    Add support for loading both .tsx and .jsx panel components dynamically

diff --git a/src/components/panels/DatabaseRetrievePanel.tsx b/src/components/panels/DatabaseRetrievePanel.tsx
index 2fa2746..fad6ec4 100644
--- a/src/components/panels/DatabaseRetrievePanel.tsx
+++ b/src/components/panels/DatabaseRetrievePanel.tsx
@@ -1,14 +1,14 @@
 import React, { useState, useEffect } from 'react';
 import { useDispatch } from 'react-redux';
-import { importCardFromDatabase, selectContent } from '../../features/contentSlice';
-import { selectItem } from '../../features/selectedItemSlice';
+import { importCardFromDatabase, selectContent } from '../../features/contentSlice.js';
+import { selectItem } from '../../features/selectedItemSlice.js';
 
 // Import our new components
-import { SearchBar } from './database/SearchBar';
-import { HashLookup } from './database/HashLookup';
-import { ControlBar } from './database/ControlBar';
-import { CardList } from './database/CardList';
-import { Pagination } from './database/Pagination';
+import { SearchBar } from './database/SearchBar.js';
+import { HashLookup } from './database/HashLookup.js';
+import { ControlBar } from './database/ControlBar.js';
+import CardList from './database/CardList.js';
+import { Pagination } from './database/Pagination.js';
 
 interface PageData {
   items: MCardFromData[];
@@ -36,7 +36,7 @@ interface MCardFromData {
   };
 }
 
-export const DatabaseRetrievePanel: React.FC = () => {
+const DatabaseRetrievePanel: React.FC = () => {
   const dispatch = useDispatch();
   const [cards, setCards] = useState<PageData | null>(null);
   const [loading, setLoading] = useState(false);
@@ -122,11 +122,13 @@ export const DatabaseRetrievePanel: React.FC = () => {
 
       const data = await response.json();
       
-      // The retrieve endpoint returns PageData directly
-      setCards(data);
-      
-      // Clear selected card when fetching new cards
-      setSelectedCardHash(null);
+      if (data.success) {
+        setCards(data);
+        // Clear selected card when fetching new cards
+        setSelectedCardHash(null);
+      } else {
+        throw new Error(data.error || 'Failed to fetch cards');
+      }
     } catch (err) {
       setError(err instanceof Error ? err.message : 'An unknown error occurred');
       console.error('Error fetching cards:', err);
@@ -136,16 +138,10 @@ export const DatabaseRetrievePanel: React.FC = () => {
     }
   };
 
-  // Initial fetch on component mount
-  useEffect(() => {
-    fetchCards({ page, pageSize });
-  }, []);
-
   // Handle search form submission
   const handleSearch = (e: React.FormEvent) => {
     e.preventDefault();
-    if (searchTerm) {
-      setPage(1); // Reset to first page when searching
+    if (searchTerm.trim()) {
       fetchCards({ search: searchTerm, page: 1, pageSize });
     }
   };
@@ -153,8 +149,8 @@ export const DatabaseRetrievePanel: React.FC = () => {
   // Handle hash lookup form submission
   const handleHashLookup = (e: React.FormEvent) => {
     e.preventDefault();
-    if (hashValue) {
-      fetchCardByHash(hashValue);
+    if (hashValue.trim()) {
+      fetchCardByHash(hashValue.trim());
     }
   };
 
@@ -169,61 +165,48 @@ export const DatabaseRetrievePanel: React.FC = () => {
   };
 
   // Handle selecting a card
-  const handleSelectCard = (card: MCardFromData) => {
-    setSelectedCardHash(card.hash);
-    
-    // Log the card details to see what's actually available
-    console.log("Selected card:", card);
+  const handleSelectCard = async (card: MCardFromData) => {
+    // Toggle selection if clicking the same card
+    if (selectedCardHash === card.hash) {
+      setSelectedCardHash(null);
+      return;
+    }
     
-    // Get content type directly from server response
-    const serverContentType = card.contentType;
-    console.log("Server-provided content type:", serverContentType);
+    setSelectedCardHash(card.hash);
     
-    // Extract a simple content type string for the UI
-    const simpleType = serverContentType?.extension || 
+    // If we already have content, use it directly
+    if (card.content !== undefined) {
+      console.log("Using existing card content");
+      
+      // Get content type directly from server response
+      const serverContentType = card.contentType;
+      console.log("Server-provided content type:", serverContentType);
+      
+      // Extract a simple content type string for the UI
+      const simpleType = serverContentType?.extension || 
                        (serverContentType?.mimeType ? getSimpleContentType(serverContentType.mimeType) : null) || 
                        "txt";
-    
-    console.log("Using content type:", simpleType);
-    
-    // Process the content based on its format - server has already processed it
-    let processedContent = card.content;
-    
-    // Import the card to Redux store
-    dispatch(importCardFromDatabase({ 
-      hash: card.hash,
-      content: processedContent,
-      metadata: {
-        contentType: serverContentType
-      },
-      relationships: {
-        parentHash: null,
-        childHashes: [],
-        relatedHashes: []
-      }
-    }));
-    
-    // Select the card in Redux
-    dispatch(selectContent(card.hash));
-    
-    // Update the selectedItem state with card details
-    dispatch(selectItem({
-      item: processedContent,
-      hash: card.hash,
-      contentType: simpleType,
-      gtime: card.g_time
-    }));
-    
-    // If we don't have the content yet, fetch the full card to get content and details
-    if (!card.content) {
-      fetchCardDetails(card.hash);
+      
+      console.log("Using content type:", simpleType);
+      
+      // Process the content based on its type
+      dispatch(selectItem({
+        item: card.content,
+        hash: card.hash,
+        contentType: simpleType,
+        gtime: card.g_time
+      }));
+    } else {
+      // Otherwise fetch the full card details
+      console.log("Fetching full card details");
+      await fetchCardDetails(card.hash);
     }
   };
-  
-  // Function to fetch the full card details 
+
+  // Function to fetch the full card details
   const fetchCardDetails = async (hash: string) => {
     try {
-      // Use the card-collection API to get full card details
+      // Make the API request using the card-collection GET endpoint with full=true to get content
       const response = await fetch(`/api/card-collection?action=get&hash=${hash}&full=true`);
       
       if (!response.ok) {
@@ -357,3 +340,5 @@ export const DatabaseRetrievePanel: React.FC = () => {
     </div>
   );
 };
+
+export default DatabaseRetrievePanel;
diff --git a/src/components/panels/database/Card.tsx b/src/components/panels/database/Card.tsx
index 0b52d84..dd92d0c 100644
--- a/src/components/panels/database/Card.tsx
+++ b/src/components/panels/database/Card.tsx
@@ -1,6 +1,6 @@
 import React, { useState, useEffect } from 'react';
-import { ContentTypeInterpreter } from '../../../content/model/content_type_detector';
-import { FileTypeIcon } from '../../../components/ui/icons/FileTypeIcon';
+import { ContentTypeInterpreter } from '../../../content/model/content_type_detector.js';
+import { FileTypeIcon } from '../../../components/ui/icons/FileTypeIcon.js';
 
 interface CardProps {
   card: {
@@ -67,7 +67,7 @@ const TextPreview: React.FC<{ content: any, maxLength?: number }> = ({ content,
   return <pre className="whitespace-pre-wrap break-words text-xs font-mono">{displayText || 'No content'}</pre>;
 };
 
-export const Card: React.FC<CardProps> = ({ card, isSelected, onSelect, onContentTypeDetected }) => {
+const Card: React.FC<CardProps> = ({ card, isSelected, onSelect, onContentTypeDetected }) => {
   const [contentType, setContentType] = useState<{
     mimeType?: string;
     extension?: string;
@@ -111,44 +111,18 @@ export const Card: React.FC<CardProps> = ({ card, isSelected, onSelect, onConten
           // Check for text file patterns
           if (textContent.includes("This is") || textContent.includes("test file") || 
               textContent.trim().startsWith("This is")) {
-            console.log("Card - Detected text file pattern:", textContent.substring(0, 30));
             
-            setContentType({
+            // Update content type to text/plain
+            const newContentType = {
               mimeType: 'text/plain',
               extension: 'txt',
-              isValid: true
-            });
+              isValid: true,
+              isBlob: false
+            };
             
-            // Also update the Redux store with the corrected content type
+            setContentType(newContentType);
             if (onContentTypeDetected) {
-              onContentTypeDetected(card.hash, {
-                mimeType: 'text/plain',
-                extension: 'txt',
-                isValid: true
-              });
-            }
-          } else {
-            // Character ratio check for text detection
-            const printableChars = textContent.match(/[\x20-\x7E\n\r\t]/g) || [];
-            const ratio = printableChars.length / textContent.length;
-            
-            if (textContent.length > 0 && ratio > 0.8) {
-              console.log("Card - High printable character ratio:", ratio.toFixed(2));
-              
-              setContentType({
-                mimeType: 'text/plain',
-                extension: 'txt',
-                isValid: true
-              });
-              
-              // Also update the Redux store
-              if (onContentTypeDetected) {
-                onContentTypeDetected(card.hash, {
-                  mimeType: 'text/plain',
-                  extension: 'txt',
-                  isValid: true
-                });
-              }
+              onContentTypeDetected(card.hash, newContentType);
             }
           }
         } catch (e) {
@@ -156,13 +130,13 @@ export const Card: React.FC<CardProps> = ({ card, isSelected, onSelect, onConten
         }
       }
     }
-  }, [card, contentType]);
+  }, [card, contentType?.mimeType, onContentTypeDetected]);
 
   // Helper function to get a human-readable label for mime types
   const getFileTypeLabel = (mimeType?: string): string => {
-    if (!mimeType) return 'data';
-
-    // Direct debugging for Buffer JSON content that should be text
+    if (!mimeType) return 'Unknown';
+    
+    // Special handling for text in octet-stream
     if (mimeType === 'application/octet-stream' && card && card.content) {
       console.log("Card component - Checking potential text in octet-stream");
       
@@ -244,7 +218,7 @@ export const Card: React.FC<CardProps> = ({ card, isSelected, onSelect, onConten
 
     // Fallback to the full mime type
     return mimeType;
-  }
+  };
 
   const handleClick = () => {
     onSelect(card);
@@ -293,3 +267,5 @@ export const Card: React.FC<CardProps> = ({ card, isSelected, onSelect, onConten
     </div>
   );
 };
+
+export default Card;
diff --git a/src/components/panels/database/CardList.tsx b/src/components/panels/database/CardList.tsx
index 1b03fbc..2e73438 100644
--- a/src/components/panels/database/CardList.tsx
+++ b/src/components/panels/database/CardList.tsx
@@ -1,7 +1,7 @@
 import React from 'react';
-import { Card } from './Card';
+import Card from './Card.js';
 import { useDispatch } from 'react-redux';
-import { updateContentType } from '../../../features/selectedItemSlice';
+import { updateContentType } from '../../../features/selectedItemSlice.js';
 
 const formatDate = (dateString: string | null | undefined): string => {
   if (!dateString) {
@@ -43,7 +43,7 @@ interface CardListProps {
   loading: boolean;
 }
 
-export const CardList: React.FC<CardListProps> = ({
+const CardList: React.FC<CardListProps> = ({
   cards,
   selectedCardHash,
   onSelectCard,
@@ -104,3 +104,5 @@ export const CardList: React.FC<CardListProps> = ({
     </div>
   );
 };
+
+export default CardList;
diff --git a/src/layouts/PanelGroupLayout.jsx b/src/layouts/PanelGroupLayout.jsx
index 2b62529..e1c1c65 100644
--- a/src/layouts/PanelGroupLayout.jsx
+++ b/src/layouts/PanelGroupLayout.jsx
@@ -46,12 +46,24 @@ const PanelContent = () => {
       );
     }
     
-    // Otherwise try dynamic import
+    // Try both .tsx and .jsx extensions
     const Component = React.lazy(() => 
-      import(`../components/panels/${config.type}.jsx`).then(module => {
-        console.log(`Successfully loaded component for: ${config.type}`);
-        return { default: module.default || module[config.type] };
-      }).catch((error) => {
+      Promise.any([
+        import(`../components/panels/${config.type}.tsx`).then(module => {
+          console.log(`Successfully loaded .tsx component for: ${config.type}`);
+          return { default: module.default };
+        }).catch(err => {
+          console.log(`Failed to load .tsx for ${config.type}:`, err);
+          throw err;
+        }),
+        import(`../components/panels/${config.type}.jsx`).then(module => {
+          console.log(`Successfully loaded .jsx component for: ${config.type}`);
+          return { default: module.default };
+        }).catch(err => {
+          console.log(`Failed to load .jsx for ${config.type}:`, err);
+          throw err;
+        })
+      ]).catch((error) => {
         console.error(`Failed to load component for panel type: ${config.type}`, error);
         throw new Error(`No component found for panel type: ${config.type}`);
       })

commit 48f0befcb0e3bd206181e3cb9f82a633f1ac06f5
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Fri Apr 11 11:14:29 2025 +0800

    Enhance Google Calendar integration with improved auth flow and error handling

diff --git a/astro.config.mjs b/astro.config.mjs
index e1e296f..229daf9 100644
--- a/astro.config.mjs
+++ b/astro.config.mjs
@@ -160,7 +160,9 @@ export default defineConfig({
     host: '0.0.0.0',
     port: 4321,
     headers: {
-      'Access-Control-Allow-Origin': '*'
+      'Access-Control-Allow-Origin': '*',
+      'Content-Security-Policy': "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://accounts.google.com https://apis.google.com https://*.gstatic.com;",
+      'Cross-Origin-Opener-Policy': 'same-origin-allow-popups'
     }
   }
 });
diff --git a/src/components/panels/googlecalendar.jsx b/src/components/panels/googlecalendar.jsx
index a7193af..0db4c69 100644
--- a/src/components/panels/googlecalendar.jsx
+++ b/src/components/panels/googlecalendar.jsx
@@ -1,63 +1,119 @@
 import React, { useState, useEffect } from 'react';
 import { gapi } from 'gapi-script';
 
+// Single scope for calendar read-only access
+const SCOPE = 'https://www.googleapis.com/auth/calendar.readonly';
+const CLIENT_ID = '453579831938-addktpr31j59mgitmuiemjtkb5pjs5am.apps.googleusercontent.com';
+const API_KEY = 'AIzaSyCng_GxCcoeRozBaw03cwN9QE-xu0WFlrI';
+
 const GoogleCalendar = () => {
   const [events, setEvents] = useState([]);
   const [isLoading, setIsLoading] = useState(true);
   const [error, setError] = useState(null);
   const [isAuthenticated, setIsAuthenticated] = useState(false);
+  const [authInstance, setAuthInstance] = useState(null);
 
   useEffect(() => {
-    const initializeGoogleApi = async () => {
+    const loadGapiAndInitialize = async () => {
       try {
+        // Load the Google API client library
+        await new Promise((resolve, reject) => {
+          const script = document.createElement('script');
+          script.src = 'https://apis.google.com/js/api.js';
+          script.onload = resolve;
+          script.onerror = reject;
+          document.body.appendChild(script);
+        });
+
+        await new Promise((resolve) => gapi.load('client:auth2', resolve));
+
+        // Initialize the client
         await gapi.client.init({
-          apiKey: 'AIzaSyCng_GxCcoeRozBaw03cwN9QE-xu0WFlrI',
-          clientId: '453579831938-addktpr31j59mgitmuiemjtkb5pjs5am.apps.googleusercontent.com',
+          apiKey: API_KEY,
+          clientId: CLIENT_ID,
           discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'],
-          scope: 'https://www.googleapis.com/auth/calendar.readonly',
-          ux_mode: 'popup',
-          redirect_uri: 'http://localhost:4321'
+          scope: SCOPE
         });
 
-        // Check if user is signed in
-        const authInstance = gapi.auth2.getAuthInstance();
-        setIsAuthenticated(authInstance.isSignedIn.get());
+        // Get auth instance
+        const auth2 = gapi.auth2.getAuthInstance();
+        if (!auth2) {
+          throw new Error('Failed to initialize Google Auth');
+        }
+
+        setAuthInstance(auth2);
+        setIsAuthenticated(auth2.isSignedIn.get());
 
         // Listen for sign-in state changes
-        authInstance.isSignedIn.listen((isSignedIn) => {
+        auth2.isSignedIn.listen((isSignedIn) => {
+          console.log('Sign in state changed:', isSignedIn);
           setIsAuthenticated(isSignedIn);
           if (isSignedIn) {
             fetchEvents();
+          } else {
+            setEvents([]);
           }
         });
 
-        if (authInstance.isSignedIn.get()) {
+        if (auth2.isSignedIn.get()) {
           fetchEvents();
-        } else {
-          setIsLoading(false);
         }
       } catch (err) {
-        setError('Failed to initialize Google Calendar API');
+        console.error('Error initializing Google Calendar API:', err);
+        setError(`Initialization error: ${err.message}`);
+      } finally {
         setIsLoading(false);
       }
     };
 
-    gapi.load('client:auth2', initializeGoogleApi);
+    loadGapiAndInitialize();
   }, []);
 
-  const handleSignIn = () => {
-    const authInstance = gapi.auth2.getAuthInstance();
-    authInstance.signIn();
+  const handleSignIn = async () => {
+    try {
+      setError(null);
+      if (!authInstance) {
+        throw new Error('Google Auth not initialized');
+      }
+
+      const user = await authInstance.signIn({
+        prompt: 'consent',
+        scope: SCOPE
+      });
+
+      // Check if we have the calendar scope
+      const hasCalendarScope = user.hasGrantedScopes(SCOPE);
+      console.log('Has calendar scope:', hasCalendarScope);
+      
+      if (!hasCalendarScope) {
+        // Request additional scope if needed
+        await user.grant({ scope: SCOPE });
+      }
+
+      await fetchEvents();
+    } catch (err) {
+      console.error('Sign in error:', err);
+      setError(`Sign in error: ${err.message}`);
+    }
   };
 
-  const handleSignOut = () => {
-    const authInstance = gapi.auth2.getAuthInstance();
-    authInstance.signOut();
-    setEvents([]);
+  const handleSignOut = async () => {
+    try {
+      setError(null);
+      if (!authInstance) {
+        throw new Error('Google Auth not initialized');
+      }
+      await authInstance.signOut();
+      setEvents([]);
+    } catch (err) {
+      console.error('Sign out error:', err);
+      setError(`Sign out error: ${err.message}`);
+    }
   };
 
   const fetchEvents = async () => {
     try {
+      setError(null);
       const response = await gapi.client.calendar.events.list({
         calendarId: 'primary',
         timeMin: new Date().toISOString(),
@@ -67,49 +123,102 @@ const GoogleCalendar = () => {
         orderBy: 'startTime',
       });
 
-      setEvents(response.result.items);
-      setIsLoading(false);
+      console.log('Calendar API response:', response);
+
+      if (!response || !response.result) {
+        throw new Error('Invalid response from Google Calendar API');
+      }
+
+      if (response.result.error) {
+        throw new Error(response.result.error.message);
+      }
+
+      setEvents(response.result.items || []);
     } catch (err) {
-      setError('Failed to fetch calendar events');
-      setIsLoading(false);
+      console.error('Calendar fetch error:', err);
+      let errorMessage = 'Failed to fetch calendar events';
+      
+      if (err.result?.error?.message) {
+        errorMessage = `API Error: ${err.result.error.message}`;
+      } else if (err.message) {
+        errorMessage = err.message;
+      }
+      
+      setError(errorMessage);
     }
   };
 
-  if (isLoading) return <div>Loading calendar events...</div>;
-  if (error) return <div>Error: {error}</div>;
+  if (isLoading) return (
+    <div className="flex items-center justify-center h-full">
+      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
+    </div>
+  );
 
-  return (
+  if (error) return (
     <div className="p-4">
+      <div className="bg-red-50 border border-red-200 rounded-lg p-4">
+        <p className="text-red-600 text-sm font-medium">Error: {error}</p>
+        <div className="mt-3 flex gap-2">
+          {isAuthenticated && (
+            <button
+              onClick={fetchEvents}
+              className="text-sm bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
+            >
+              Retry
+            </button>
+          )}
+          <button
+            onClick={() => setError(null)}
+            className="text-sm bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"
+          >
+            Dismiss
+          </button>
+        </div>
+      </div>
+    </div>
+  );
+
+  return (
+    <div className="p-4 h-full overflow-auto">
       {!isAuthenticated ? (
-        <button
-          onClick={handleSignIn}
-          className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
-        >
-          Sign in with Google
-        </button>
+        <div className="flex items-center justify-center h-full">
+          <button
+            onClick={handleSignIn}
+            className="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 flex items-center space-x-2"
+          >
+            <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
+              <path d="M12.545,12.151L12.545,12.151c0,1.054,0.855,1.909,1.909,1.909h3.536c-0.607,1.972-2.101,3.467-4.073,4.073v-1.909c0-1.054-0.855-1.909-1.909-1.909h-3.536c0.607-1.972,2.101-3.467,4.073-4.073V12.151z M12,2C6.477,2,2,6.477,2,12c0,5.523,4.477,10,10,10s10-4.477,10-10C22,6.477,17.523,2,12,2z M12,20c-4.418,0-8-3.582-8-8s3.582-8,8-8s8,3.582,8,8S16.418,20,12,20z"/>
+            </svg>
+            <span>Sign in with Google</span>
+          </button>
+        </div>
       ) : (
         <>
           <div className="flex justify-between items-center mb-4">
             <h2 className="text-xl font-bold">Upcoming Events</h2>
             <button
               onClick={handleSignOut}
-              className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"
+              className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600"
             >
               Sign Out
             </button>
           </div>
           <div className="space-y-4">
-            {events.map((event) => (
-              <div key={event.id} className="border p-3 rounded-lg">
-                <h3 className="font-semibold">{event.summary}</h3>
-                <p className="text-sm text-gray-600">
-                  {new Date(event.start.dateTime || event.start.date).toLocaleString()}
-                </p>
-                {event.description && (
-                  <p className="text-sm mt-2">{event.description}</p>
-                )}
-              </div>
-            ))}
+            {events.length === 0 ? (
+              <p className="text-center text-gray-500">No upcoming events</p>
+            ) : (
+              events.map((event) => (
+                <div key={event.id} className="border border-gray-200 p-4 rounded-lg hover:shadow-md transition-shadow">
+                  <h3 className="font-semibold text-lg">{event.summary}</h3>
+                  <p className="text-sm text-gray-600 mt-1">
+                    {new Date(event.start.dateTime || event.start.date).toLocaleString()}
+                  </p>
+                  {event.description && (
+                    <p className="text-sm mt-2 text-gray-700">{event.description}</p>
+                  )}
+                </div>
+              ))
+            )}
           </div>
         </>
       )}
diff --git a/src/features/panellayoutSlice.js b/src/features/panellayoutSlice.js
index 223d126..04ed1cd 100644
--- a/src/features/panellayoutSlice.js
+++ b/src/features/panellayoutSlice.js
@@ -2,7 +2,7 @@ import { createSlice } from "@reduxjs/toolkit";
 import layoutConfig from "./panellayoutSlice.json";
 
 const initialState = {
-  panels: layoutConfig["catalog_layout"],
+  panels: layoutConfig["todo_layout"],
 };
 
 // Simplified function to trigger save
diff --git a/src/layouts/PanelGroupLayout.jsx b/src/layouts/PanelGroupLayout.jsx
index e33aa21..2b62529 100644
--- a/src/layouts/PanelGroupLayout.jsx
+++ b/src/layouts/PanelGroupLayout.jsx
@@ -5,9 +5,7 @@ import { store } from '../store';
 
 // Map of panel types to their components
 const panelComponents = {
-  // Add direct component mapping for CatalogPanel
-  'CatalogPanel': React.lazy(() => import('../components/panels/CatalogPanel.jsx')),
-  // Other components can be added here
+  // Special case components can be added here
 };
 
 // Create a client-only wrapper for xterm
@@ -41,29 +39,26 @@ const PanelContent = () => {
     // First check if we have a direct component mapping
     if (panelComponents[config.type]) {
       const Component = panelComponents[config.type];
-      return <Component />;
+      return (
+        <Suspense fallback={<div className="flex items-center justify-center h-full">Loading {config.type}...</div>}>
+          <Component />
+        </Suspense>
+      );
     }
     
     // Otherwise try dynamic import
     const Component = React.lazy(() => 
-      // Try both .tsx and .jsx extensions using Promise.any
-      Promise.any([
-        import(`../components/panels/${config.type}.tsx`).then(module => {
-          console.log(`Successfully loaded .tsx component for: ${config.type}`);
-          return { default: module.default || module[config.type] };
-        }),
-        import(`../components/panels/${config.type}.jsx`).then(module => {
-          console.log(`Successfully loaded .jsx component for: ${config.type}`);
-          return { default: module.default || module[config.type] };
-        })
-      ]).catch((error) => {
+      import(`../components/panels/${config.type}.jsx`).then(module => {
+        console.log(`Successfully loaded component for: ${config.type}`);
+        return { default: module.default || module[config.type] };
+      }).catch((error) => {
         console.error(`Failed to load component for panel type: ${config.type}`, error);
         throw new Error(`No component found for panel type: ${config.type}`);
       })
     );
     
     return (
-      <Suspense fallback={<div>Loading panel...</div>}>
+      <Suspense fallback={<div className="flex items-center justify-center h-full">Loading panel...</div>}>
         <Component />
       </Suspense>
     );
diff --git a/tsconfig.json b/tsconfig.json
index c68f3e4..36d822f 100644
--- a/tsconfig.json
+++ b/tsconfig.json
@@ -12,8 +12,8 @@
     "strict": false,
     "noEmit": true,
     "esModuleInterop": true,
-    "module": "esnext",
-    "moduleResolution": "node",
+    "module": "Node16",
+    "moduleResolution": "node16",
     "resolveJsonModule": true,
     "isolatedModules": true,
     "incremental": true

commit 7d1361527cc0ccbd7ae494936faa23277dc591e6
Author: Henry Koo <lckoo1230@gmail.com>
Date:   Fri Apr 11 10:50:09 2025 +0800

    Remove Balanced Expectations component and update sidebar icons for panel layouts

diff --git a/src/components/panels/CLMInputPanel.jsx b/src/components/panels/CLMInputPanel.jsx
index 7eb1e02..91f7a44 100644
--- a/src/components/panels/CLMInputPanel.jsx
+++ b/src/components/panels/CLMInputPanel.jsx
@@ -2,7 +2,6 @@ import React, { useState, useEffect, useCallback } from 'react';
 import SaveButton from './clm/SaveButton';
 import AbstractSpecification from './clm/AbstractSpecification';
 import ConcreteImplementation from './clm/ConcreteImplementation';
-import BalancedExpectations from './clm/BalancedExpectations';
 
 const CLMInputPanel = () => {
     // Title state
@@ -21,12 +20,6 @@ const CLMInputPanel = () => {
             inputs: '',
             activities: '',
             outputs: ''
-        },
-        // Balanced Expectations dimension
-        balancedExpectations: {
-            practicalBoundaries: '',
-            evaluationMetrics: '',
-            feedbackLoops: ''
         }
     });
     
@@ -185,15 +178,6 @@ const CLMInputPanel = () => {
                     outputs: data.concreteImplementation.outputs
                 };
             
-            case 'balancedExpectations':
-                return {
-                    dimensionType: "balancedExpectations",
-                    clmReference: currentClmHash || "", // Reference to parent CLM
-                    practicalBoundaries: data.balancedExpectations.practicalBoundaries,
-                    evaluationMetrics: data.balancedExpectations.evaluationMetrics,
-                    feedbackLoops: data.balancedExpectations.feedbackLoops
-                };
-            
             default:
                 return {};
         }
@@ -316,34 +300,6 @@ const CLMInputPanel = () => {
                 const clmHash = result.hash;
                 setCurrentClmHash(clmHash);
                 
-                // NOW save Balanced Expectations dimension with reference to parent CLM
-                console.log("Saving Balanced Expectations dimension with CLM reference...");
-                const balancedExpectationsJson = {
-                    ...generateJsonData('balancedExpectations'),
-                    clmReference: clmHash // Ensure the CLM reference is set to the newly created CLM
-                };
-                
-                const balancedExpResponse = await fetch('/api/card-collection', {
-                    method: 'POST',
-                    headers: {
-                        'Content-Type': 'application/json'
-                    },
-                    body: JSON.stringify({
-                        action: 'add',
-                        card: {
-                            content: balancedExpectationsJson
-                        }
-                    })
-                });
-                
-                if (!balancedExpResponse.ok) {
-                    console.warn(`Note: Failed to save Balanced Expectations: ${balancedExpResponse.status}`);
-                    // Continue anyway as the CLM was saved successfully
-                } else {
-                    const balancedExpResult = await balancedExpResponse.json();
-                    console.log(`Balanced Expectations saved with hash: ${balancedExpResult.hash.substring(0, 10)}...`);
-                }
-                
                 setLastUpdated(new Date().toISOString());
                 
                 setSaveMessage({ 
@@ -359,8 +315,7 @@ const CLMInputPanel = () => {
             console.log('Detailed error data:', {
                 title: documentTitle,
                 abstractSpecification: generateJsonData('abstractSpecification'),
-                concreteImplementation: generateJsonData('concreteImplementation'),
-                balancedExpectations: generateJsonData('balancedExpectations')
+                concreteImplementation: generateJsonData('concreteImplementation')
             });
             setSaveMessage({ 
                 type: 'error', 
@@ -461,15 +416,6 @@ const CLMInputPanel = () => {
                         generateJsonData={generateJsonData}
                     />
                 );
-            case 'balancedExpectations':
-                return (
-                    <BalancedExpectations 
-                        data={clmData.balancedExpectations}
-                        onChange={handleInputChange}
-                        generateJsonData={generateJsonData}
-                        clmReference={currentClmHash}
-                    />
-                );
             default:
                 return null;
         }
@@ -492,17 +438,11 @@ const CLMInputPanel = () => {
                             Abstract Specification
                         </button>
                         <button 
-                            className={`px-4 py-2 rounded-md mr-2 ${activeDimension === 'concreteImplementation' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}`}
+                            className={`px-4 py-2 rounded-md ${activeDimension === 'concreteImplementation' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}`}
                             onClick={() => setActiveDimension('concreteImplementation')}
                         >
                             Concrete Implementation
                         </button>
-                        <button 
-                            className={`px-4 py-2 rounded-md ${activeDimension === 'balancedExpectations' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}`}
-                            onClick={() => setActiveDimension('balancedExpectations')}
-                        >
-                            Balanced Expectations
-                        </button>
                     </div>
                     <SaveButton 
                         onSave={handleSubmit} 
diff --git a/src/components/panels/Sidebar.astro b/src/components/panels/Sidebar.astro
index 749ea18..934f89c 100644
--- a/src/components/panels/Sidebar.astro
+++ b/src/components/panels/Sidebar.astro
@@ -1,6 +1,6 @@
 ---
 import { cn } from '../../lib/utils';
-import { FaCode, FaTerminal, FaCog, FaCube, FaFile, FaMicrophone, FaBrain, FaYoutube, FaCamera, FaBook } from 'react-icons/fa';
+import { FaCode, FaTerminal, FaCog, FaCube, FaFile, FaMicrophone, FaBrain, FaYoutube, FaCamera, FaBook, FaCalendar } from 'react-icons/fa';
 import { store } from '../../store';
 import { changeLayout } from '../../features/panellayoutSlice';
 
@@ -22,13 +22,13 @@ const { class: className, ...props } = Astro.props;
         id="todoLayoutBtn"
         class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors border-l-2 border-primary bg-muted"
       >
-        <FaCode className="text-lg text-primary" />
+        <FaCalendar className="text-lg text-primary" />
       </button>
       <button
         id="generateLayoutBtn"
         class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors"
       >
-        <FaTerminal className="text-lg text-muted-foreground" />
+        <FaCode className="text-lg text-muted-foreground" />
       </button>
       <button
         id="clmLayoutBtn"
diff --git a/src/features/panellayoutSlice.json b/src/features/panellayoutSlice.json
index 4e69b0d..20b253a 100644
--- a/src/features/panellayoutSlice.json
+++ b/src/features/panellayoutSlice.json
@@ -193,7 +193,7 @@
             "visible": false
         },
         "right": {
-            "type": "ContentDetailPanel",
+            "type": "CLMDisplayPanel",
             "size": 30,
             "minSize": 0,
             "visible": false
```
