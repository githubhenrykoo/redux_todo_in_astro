---
import { cn } from '../../lib/utils';
import { FaCode, FaTerminal, FaCog, FaCube, FaFile, FaMicrophone, FaBrain, FaYoutube, FaCamera, FaBook, FaCalendar } from 'react-icons/fa';
import { store } from '../../store';
import { changeLayout } from '../../features/panellayoutSlice';

interface Props {
  class?: string;
}

const { class: className, ...props } = Astro.props;

---

<div class={cn(
  "flex flex-col h-full bg-muted border-r border-neutral-200 dark:border-neutral-800",
  className
)} {...props}>
  <div class="flex-1 flex flex-col justify-between py-4">
    <div class="space-y-6">
      <button
        id="todoLayoutBtn"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors border-l-2 border-primary bg-muted"
      >
        <FaCalendar className="text-lg text-primary" />
      </button>
      <button
        id="generateLayoutBtn"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors"
      >
        <FaCode className="text-lg text-muted-foreground" />
      </button>
      <button
        id="clmLayoutBtn"
        title="Cubical Logic Model Editor"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
      >
        <FaCube className="text-lg text-muted-foreground group-hover:text-primary transition-colors" />
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          CLM Editor
        </span>
      </button>
      <button
        id="fileLayoutBtn"
        title="File Table View"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
      >
        <FaFile className="text-lg text-muted-foreground group-hover:text-primary transition-colors" />
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          File Table
        </span>
      </button>
      <button
        id="mqttDashboardLayoutBtn"
        title="MQTT Dashboard"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
          <line x1="8" y1="21" x2="16" y2="21"></line>
          <line x1="12" y1="17" x2="12" y2="21"></line>
          <path d="M6 8h.01M9 8h.01M12 8h.01M15 8h.01M18 8h.01M6 12h.01M9 12h.01M12 12h.01M15 12h.01M18 12h.01"></path>
        </svg>
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          MQTT Dashboard
        </span>
      </button>
      <button
        id="youtubeLayoutBtn"
        title="YouTube Video Player"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
      >
        <FaYoutube className="text-lg text-muted-foreground group-hover:text-primary transition-colors" />
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          YouTube Player
        </span>
      </button>
      <button
        id="cameraLayoutBtn"
        title="Camera"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
      >
        <FaCamera className="text-lg text-muted-foreground group-hover:text-primary transition-colors" />
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          Camera
        </span>
      </button>
      <button
        id="catalogLayoutBtn"
        title="Catalog Manager"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
      >
        <FaBook className="text-lg text-muted-foreground group-hover:text-primary transition-colors" />
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          Catalog Manager
        </span>
      </button>
      <button
        id="llmVizLayoutBtn"
        title="LLM Visualization"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path>
          <path d="M3 15v4a2 2 0 0 0 2 2h16v-6H5a2 2 0 0 1-2-2v0z"></path>
          <path d="M18 12a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path>
          <circle cx="6" cy="12" r="2"></circle>
        </svg>
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          LLM Visualization
        </span>
      </button>
      <button
        id="testingLayoutBtn"
        title="Testing Dashboard"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 4h6v6h-6z"></path>
          <path d="M4 14h6v6H4z"></path>
          <path d="M17 7l-3 3"></path>
          <path d="M7 17l-3 3"></path>
        </svg>
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          Testing Dashboard
        </span>
      </button>
      <button
        id="pythonReplLayoutBtn"
        title="Python REPL Environment"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-lg text-muted-foreground group-hover:text-primary transition-colors">
          <path d="M12 9h.01M12 12h.01M12 15h.01M12 18h.01"></path>
          <path d="M19 6.41 12 2 5 6.41v11.18L12 22l7-4.41V6.41z"></path>
        </svg>
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          Python Environment
        </span>
      </button>
      <button
        id="transcriptionLayoutBtn"
        title="AI Training Data"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative hidden"
      >
        <FaMicrophone className="text-lg text-muted-foreground group-hover:text-primary transition-colors" />
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          AI Training Data
        </span>
      </button>
      <button
        id="jsonStateUpdaterLayoutBtn"
        title="JSON State Updater"
        class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors group relative"
      >
        <FaCog className="text-lg text-muted-foreground group-hover:text-primary transition-colors" />
        <span class="absolute left-full ml-2 bg-neutral-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          JSON State Updater
        </span>
      </button>
    </div>
    <div>
      <div class="flex items-center justify-center w-12 h-12 hover:bg-muted-foreground/10 transition-colors">
        <FaCog className="text-lg text-muted-foreground" />
      </div>
    </div>
  </div>
</div>

<script>
  import { store } from '../../store';
  import { changeLayout } from '../../features/panellayoutSlice';

  // Get button elements
  const todoLayoutBtn = document.getElementById('todoLayoutBtn');
  const generateLayoutBtn = document.getElementById('generateLayoutBtn');
  const clmLayoutBtn = document.getElementById('clmLayoutBtn');
  const fileLayoutBtn = document.getElementById('fileLayoutBtn');
  const mqttDashboardLayoutBtn = document.getElementById('mqttDashboardLayoutBtn');
  const youtubeLayoutBtn = document.getElementById('youtubeLayoutBtn');
  const cameraLayoutBtn = document.getElementById('cameraLayoutBtn');
  const catalogLayoutBtn = document.getElementById('catalogLayoutBtn');
  const llmVizLayoutBtn = document.getElementById('llmVizLayoutBtn');
  const testingLayoutBtn = document.getElementById('testingLayoutBtn');
  const pythonReplLayoutBtn = document.getElementById('pythonReplLayoutBtn');
  const transcriptionLayoutBtn = document.getElementById('transcriptionLayoutBtn');
  const jsonStateUpdaterLayoutBtn = document.getElementById('jsonStateUpdaterLayoutBtn');

  // Add click handlers
  todoLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('todo_layout'));
  });

  generateLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('generate_layout'));
  });

  clmLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('clm_layout'));
  });

  fileLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('file_table_layout'));
  });

  mqttDashboardLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('mqtt_dashboard_layout'));
  });

  youtubeLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('youtube_layout'));
  });

  cameraLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('camera_layout'));
  });

  catalogLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('catalog_layout'));
  });

  llmVizLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('llm_viz_layout'));
  });

  testingLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('Testing'));
  });

  pythonReplLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('python_repl_layout'));
  });

  transcriptionLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('transcription_layout'));
  });
  
  jsonStateUpdaterLayoutBtn?.addEventListener('click', () => {
    store.dispatch(changeLayout('json_state_updater_layout'));
  });

  // Function to update active button styles
  function updateActiveButton(layout: string) {
    // Remove active styles from all buttons
    todoLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    generateLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    testingLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    clmLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    fileLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    mqttDashboardLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    youtubeLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    cameraLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    catalogLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    llmVizLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    pythonReplLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');
    transcriptionLayoutBtn?.classList.remove('border-l-2', 'border-primary', 'bg-muted');

    // Reset icon colors
    todoLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    generateLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    testingLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    clmLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    fileLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    mqttDashboardLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    youtubeLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    cameraLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    catalogLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    llmVizLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    pythonReplLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');
    transcriptionLayoutBtn?.querySelector('.text-primary')?.classList.replace('text-primary', 'text-muted-foreground');

    // Add active styles to the selected button
    if (layout === 'todo_layout') {
      todoLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      todoLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    } else if (layout === 'generate_layout') {
      generateLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      generateLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    } else if (layout === 'clm_layout') {
      clmLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      clmLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    } else if (layout === 'file_table_layout') {
      fileLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      fileLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    } else if (layout === 'mqtt_dashboard_layout') {
      mqttDashboardLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      mqttDashboardLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    } else if (layout === 'youtube_layout') {
      youtubeLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      youtubeLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    } else if (layout === 'camera_layout') {
      cameraLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      cameraLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    } else if (layout === 'catalog_layout') {
      catalogLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      catalogLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    } else if (layout === 'transcription_layout') {
      transcriptionLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      transcriptionLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    } else if (layout === 'llm_viz_layout') {
      llmVizLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      llmVizLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    } else if (layout === 'python_repl_layout') {
      pythonReplLayoutBtn?.classList.add('border-l-2', 'border-primary', 'bg-muted');
      pythonReplLayoutBtn?.querySelector('.text-muted-foreground')?.classList.replace('text-muted-foreground', 'text-primary');
    }
  }

  // Listen for store changes to update active button
  store.subscribe(() => {
    const state = store.getState();
    if (state.panellayout) {
      updateActiveButton(state.panellayout.selectedLayout);
    }
  });

  // Initialize with current state
  const initialState = store.getState();
  if (initialState.panellayout) {
    updateActiveButton(initialState.panellayout.selectedLayout);
  }
</script>
